!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="assets/",r(r.s=93)}([function(t,e){t.exports=function(t,e,r,n,i){var o={};return Object.keys(n).forEach((function(t){o[t]=n[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){t.exports=function(){"use strict";var t="millisecond",e="second",r="minute",n="hour",i="day",o="week",a="month",s="quarter",l="year",c=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,h=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,u=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},d={s:u,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),i=r%60;return(e<=0?"+":"-")+u(n,2,"0")+":"+u(i,2,"0")},m:function(t,e){var r=12*(e.year()-t.year())+(e.month()-t.month()),n=t.clone().add(r,a),i=e-n<0,o=t.clone().add(r+(i?-1:1),a);return Number(-(r+(e-n)/(i?n-o:o-n))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(c){return{M:a,y:l,w:o,d:i,D:"date",h:n,m:r,s:e,ms:t,Q:s}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f="en",g={};g[f]=p;var y=function(t){return t instanceof b},v=function(t,e,r){var n;if(!t)return f;if("string"==typeof t)g[t]&&(n=t),e&&(g[t]=e,n=t);else{var i=t.name;g[i]=t,n=i}return!r&&n&&(f=n),n||!r&&f},m=function(t,e){if(y(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new b(r)},w=d;w.l=v,w.i=y,w.w=function(t,e){return m(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var b=function(){function u(t){this.$L=this.$L||v(t.locale,null,!0),this.parse(t)}var d=u.prototype;return d.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(w.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(c);if(n)return r?new Date(Date.UTC(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)):new Date(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)}return new Date(e)}(t),this.init()},d.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},d.$utils=function(){return w},d.isValid=function(){return!("Invalid Date"===this.$d.toString())},d.isSame=function(t,e){var r=m(t);return this.startOf(e)<=r&&r<=this.endOf(e)},d.isAfter=function(t,e){return m(t)<this.startOf(e)},d.isBefore=function(t,e){return this.endOf(e)<m(t)},d.$g=function(t,e,r){return w.u(t)?this[e]:this.set(r,t)},d.year=function(t){return this.$g(t,"$y",l)},d.month=function(t){return this.$g(t,"$M",a)},d.day=function(t){return this.$g(t,"$W",i)},d.date=function(t){return this.$g(t,"$D","date")},d.hour=function(t){return this.$g(t,"$H",n)},d.minute=function(t){return this.$g(t,"$m",r)},d.second=function(t){return this.$g(t,"$s",e)},d.millisecond=function(e){return this.$g(e,"$ms",t)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(t,s){var c=this,h=!!w.u(s)||s,u=w.p(t),d=function(t,e){var r=w.w(c.$u?Date.UTC(c.$y,e,t):new Date(c.$y,e,t),c);return h?r:r.endOf(i)},p=function(t,e){return w.w(c.toDate()[t].apply(c.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(e)),c)},f=this.$W,g=this.$M,y=this.$D,v="set"+(this.$u?"UTC":"");switch(u){case l:return h?d(1,0):d(31,11);case a:return h?d(1,g):d(0,g+1);case o:var m=this.$locale().weekStart||0,b=(f<m?f+7:f)-m;return d(h?y-b:y+(6-b),g);case i:case"date":return p(v+"Hours",0);case n:return p(v+"Minutes",1);case r:return p(v+"Seconds",2);case e:return p(v+"Milliseconds",3);default:return this.clone()}},d.endOf=function(t){return this.startOf(t,!1)},d.$set=function(o,s){var c,h=w.p(o),u="set"+(this.$u?"UTC":""),d=(c={},c[i]=u+"Date",c.date=u+"Date",c[a]=u+"Month",c[l]=u+"FullYear",c[n]=u+"Hours",c[r]=u+"Minutes",c[e]=u+"Seconds",c[t]=u+"Milliseconds",c)[h],p=h===i?this.$D+(s-this.$W):s;if(h===a||h===l){var f=this.clone().set("date",1);f.$d[d](p),f.init(),this.$d=f.set("date",Math.min(this.$D,f.daysInMonth())).toDate()}else d&&this.$d[d](p);return this.init(),this},d.set=function(t,e){return this.clone().$set(t,e)},d.get=function(t){return this[w.p(t)]()},d.add=function(t,s){var c,h=this;t=Number(t);var u=w.p(s),d=function(e){var r=m(h);return w.w(r.date(r.date()+Math.round(e*t)),h)};if(u===a)return this.set(a,this.$M+t);if(u===l)return this.set(l,this.$y+t);if(u===i)return d(1);if(u===o)return d(7);var p=(c={},c[r]=6e4,c[n]=36e5,c[e]=1e3,c)[u]||1,f=this.$d.getTime()+t*p;return w.w(f,this)},d.subtract=function(t,e){return this.add(-1*t,e)},d.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var r=t||"YYYY-MM-DDTHH:mm:ssZ",n=w.z(this),i=this.$locale(),o=this.$H,a=this.$m,s=this.$M,l=i.weekdays,c=i.months,u=function(t,n,i,o){return t&&(t[n]||t(e,r))||i[n].substr(0,o)},d=function(t){return w.s(o%12||12,t,"0")},p=i.meridiem||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:w.s(s+1,2,"0"),MMM:u(i.monthsShort,s,c,3),MMMM:u(c,s),D:this.$D,DD:w.s(this.$D,2,"0"),d:String(this.$W),dd:u(i.weekdaysMin,this.$W,l,2),ddd:u(i.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(o),HH:w.s(o,2,"0"),h:d(1),hh:d(2),a:p(o,a,!0),A:p(o,a,!1),m:String(a),mm:w.s(a,2,"0"),s:String(this.$s),ss:w.s(this.$s,2,"0"),SSS:w.s(this.$ms,3,"0"),Z:n};return r.replace(h,(function(t,e){return e||f[t]||n.replace(":","")}))},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(t,c,h){var u,d=w.p(c),p=m(t),f=6e4*(p.utcOffset()-this.utcOffset()),g=this-p,y=w.m(this,p);return y=(u={},u[l]=y/12,u[a]=y,u[s]=y/3,u[o]=(g-f)/6048e5,u[i]=(g-f)/864e5,u[n]=g/36e5,u[r]=g/6e4,u[e]=g/1e3,u)[d]||g,h?y:w.a(y)},d.daysInMonth=function(){return this.endOf(a).$D},d.$locale=function(){return g[this.$L]},d.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=v(t,e,!0);return n&&(r.$L=n),r},d.clone=function(){return w.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},u}();return m.prototype=b.prototype,m.extend=function(t,e){return t(e,b,m),m},m.locale=v,m.isDayjs=y,m.unix=function(t){return m(1e3*t)},m.en=g[f],m.Ls=g,m}()},function(t,e,r){var n=r(60),i=r(61);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e,r){var n=r(62);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,r){t.exports=r(80)},function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=Math.PI/180;var n=function(t){var e=t.indexOf("msie ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("trident/")>0){var r=t.indexOf("rv:");return parseInt(t.substring(r+3,t.indexOf(".",r)),10)}var n=t.indexOf("edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)};e._parseUA=function(t){var e=t.toLowerCase(),r=/(chrome)[ /]([\w.]+)/.exec(e)||/(webkit)[ /]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],i=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),o=!!t.match(/IEMobile/i);return{browser:r[1]||"",version:r[2]||"0",isIE:n(e),mobile:i,ieMobile:o}},e.glob=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},e.Konva={_global:e.glob,version:"7.1.3",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:function(t){return e.Konva.angleDeg?t*r:t},enableTrace:!1,_pointerEventsEnabled:!1,hitOnDragEnabled:!1,captureTouchEventsEnabled:!1,listenClickTap:!1,inDblClickWindow:!1,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return e.Konva.DD.isDragging},isDragReady:function(){return!!e.Konva.DD.node},UA:e._parseUA(e.glob.navigator&&e.glob.navigator.userAgent||""),document:e.glob.document,_injectGlobal:function(t){e.glob.Konva=t},_parseUA:e._parseUA},e._NODES_REGISTRY={},e._registerNode=function(t){e._NODES_REGISTRY[t.prototype.getClassName()]=t,e.Konva[t.prototype.getClassName()]=t}}).call(this,r(18))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=function(){function t(){}return t.toCollection=function(e){var r,n=new t,i=e.length;for(r=0;r<i;r++)n.push(e[r]);return n},t._mapMethod=function(e){t.prototype[e]=function(){var t,r=this.length,n=[].slice.call(arguments);for(t=0;t<r;t++)this[t][e].apply(this[t],n);return this}},t.mapMethods=function(e){var r=e.prototype;for(var n in r)t._mapMethod(n)},t}();e.Collection=i,i.prototype=[],i.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},i.prototype.toArray=function(){var t,e=[],r=this.length;for(t=0;t<r;t++)e.push(this[t]);return e};var o=function(){function t(t){void 0===t&&(t=[1,0,0,1,0,0]),this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}return t.prototype.reset=function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0},t.prototype.copy=function(){return new t(this.m)},t.prototype.copyInto=function(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]},t.prototype.point=function(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t.prototype.translate=function(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this},t.prototype.scale=function(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.m[0]*e+this.m[2]*r,i=this.m[1]*e+this.m[3]*r,o=this.m[0]*-r+this.m[2]*e,a=this.m[1]*-r+this.m[3]*e;return this.m[0]=n,this.m[1]=i,this.m[2]=o,this.m[3]=a,this},t.prototype.getTranslation=function(){return{x:this.m[4],y:this.m[5]}},t.prototype.skew=function(t,e){var r=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,i=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this},t.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],r=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=i,this.m[4]=o,this.m[5]=a,this},t.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,r=-this.m[1]*t,n=-this.m[2]*t,i=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=i,this.m[4]=o,this.m[5]=a,this},t.prototype.getMatrix=function(){return this.m},t.prototype.setAbsolutePosition=function(t,e){var r=this.m[0],n=this.m[1],i=this.m[2],o=this.m[3],a=this.m[4],s=(r*(e-this.m[5])-n*(t-a))/(r*o-n*i),l=(t-a-i*s)/r;return this.translate(l,s)},t.prototype.decompose=function(){var t=this.m[0],r=this.m[1],n=this.m[2],i=this.m[3],o=t*i-r*n,a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=r){var s=Math.sqrt(t*t+r*r);a.rotation=r>0?Math.acos(t/s):-Math.acos(t/s),a.scaleX=s,a.scaleY=o/s,a.skewX=(t*n+r*i)/o,a.skewY=0}else if(0!=n||0!=i){var l=Math.sqrt(n*n+i*i);a.rotation=Math.PI/2-(i>0?Math.acos(-n/l):-Math.acos(n/l)),a.scaleX=o/l,a.scaleY=l,a.skewX=0,a.skewY=(t*n+r*i)/o}return a.rotation=e.Util._getRotation(a.rotation),a},t}();e.Transform=o;var a=Math.PI/180,s=180/Math.PI,l={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},c=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,h=[];e.Util={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject:function(t){return!!t&&t.constructor===Object},_isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},_isNumber:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t)},_isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},_isBoolean:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},isObject:function(t){return t instanceof Object},isValidSelector:function(t){if("string"!=typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:function(t){return 0===t?0:t>0?1:-1},requestAnimFrame:function(t){h.push(t),1===h.length&&requestAnimationFrame((function(){var t=h;h=[],t.forEach((function(t){t()}))}))},createCanvasElement:function(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:function(){return document.createElement("img")},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_simplifyArray:function(t){var r,n,i=[],o=t.length,a=e.Util;for(r=0;r<o;r++)n=t[r],a._isNumber(n)?n=Math.round(1e3*n)/1e3:a._isString(n)||(n=n.toString()),i.push(n);return i},_urlToImage:function(t,e){var r=new n.glob.Image;r.onload=function(){e(r)},r.src=t},_rgbToHex:function(t,e,r){return((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t="0"+t;return"#"+t},get:function(t,e){return void 0===t?e:t},getRGB:function(t){var e;return t in l?{r:(e=l[t])[0],g:e[1],b:e[2]}:"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=c.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(t){return t=t||"black",e.Util._namedColorToRBA(t)||e.Util._hex3ColorToRGBA(t)||e.Util._hex6ColorToRGBA(t)||e.Util._rgbColorToRGBA(t)||e.Util._rgbaColorToRGBA(t)||e.Util._hslColorToRGBA(t)},_namedColorToRBA:function(t){var e=l[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA:function(t){if(0===t.indexOf("rgb(")){var e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA:function(t){if(0===t.indexOf("rgba(")){var e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex6ColorToRGBA:function(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA:function(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),r=(e[0],e.slice(1)),n=Number(r[0])/360,i=Number(r[1])/100,o=Number(r[2])/100,a=void 0,s=void 0,l=void 0;if(0===i)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};for(var c=2*o-(a=o<.5?o*(1+i):o+i-o*i),h=[0,0,0],u=0;u<3;u++)(s=n+1/3*-(u-1))<0&&s++,s>1&&s--,l=6*s<1?c+6*(a-c)*s:2*s<1?a:3*s<2?c+(a-c)*(2/3-s)*6:c,h[u]=255*l;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}},haveIntersection:function(t,e){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)},cloneObject:function(t){var e={};for(var r in t)this._isPlainObject(t[r])?e[r]=this.cloneObject(t[r]):this._isArray(t[r])?e[r]=this.cloneArray(t[r]):e[r]=t[r];return e},cloneArray:function(t){return t.slice(0)},_degToRad:function(t){return t*a},_radToDeg:function(t){return t*s},_getRotation:function(t){return n.Konva.angleDeg?e.Util._radToDeg(t):t},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw:function(t){throw new Error("Konva error: "+t)},error:function(t){console.error("Konva error: "+t)},warn:function(t){n.Konva.showWarnings&&console.warn("Konva warning: "+t)},extend:function(t,e){function r(){this.constructor=t}r.prototype=e.prototype;var n=t.prototype;for(var i in t.prototype=new r,n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i]);t.__super__=e.prototype,t.super=e},_getControlPoints:function(t,e,r,n,i,o,a){var s=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2)),l=Math.sqrt(Math.pow(i-r,2)+Math.pow(o-n,2)),c=a*s/(s+l),h=a*l/(s+l);return[r-c*(i-t),n-c*(o-e),r+h*(i-t),n+h*(o-e)]},_expandPoints:function(t,r){var n,i,o=t.length,a=[];for(n=2;n<o-2;n+=2)i=e.Util._getControlPoints(t[n-2],t[n-1],t[n],t[n+1],t[n+2],t[n+3],r),a.push(i[0]),a.push(i[1]),a.push(t[n]),a.push(t[n+1]),a.push(i[2]),a.push(i[3]);return a},each:function(t,e){for(var r in t)e(r,t[r])},_inRange:function(t,e,r){return e<=t&&t<r},_getProjectionToSegment:function(t,e,r,n,i,o){var a,s,l,c=(t-r)*(t-r)+(e-n)*(e-n);if(0==c)a=t,s=e,l=(i-r)*(i-r)+(o-n)*(o-n);else{var h=((i-t)*(r-t)+(o-e)*(n-e))/c;h<0?(a=t,s=e,l=(t-i)*(t-i)+(e-o)*(e-o)):h>1?(a=r,s=n,l=(r-i)*(r-i)+(n-o)*(n-o)):l=((a=t+h*(r-t))-i)*(a-i)+((s=e+h*(n-e))-o)*(s-o)}return[a,s,l]},_getProjectionToLine:function(t,r,n){var i=e.Util.cloneObject(t),o=Number.MAX_VALUE;return r.forEach((function(a,s){if(n||s!==r.length-1){var l=r[(s+1)%r.length],c=e.Util._getProjectionToSegment(a.x,a.y,l.x,l.y,t.x,t.y),h=c[0],u=c[1],d=c[2];d<o&&(i.x=h,i.y=u,o=d)}})),i},_prepareArrayForTween:function(t,r,n){var i,o=[],a=[];if(t.length>r.length){var s=r;r=t,t=s}for(i=0;i<t.length;i+=2)o.push({x:t[i],y:t[i+1]});for(i=0;i<r.length;i+=2)a.push({x:r[i],y:r[i+1]});var l=[];return a.forEach((function(t){var r=e.Util._getProjectionToLine(t,o,n);l.push(r.x),l.push(r.y)})),l},_prepareToStringify:function(t){var r;for(var n in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(r=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||e.Util._isElement(t[n])){if(!r.configurable)return null;delete t[n]}else if(null===e.Util._prepareToStringify(t[n])){if(!r.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign:function(t,e){for(var r in e)t[r]=e[r];return t},_getFirstPointerId:function(t){return t.touches?t.changedTouches[0].identifier:999}}},function(t,e,r){t.exports=function(){"use strict";return function(t,e,r){var n=(new Date).getTimezoneOffset(),i=e.prototype;r.utc=function(t){return new e({date:t,utc:!0,args:arguments})},i.utc=function(){return r(this.toDate(),{locale:this.$L,utc:!0})},i.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var o=i.parse;i.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),o.call(this,t)};var a=i.init;i.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else a.call(this)};var s=i.utcOffset;i.utcOffset=function(t){var e=this.$utils().u;if(e(t))return this.$u?0:e(this.$offset)?s.call(this):this.$offset;var r,i=Math.abs(t)<=16?60*t:t;return 0!==t?(r=this.local().add(i+n,"minute")).$offset=i:r=this.utc(),r};var l=i.format;i.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},i.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+n;return this.$d.valueOf()-6e4*t},i.isUTC=function(){return!!this.$u},i.toISOString=function(){return this.toDate().toISOString()},i.toString=function(){return this.toDate().toUTCString()};var c=i.toDate;i.toDate=function(t){return"s"===t&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():c.call(this)}}}()},function(t,e,r){"use strict";var n=r(24),i=r(43),o=Object.prototype.toString;function a(t){return"[object Array]"===o.call(t)}function s(t){return null!==t&&"object"==typeof t}function l(t){return"[object Function]"===o.call(t)}function c(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),a(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}t.exports={isArray:a,isArrayBuffer:function(t){return"[object ArrayBuffer]"===o.call(t)},isBuffer:i,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:s,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===o.call(t)},isFile:function(t){return"[object File]"===o.call(t)},isBlob:function(t){return"[object Blob]"===o.call(t)},isFunction:l,isStream:function(t){return s(t)&&l(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,i=arguments.length;n<i;n++)c(arguments[n],r);return e},extend:function(t,e,r){return c(e,(function(e,i){t[i]=r&&"function"==typeof e?n(e,r):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(13);e.Factory={addGetterSetter:function(t,r,n,i,o){e.Factory.addGetter(t,r,n),e.Factory.addSetter(t,r,i,o),e.Factory.addOverloadedGetterSetter(t,r)},addGetter:function(t,e,r){var i="get"+n.Util._capitalize(e);t.prototype[i]=t.prototype[i]||function(){var t=this.attrs[e];return void 0===t?r:t}},addSetter:function(t,r,i,o){var a="set"+n.Util._capitalize(r);t.prototype[a]||e.Factory.overWriteSetter(t,r,i,o)},overWriteSetter:function(t,e,r,i){var o="set"+n.Util._capitalize(e);t.prototype[o]=function(t){return r&&null!=t&&(t=r.call(this,t,e)),this._setAttr(e,t),i&&i.call(this),this}},addComponentsGetterSetter:function(t,r,o,a,s){var l,c,h=o.length,u=n.Util._capitalize,d="get"+u(r),p="set"+u(r);t.prototype[d]=function(){var t={};for(l=0;l<h;l++)t[c=o[l]]=this.getAttr(r+u(c));return t};var f=i.getComponentValidator(o);t.prototype[p]=function(t){var e,n=this.attrs[r];for(e in a&&(t=a.call(this,t)),f&&f.call(this,t,r),t)t.hasOwnProperty(e)&&this._setAttr(r+u(e),t[e]);return this._fireChangeEvent(r,n,t),s&&s.call(this),this},e.Factory.addOverloadedGetterSetter(t,r)},addOverloadedGetterSetter:function(t,e){var r=n.Util._capitalize(e),i="set"+r,o="get"+r;t.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[o]()}},addDeprecatedGetterSetter:function(t,r,i,o){n.Util.error("Adding deprecated "+r);var a="get"+n.Util._capitalize(r),s=r+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[a]=function(){n.Util.error(s);var t=this.attrs[r];return void 0===t?i:t},e.Factory.addSetter(t,r,o,(function(){n.Util.error(s)})),e.Factory.addOverloadedGetterSetter(t,r)},backCompat:function(t,e){n.Util.each(e,(function(e,r){var i=t.prototype[r],o="get"+n.Util._capitalize(e),a="set"+n.Util._capitalize(e);function s(){i.apply(this,arguments),n.Util.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}t.prototype[e]=s,t.prototype[o]=s,t.prototype[a]=s}))},afterSetFilter:function(){this._filterUpToDate=!1}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=r(9);function o(t){return i.Util._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)?t:i.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}e.RGBComponent=function(t){return t>255?255:t<0?0:Math.round(t)},e.alphaComponent=function(t){return t>1?1:t<1e-4?1e-4:t},e.getNumberValidator=function(){if(n.Konva.isUnminified)return function(t,e){return i.Util._isNumber(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}},e.getNumberOrArrayOfNumbersValidator=function(t){if(n.Konva.isUnminified)return function(e,r){var n=i.Util._isNumber(e),a=i.Util._isArray(e)&&e.length==t;return n||a||i.Util.warn(o(e)+' is a not valid value for "'+r+'" attribute. The value should be a number or Array<number>('+t+")"),e}},e.getNumberOrAutoValidator=function(){if(n.Konva.isUnminified)return function(t,e){return i.Util._isNumber(t)||"auto"===t||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}},e.getStringValidator=function(){if(n.Konva.isUnminified)return function(t,e){return i.Util._isString(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}},e.getStringOrGradientValidator=function(){if(n.Konva.isUnminified)return function(t,e){var r=i.Util._isString(t),n="[object CanvasGradient]"===Object.prototype.toString.call(t);return r||n||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}},e.getFunctionValidator=function(){if(n.Konva.isUnminified)return function(t,e){return i.Util._isFunction(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}},e.getNumberArrayValidator=function(){if(n.Konva.isUnminified)return function(t,e){return i.Util._isArray(t)?t.forEach((function(t){i.Util._isNumber(t)||i.Util.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.'),t}},e.getBooleanValidator=function(){if(n.Konva.isUnminified)return function(t,e){return!0===t||!1===t||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}},e.getComponentValidator=function(t){if(n.Konva.isUnminified)return function(e,r){return i.Util.isObject(e)||i.Util.warn(o(e)+' is a not valid value for "'+r+'" attribute. The value should be an object with properties '+t),e}}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(9),s=r(12),l=r(16),c=r(13),h=r(8),u=r(32),d="hasShadow",p="shadowRGBA",f="patternImage",g="linearGradient",y="radialGradient";function v(){return o||(o=a.Util.createCanvasElement().getContext("2d"))}e.shapes={};var m=function(t){function r(r){for(var n,i=t.call(this,r)||this;!(n=a.Util.getRandomColor())||n in e.shapes;);return i.colorKey=n,e.shapes[n]=i,i}return i(r,t),r.prototype.getContext=function(){return this.getLayer().getContext()},r.prototype.getCanvas=function(){return this.getLayer().getCanvas()},r.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this._sceneFunc},r.prototype.getHitFunc=function(){return this.attrs.hitFunc||this._hitFunc},r.prototype.hasShadow=function(){return this._getCache(d,this._hasShadow)},r.prototype._hasShadow=function(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())},r.prototype._getFillPattern=function(){return this._getCache(f,this.__getFillPattern)},r.prototype.__getFillPattern=function(){if(this.fillPatternImage()){var t=v().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");return t&&t.setTransform&&t.setTransform({a:this.fillPatternScaleX(),b:0,c:0,d:this.fillPatternScaleY(),e:0,f:0}),t}},r.prototype._getLinearGradient=function(){return this._getCache(g,this.__getLinearGradient)},r.prototype.__getLinearGradient=function(){var t=this.fillLinearGradientColorStops();if(t){for(var e=v(),r=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),i=e.createLinearGradient(r.x,r.y,n.x,n.y),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}},r.prototype._getRadialGradient=function(){return this._getCache(y,this.__getRadialGradient)},r.prototype.__getRadialGradient=function(){var t=this.fillRadialGradientColorStops();if(t){for(var e=v(),r=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),i=e.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius()),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}},r.prototype.getShadowRGBA=function(){return this._getCache(p,this._getShadowRGBA)},r.prototype._getShadowRGBA=function(){if(this.hasShadow()){var t=a.Util.colorToRGBA(this.shadowColor());return"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")"}},r.prototype.hasFill=function(){var t=this;return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],(function(){return t.fillEnabled()&&!!(t.fill()||t.fillPatternImage()||t.fillLinearGradientColorStops()||t.fillRadialGradientColorStops())}))},r.prototype.hasStroke=function(){var t=this;return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],(function(){return t.strokeEnabled()&&t.strokeWidth()&&!(!t.stroke()&&!t.strokeLinearGradientColorStops())}))},r.prototype.hasHitStroke=function(){var t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t},r.prototype.intersects=function(t){var e=this.getStage().bufferHitCanvas;return e.getContext().clear(),this.drawHit(e),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0},r.prototype.destroy=function(){return l.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this},r.prototype._useBufferCanvas=function(t){var e;if(!this.getStage())return!1;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;var r=t||this.hasFill(),n=this.hasStroke(),i=1!==this.getAbsoluteOpacity();if(r&&n&&i)return!0;var o=this.hasShadow(),a=this.shadowForStrokeEnabled();return!!(r&&n&&o&&a)},r.prototype.setStrokeHitEnabled=function(t){a.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)},r.prototype.getStrokeHitEnabled=function(){return 0!==this.hitStrokeWidth()},r.prototype.getSelfRect=function(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}},r.prototype.getClientRect=function(t){var e=(t=t||{}).skipTransform,r=t.relativeTo,n=this.getSelfRect(),i=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,o=n.width+i,a=n.height+i,s=!t.skipShadow&&this.hasShadow(),l=s?this.shadowOffsetX():0,c=s?this.shadowOffsetY():0,h=o+Math.abs(l),u=a+Math.abs(c),d=s&&this.shadowBlur()||0,p=h+2*d,f=u+2*d,g=0;Math.round(i/2)!==i/2&&(g=1);var y={width:p+g,height:f+g,x:-Math.round(i/2+d)+Math.min(l,0)+n.x,y:-Math.round(i/2+d)+Math.min(c,0)+n.y};return e?y:this._transformedRect(y,r)},r.prototype.drawScene=function(t,e){var r,n,i=this.getLayer(),o=t||i.getCanvas(),a=o.getContext(),s=this._getCanvasCache(),l=this.getSceneFunc(),c=this.hasShadow(),h=o.isCache,u=o.isCache,d=e===this;if(!this.isVisible()&&!h)return this;if(s){a.save();var p=this.getAbsoluteTransform(e).getMatrix();return a.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedSceneCanvas(a),a.restore(),this}if(!l)return this;if(a.save(),this._useBufferCanvas()&&!u){(n=(r=this.getStage().bufferCanvas).getContext()).clear(),n.save(),n._applyLineJoin(this);var f=this.getAbsoluteTransform(e).getMatrix();n.transform(f[0],f[1],f[2],f[3],f[4],f[5]),l.call(this,n,this),n.restore();var g=r.pixelRatio;c&&a._applyShadow(this),a._applyOpacity(this),a._applyGlobalCompositeOperation(this),a.drawImage(r._canvas,0,0,r.width/g,r.height/g)}else{if(a._applyLineJoin(this),!d){f=this.getAbsoluteTransform(e).getMatrix();a.transform(f[0],f[1],f[2],f[3],f[4],f[5]),a._applyOpacity(this),a._applyGlobalCompositeOperation(this)}c&&a._applyShadow(this),l.call(this,a,this)}return a.restore(),this},r.prototype.drawHit=function(t,e){if(!this.shouldDrawHit(e))return this;var r=this.getLayer(),n=t||r.hitCanvas,i=n&&n.getContext(),o=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),l=s&&s.hit;if(this.colorKey||(console.log(this),a.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()")),l){i.save();var c=this.getAbsoluteTransform(e).getMatrix();return i.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedHitCanvas(i),i.restore(),this}if(!o)return this;if(i.save(),i._applyLineJoin(this),!(this===e)){var h=this.getAbsoluteTransform(e).getMatrix();i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}return o.call(this,i,this),i.restore(),this},r.prototype.drawHitFromCache=function(t){void 0===t&&(t=0);var e,r,n,i,o,s=this._getCanvasCache(),l=this._getCachedSceneCanvas(),c=s.hit,h=c.getContext(),u=c.getWidth(),d=c.getHeight();h.clear(),h.drawImage(l._canvas,0,0,u,d);try{for(n=(r=(e=h.getImageData(0,0,u,d)).data).length,i=a.Util._hexToRgb(this.colorKey),o=0;o<n;o+=4)r[o+3]>t?(r[o]=i.r,r[o+1]=i.g,r[o+2]=i.b,r[o+3]=255):r[o+3]=0;h.putImageData(e,0,0)}catch(t){a.Util.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this},r.prototype.hasPointerCapture=function(t){return u.hasPointerCapture(t,this)},r.prototype.setPointerCapture=function(t){u.setPointerCapture(t,this)},r.prototype.releaseCapture=function(t){u.releaseCapture(t,this)},r}(l.Node);e.Shape=m,m.prototype._fillFunc=function(t){t.fill()},m.prototype._strokeFunc=function(t){t.stroke()},m.prototype._fillFuncHit=function(t){t.fill()},m.prototype._strokeFuncHit=function(t){t.stroke()},m.prototype._centroid=!1,m.prototype.nodeType="Shape",h._registerNode(m),m.prototype.eventListeners={},m.prototype.on.call(m.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(d)})),m.prototype.on.call(m.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(p)})),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",(function(){this._clearCache(f)})),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache(g)})),m.prototype.on.call(m.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache(y)})),s.Factory.addGetterSetter(m,"stroke",void 0,c.getStringOrGradientValidator()),s.Factory.addGetterSetter(m,"strokeWidth",2,c.getNumberValidator()),s.Factory.addGetterSetter(m,"hitStrokeWidth","auto",c.getNumberOrAutoValidator()),s.Factory.addGetterSetter(m,"strokeHitEnabled",!0,c.getBooleanValidator()),s.Factory.addGetterSetter(m,"perfectDrawEnabled",!0,c.getBooleanValidator()),s.Factory.addGetterSetter(m,"shadowForStrokeEnabled",!0,c.getBooleanValidator()),s.Factory.addGetterSetter(m,"lineJoin"),s.Factory.addGetterSetter(m,"lineCap"),s.Factory.addGetterSetter(m,"sceneFunc"),s.Factory.addGetterSetter(m,"hitFunc"),s.Factory.addGetterSetter(m,"dash"),s.Factory.addGetterSetter(m,"dashOffset",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"shadowColor",void 0,c.getStringValidator()),s.Factory.addGetterSetter(m,"shadowBlur",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"shadowOpacity",1,c.getNumberValidator()),s.Factory.addComponentsGetterSetter(m,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(m,"shadowOffsetX",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"shadowOffsetY",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"fillPatternImage"),s.Factory.addGetterSetter(m,"fill",void 0,c.getStringOrGradientValidator()),s.Factory.addGetterSetter(m,"fillPatternX",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"fillPatternY",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(m,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(m,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(m,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(m,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(m,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(m,"fillEnabled",!0),s.Factory.addGetterSetter(m,"strokeEnabled",!0),s.Factory.addGetterSetter(m,"shadowEnabled",!0),s.Factory.addGetterSetter(m,"dashEnabled",!0),s.Factory.addGetterSetter(m,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(m,"fillPriority","color"),s.Factory.addComponentsGetterSetter(m,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(m,"fillPatternOffsetX",0,c.getNumberValidator()),s.Factory.addGetterSetter(m,"fillPatternOffsetY",0,c.getNumberValidator()),s.Factory.addComponentsGetterSetter(m,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(m,"fillPatternScaleX",1,c.getNumberValidator()),s.Factory.addGetterSetter(m,"fillPatternScaleY",1,c.getNumberValidator()),s.Factory.addComponentsGetterSetter(m,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(m,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(m,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(m,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(m,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(m,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(m,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(m,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(m,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(m,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(m,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(m,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(m,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(m,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(m,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(m,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(m,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(m,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(m,"fillPatternRotation",0),s.Factory.backCompat(m,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),a.Collection.mapMethods(m)},function(t,e,r){"use strict";const n=r(63),i=r(29);t.exports=i((function(t,e,...r){if(e.constructor===t){const e=t.name?" `"+t.name+"`":"";throw new Error("Cannot instantiate abstract class"+e)}for(const t of n(r))if(!(t in e)){const r=e.constructor&&e.constructor.name?"`"+e.constructor.name+"`":"The child class";throw new Error(r+" must define the abstract property `"+t+"`")}}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(12),o=r(19),a=r(8),s=r(23),l=r(13);e.ids={},e.names={};e._removeId=function(t,r){t&&e.ids[t]===r&&delete e.ids[t]},e._addName=function(t,r){r&&(e.names[r]||(e.names[r]=[]),e.names[r].push(t))},e._removeName=function(t,r){if(t){var n=e.names[t];if(n){for(var i=0;i<n.length;i++){n[i]._id===r&&n.splice(i,1)}0===n.length&&delete e.names[t]}}};var c="Shape",h=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(" "),u=(["scaleXChange.konva","scaleYChange.konva"].join(" "),new n.Collection),d=1,p=function(){function t(t){this._id=d++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this.children=u,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}return t.prototype.hasChildren=function(){return!1},t.prototype.getChildren=function(){return u},t.prototype._clearCache=function(t){"transform"!==t&&"absoluteTransform"!==t||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0},t.prototype._getCache=function(t,e){var r=this._cache.get(t);return(void 0===r||("transform"===t||"absoluteTransform"===t)&&!0===r.dirty)&&(r=e.call(this),this._cache.set(t,r)),r},t.prototype._calculate=function(t,e,r){var n=this;if(!this._attachedDepsListeners.get(t)){var i=e.map((function(t){return t+"Change.konva"})).join(" ");this.on(i,(function(){n._clearCache(t)})),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,r)},t.prototype._getCanvasCache=function(){return this._cache.get("canvas")},t.prototype._clearSelfAndDescendantCache=function(t,e){this._clearCache(t),e&&"absoluteTransform"===t&&this.fire("_clearTransformCache"),this.isCached()||this.children&&this.children.each((function(e){e._clearSelfAndDescendantCache(t,!0)}))},t.prototype.clearCache=function(){return this._cache.delete("canvas"),this._clearSelfAndDescendantCache(),this},t.prototype.cache=function(t){var e=t||{},r={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var i=Math.ceil(e.width||r.width),a=Math.ceil(e.height||r.height),s=e.pixelRatio,l=void 0===e.x?r.x:e.x,c=void 0===e.y?r.y:e.y,h=e.offset||0,u=e.drawBorder||!1;if(i&&a){i+=2*h,a+=2*h,l-=h,c-=h;var d=new o.SceneCanvas({pixelRatio:s,width:i,height:a}),p=new o.SceneCanvas({pixelRatio:s,width:0,height:0}),f=new o.HitCanvas({pixelRatio:1,width:i,height:a}),g=d.getContext(),y=f.getContext();return f.isCache=!0,d.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(d.getContext()._context.imageSmoothingEnabled=!1,p.getContext()._context.imageSmoothingEnabled=!1),g.save(),y.save(),g.translate(-l,-c),y.translate(-l,-c),this._isUnderCache=!0,this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this.drawScene(d,this),this.drawHit(f,this),this._isUnderCache=!1,g.restore(),y.restore(),u&&(g.save(),g.beginPath(),g.rect(0,0,i,a),g.closePath(),g.setAttr("strokeStyle","red"),g.setAttr("lineWidth",5),g.stroke(),g.restore()),this._cache.set("canvas",{scene:d,filter:p,hit:f,x:l,y:c}),this}n.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")},t.prototype.isCached=function(){return this._cache.has("canvas")},t.prototype.getClientRect=function(t){throw new Error('abstract "getClientRect" method call')},t.prototype._transformedRect=function(t,e){var r,n,i,o,a=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],s=this.getAbsoluteTransform(e);return a.forEach((function(t){var e=s.point(t);void 0===r&&(r=i=e.x,n=o=e.y),r=Math.min(r,e.x),n=Math.min(n,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y)})),{x:r,y:n,width:i-r,height:o-n}},t.prototype._drawCachedSceneCanvas=function(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);var e=this._getCanvasCache();t.translate(e.x,e.y);var r=this._getCachedSceneCanvas(),n=r.pixelRatio;t.drawImage(r._canvas,0,0,r.width/n,r.height/n),t.restore()},t.prototype._drawCachedHitCanvas=function(t){var e=this._getCanvasCache(),r=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(r._canvas,0,0),t.restore()},t.prototype._getCachedSceneCanvas=function(){var t,e,r,i,o=this.filters(),a=this._getCanvasCache(),s=a.scene,l=a.filter,c=l.getContext();if(o){if(!this._filterUpToDate){var h=s.pixelRatio;l.setSize(s.width/s.pixelRatio,s.height/s.pixelRatio);try{for(t=o.length,c.clear(),c.drawImage(s._canvas,0,0,s.getWidth()/h,s.getHeight()/h),e=c.getImageData(0,0,l.getWidth(),l.getHeight()),r=0;r<t;r++)"function"==typeof(i=o[r])?(i.call(this,e),c.putImageData(e,0,0)):n.Util.error("Filter should be type of function, but got "+typeof i+" instead. Please check correct filters")}catch(t){n.Util.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return l}return s},t.prototype.on=function(t,e){if(3===arguments.length)return this._delegate.apply(this,arguments);var r,n,i,o,a=t.split(" "),s=a.length;for(r=0;r<s;r++)i=(n=a[r].split("."))[0],o=n[1]||"",this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:o,handler:e});return this},t.prototype.off=function(t,e){var r,n,i,o,a,s=(t||"").split(" "),l=s.length;if(!t)for(n in this.eventListeners)this._off(n);for(r=0;r<l;r++)if(o=(i=s[r].split("."))[0],a=i[1],o)this.eventListeners[o]&&this._off(o,a,e);else for(n in this.eventListeners)this._off(n,a,e);return this},t.prototype.dispatchEvent=function(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this},t.prototype.addEventListener=function(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this},t.prototype.removeEventListener=function(t){return this.off(t),this},t.prototype._delegate=function(t,e,r){var i=this;this.on(t,(function(t){for(var o=t.target.findAncestors(e,!0,i),a=0;a<o.length;a++)(t=n.Util.cloneObject(t)).currentTarget=o[a],r.call(o[a],t)}))},t.prototype.remove=function(){return this.isDragging()&&this.stopDrag(),s.DD._dragElements.delete(this._id),this._remove(),this},t.prototype._clearCaches=function(){this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening")},t.prototype._remove=function(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)},t.prototype.destroy=function(){e._removeId(this.id(),this);for(var t=(this.name()||"").split(/\s/g),r=0;r<t.length;r++){var n=t[r];e._removeName(n,this._id)}return this.remove(),this},t.prototype.getAttr=function(t){var e="get"+n.Util._capitalize(t);return n.Util._isFunction(this[e])?this[e]():this.attrs[t]},t.prototype.getAncestors=function(){for(var t=this.getParent(),e=new n.Collection;t;)e.push(t),t=t.getParent();return e},t.prototype.getAttrs=function(){return this.attrs||{}},t.prototype.setAttrs=function(t){var e=this;return this._batchTransformChanges((function(){var r,i;if(!t)return e;for(r in t)"children"!==r&&(i="set"+n.Util._capitalize(r),n.Util._isFunction(e[i])?e[i](t[r]):e._setAttr(r,t[r]))})),this},t.prototype.isListening=function(){return this._getCache("listening",this._isListening)},t.prototype._isListening=function(t){if(!this.listening())return!1;var e=this.getParent();return!e||e===t||this===t||e._isListening(t)},t.prototype.isVisible=function(){return this._getCache("visible",this._isVisible)},t.prototype._isVisible=function(t){if(!this.visible())return!1;var e=this.getParent();return!e||e===t||this===t||e._isVisible(t)},t.prototype.shouldDrawHit=function(t){if(t)return this._isVisible(t)&&this._isListening(t);var e=this.getLayer(),r=!1;s.DD._dragElements.forEach((function(t){"dragging"===t.dragStatus&&("Stage"===t.node.nodeType?r=!0:t.node.getLayer()===e&&(r=!0))}));var n=!a.Konva.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!n},t.prototype.show=function(){return this.visible(!0),this},t.prototype.hide=function(){return this.visible(!1),this},t.prototype.getZIndex=function(){return this.index||0},t.prototype.getAbsoluteZIndex=function(){var t,e,r,n,i=this.getDepth(),o=this,a=0;return"Stage"!==o.nodeType&&function s(l){for(t=[],e=l.length,r=0;r<e;r++)n=l[r],a++,n.nodeType!==c&&(t=t.concat(n.getChildren().toArray())),n._id===o._id&&(r=e);t.length>0&&t[0].getDepth()<=i&&s(t)}(o.getStage().getChildren()),a},t.prototype.getDepth=function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},t.prototype._batchTransformChanges=function(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform",!0)),this._needClearTransformCache=!1},t.prototype.setPosition=function(t){var e=this;return this._batchTransformChanges((function(){e.x(t.x),e.y(t.y)})),this},t.prototype.getPosition=function(){return{x:this.x(),y:this.y()}},t.prototype.getAbsolutePosition=function(t){for(var e=!1,r=this.parent;r;){if(r.isCached()){e=!0;break}r=r.parent}e&&!t&&(t=!0);var i=this.getAbsoluteTransform(t).getMatrix(),o=new n.Transform,a=this.offset();return o.m=i.slice(),o.translate(a.x,a.y),o.getTranslation()},t.prototype.setAbsolutePosition=function(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache("transform");var r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(t.x,t.y),t={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),this},t.prototype._setTransform=function(t){var e;for(e in t)this.attrs[e]=t[e]},t.prototype._clearTransform=function(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t},t.prototype.move=function(t){var e=t.x,r=t.y,n=this.x(),i=this.y();return void 0!==e&&(n+=e),void 0!==r&&(i+=r),this.setPosition({x:n,y:i}),this},t.prototype._eachAncestorReverse=function(t,e){var r,n,i=[],o=this.getParent();if(!e||e._id!==this._id){for(i.unshift(this);o&&(!e||o._id!==e._id);)i.unshift(o),o=o.parent;for(r=i.length,n=0;n<r;n++)t(i[n])}},t.prototype.rotate=function(t){return this.rotation(this.rotation()+t),this},t.prototype.moveToTop=function(){if(!this.parent)return n.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},t.prototype.moveUp=function(){if(!this.parent)return n.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveDown=function(){if(!this.parent)return n.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveToBottom=function(){if(!this.parent)return n.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},t.prototype.setZIndex=function(t){if(!this.parent)return n.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&n.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},t.prototype.getAbsoluteOpacity=function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},t.prototype._getAbsoluteOpacity=function(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t},t.prototype.moveTo=function(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this},t.prototype.toObject=function(){var t,e,r,i,o={},a=this.getAttrs();for(t in o.attrs={},a)e=a[t],n.Util.isObject(e)&&!n.Util._isPlainObject(e)&&!n.Util._isArray(e)||(r="function"==typeof this[t]&&this[t],delete a[t],i=r?r.call(this):null,a[t]=e,i!==e&&(o.attrs[t]=e));return o.className=this.getClassName(),n.Util._prepareToStringify(o)},t.prototype.toJSON=function(){return JSON.stringify(this.toObject())},t.prototype.getParent=function(){return this.parent},t.prototype.findAncestors=function(t,e,r){var n=[];e&&this._isMatch(t)&&n.push(this);for(var i=this.parent;i;){if(i===r)return n;i._isMatch(t)&&n.push(i),i=i.parent}return n},t.prototype.isAncestorOf=function(t){return!1},t.prototype.findAncestor=function(t,e,r){return this.findAncestors(t,e,r)[0]},t.prototype._isMatch=function(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,r,i=t.replace(/ /g,"").split(","),o=i.length;for(e=0;e<o;e++)if(r=i[e],n.Util.isValidSelector(r)||(n.Util.warn('Selector "'+r+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),n.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),n.Util.warn("Konva is awesome, right?")),"#"===r.charAt(0)){if(this.id()===r.slice(1))return!0}else if("."===r.charAt(0)){if(this.hasName(r.slice(1)))return!0}else if(this.className===r||this.nodeType===r)return!0;return!1},t.prototype.getLayer=function(){var t=this.getParent();return t?t.getLayer():null},t.prototype.getStage=function(){return this._getCache("stage",this._getStage)},t.prototype._getStage=function(){var t=this.getParent();return t?t.getStage():void 0},t.prototype.fire=function(t,e,r){return void 0===e&&(e={}),e.target=e.target||this,r?this._fireAndBubble(t,e):this._fire(t,e),this},t.prototype.getAbsoluteTransform=function(t){return t?this._getAbsoluteTransform(t):this._getCache("absoluteTransform",this._getAbsoluteTransform)},t.prototype._getAbsoluteTransform=function(t){var e;if(t)return e=new n.Transform,this._eachAncestorReverse((function(t){var r=t.transformsEnabled();"all"===r?e.multiply(t.getTransform()):"position"===r&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this._cache.get("absoluteTransform")||new n.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var r=this.transformsEnabled();if("all"===r)e.multiply(this.getTransform());else if("position"===r){var i=this.attrs.x||0,o=this.attrs.y||0,a=this.attrs.offsetX||0,s=this.attrs.offsetY||0;e.translate(i-a,o-s)}return e.dirty=!1,e},t.prototype.getAbsoluteScale=function(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();var r=this.getAbsoluteTransform(t).decompose();return{x:r.scaleX,y:r.scaleY}},t.prototype.getAbsoluteRotation=function(){return this.getAbsoluteTransform().decompose().rotation},t.prototype.getTransform=function(){return this._getCache("transform",this._getTransform)},t.prototype._getTransform=function(){var t,e,r=this._cache.get("transform")||new n.Transform;r.reset();var i=this.x(),o=this.y(),s=a.Konva.getAngle(this.rotation()),l=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,c=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,h=this.attrs.skewX||0,u=this.attrs.skewY||0,d=this.attrs.offsetX||0,p=this.attrs.offsetY||0;return 0===i&&0===o||r.translate(i,o),0!==s&&r.rotate(s),0===h&&0===u||r.skew(h,u),1===l&&1===c||r.scale(l,c),0===d&&0===p||r.translate(-1*d,-1*p),r.dirty=!1,r},t.prototype.clone=function(t){var e,r,i,o,a,s=n.Util.cloneObject(this.attrs);for(e in t)s[e]=t[e];var l=new this.constructor(s);for(e in this.eventListeners)for(i=(r=this.eventListeners[e]).length,o=0;o<i;o++)(a=r[o]).name.indexOf("konva")<0&&(l.eventListeners[e]||(l.eventListeners[e]=[]),l.eventListeners[e].push(a));return l},t.prototype._toKonvaCanvas=function(t){t=t||{};var e=this.getClientRect(),r=this.getStage(),n=void 0!==t.x?t.x:e.x,i=void 0!==t.y?t.y:e.y,a=t.pixelRatio||1,s=new o.SceneCanvas({width:t.width||e.width||(r?r.width():0),height:t.height||e.height||(r?r.height():0),pixelRatio:a}),l=s.getContext();return l.save(),(n||i)&&l.translate(-1*n,-1*i),this.drawScene(s),l.restore(),s},t.prototype.toCanvas=function(t){return this._toKonvaCanvas(t)._canvas},t.prototype.toDataURL=function(t){var e=(t=t||{}).mimeType||null,r=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,r);return t.callback&&t.callback(n),n},t.prototype.toImage=function(t){if(!t||!t.callback)throw"callback required for toImage method config argument";var e=t.callback;delete t.callback,n.Util._urlToImage(this.toDataURL(t),(function(t){e(t)}))},t.prototype.setSize=function(t){return this.width(t.width),this.height(t.height),this},t.prototype.getSize=function(){return{width:this.width(),height:this.height()}},t.prototype.getClassName=function(){return this.className||this.nodeType},t.prototype.getType=function(){return this.nodeType},t.prototype.getDragDistance=function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():a.Konva.dragDistance},t.prototype._off=function(t,e,r){var n,i,o,a=this.eventListeners[t];for(n=0;n<a.length;n++)if(i=a[n].name,o=a[n].handler,!("konva"===i&&"konva"!==e||e&&i!==e||r&&r!==o)){if(a.splice(n,1),0===a.length){delete this.eventListeners[t];break}n--}},t.prototype._fireChangeEvent=function(t,e,r){this._fire(t+"Change",{oldVal:e,newVal:r})},t.prototype.setId=function(t){var r=this.id();return e._removeId(r,this),function(t,r){r&&(e.ids[r]=t)}(this,t),this._setAttr("id",t),this},t.prototype.setName=function(t){var r,n,i=(this.name()||"").split(/\s/g),o=(t||"").split(/\s/g);for(n=0;n<i.length;n++)r=i[n],-1===o.indexOf(r)&&r&&e._removeName(r,this._id);for(n=0;n<o.length;n++)r=o[n],-1===i.indexOf(r)&&r&&e._addName(this,r);return this._setAttr("name",t),this},t.prototype.addName=function(t){if(!this.hasName(t)){var e=this.name(),r=e?e+" "+t:t;this.setName(r)}return this},t.prototype.hasName=function(t){if(!t)return!1;var e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)},t.prototype.removeName=function(t){var e=(this.name()||"").split(/\s/g),r=e.indexOf(t);return-1!==r&&(e.splice(r,1),this.setName(e.join(" "))),this},t.prototype.setAttr=function(t,e){var r=this["set"+n.Util._capitalize(t)];return n.Util._isFunction(r)?r.call(this,e):this._setAttr(t,e),this},t.prototype._setAttr=function(t,e,r){void 0===r&&(r=!1);var i=this.attrs[t];(i!==e||n.Util.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e))},t.prototype._setComponentAttr=function(t,e,r){var n;void 0!==r&&((n=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=r,this._fireChangeEvent(t,n,r))},t.prototype._fireAndBubble=function(t,e,r){if(e&&this.nodeType===c&&(e.target=this),!(("mouseenter"===t||"mouseleave"===t)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||"Stage"===this.nodeType&&!r))){this._fire(t,e);var n=("mouseenter"===t||"mouseleave"===t)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!n&&(r&&r.parent?this._fireAndBubble.call(this.parent,t,e,r):this._fireAndBubble.call(this.parent,t,e))}},t.prototype._getListeners=function(t){for(var e,r=[];e=e?Object.getPrototypeOf(e):this;)if(e.eventListeners){var n=e.eventListeners[t];n&&(r=n.concat(r),e=Object.getPrototypeOf(e))}return r},t.prototype._fire=function(t,e){var r,n=this._getListeners(t);if(n.length)for((e=e||{}).currentTarget=this,e.type=t,r=0;r<n.length;r++)n[r].handler.call(this,e)},t.prototype.draw=function(){return this.drawScene(),this.drawHit(),this},t.prototype._createDragElement=function(t){var e=t?t.pointerId:void 0,r=this.getStage(),n=this.getAbsolutePosition(),i=r._getPointerById(e)||r._changedPointerPositions[0]||n;s.DD._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-n.x,y:i.y-n.y},dragStatus:"ready",pointerId:e})},t.prototype.startDrag=function(t,e){void 0===e&&(e=!0),s.DD._dragElements.has(this._id)||this._createDragElement(t),s.DD._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)},t.prototype._setDragPosition=function(t,e){var r=this.getStage()._getPointerById(e.pointerId);if(r){var i={x:r.x-e.offset.x,y:r.y-e.offset.y},o=this.dragBoundFunc();if(void 0!==o){var a=o.call(this,i,t);a?i=a:n.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=i}},t.prototype.stopDrag=function(t){var e=s.DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),s.DD._endDragBefore(t),s.DD._endDragAfter(t)},t.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()},t.prototype.isDragging=function(){var t=s.DD._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus},t.prototype._listenDrag=function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){var e=this;if((!(void 0!==t.evt.button)||a.Konva.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var r=!1;s.DD._dragElements.forEach((function(t){e.isAncestorOf(t.node)&&(r=!0)})),r||this._createDragElement(t)}}))},t.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;var t=s.DD._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,r=t&&"ready"===t.dragStatus;e?this.stopDrag():r&&s.DD._dragElements.delete(this._id)}},t.prototype._dragCleanup=function(){this.off("mousedown.konva"),this.off("touchstart.konva")},t.create=function(t,e){return n.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)},t._createNode=function(e,r){var i,o,s,l=t.prototype.getClassName.call(e),c=e.children;if(r&&(e.attrs.container=r),a._NODES_REGISTRY[l]||(n.Util.warn('Can not find a node with class name "'+l+'". Fallback to "Shape".'),l="Shape"),i=new(0,a._NODES_REGISTRY[l])(e.attrs),c)for(o=c.length,s=0;s<o;s++)i.add(t._createNode(c[s]));return i},t}();e.Node=p,p.prototype.nodeType="Node",p.prototype._attrsAffectingSize=[],p.prototype.eventListeners={},p.prototype.on.call(p.prototype,h,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"))})),p.prototype.on.call(p.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache("visible")})),p.prototype.on.call(p.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache("listening")})),p.prototype.on.call(p.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache("absoluteOpacity")}));var f=i.Factory.addGetterSetter;f(p,"zIndex"),f(p,"absolutePosition"),f(p,"position"),f(p,"x",0,l.getNumberValidator()),f(p,"y",0,l.getNumberValidator()),f(p,"globalCompositeOperation","source-over",l.getStringValidator()),f(p,"opacity",1,l.getNumberValidator()),f(p,"name","",l.getStringValidator()),f(p,"id","",l.getStringValidator()),f(p,"rotation",0,l.getNumberValidator()),i.Factory.addComponentsGetterSetter(p,"scale",["x","y"]),f(p,"scaleX",1,l.getNumberValidator()),f(p,"scaleY",1,l.getNumberValidator()),i.Factory.addComponentsGetterSetter(p,"skew",["x","y"]),f(p,"skewX",0,l.getNumberValidator()),f(p,"skewY",0,l.getNumberValidator()),i.Factory.addComponentsGetterSetter(p,"offset",["x","y"]),f(p,"offsetX",0,l.getNumberValidator()),f(p,"offsetY",0,l.getNumberValidator()),f(p,"dragDistance",null,l.getNumberValidator()),f(p,"width",0,l.getNumberValidator()),f(p,"height",0,l.getNumberValidator()),f(p,"listening",!0,l.getBooleanValidator()),f(p,"preventDefault",!0,l.getBooleanValidator()),f(p,"filters",null,(function(t){return this._filterUpToDate=!1,t})),f(p,"visible",!0,l.getBooleanValidator()),f(p,"transformsEnabled","all",l.getStringValidator()),f(p,"size"),f(p,"dragBoundFunc"),f(p,"draggable",!1,l.getBooleanValidator()),i.Factory.backCompat(p,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),n.Collection.mapMethods(p)},function(t,e,r){var n=r(87).Konva;n._injectGlobal(n),e.default=n,n.default=n,t.exports=e.default},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(9),s=r(31),l=r(8),c=r(12),h=r(13);var u=function(){function t(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||l.Konva.pixelRatio||function(){if(o)return o;var t=a.Util.createCanvasElement().getContext("2d");return o=(l.Konva._global.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}();this.pixelRatio=e,this._canvas=a.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return t.prototype.getContext=function(){return this.context},t.prototype.getPixelRatio=function(){return this.pixelRatio},t.prototype.setPixelRatio=function(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)},t.prototype.setWidth=function(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)},t.prototype.setHeight=function(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setSize=function(t,e){this.setWidth(t||0),this.setHeight(e||0)},t.prototype.toDataURL=function(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return a.Util.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}},t}();e.Canvas=u,c.Factory.addGetterSetter(u,"pixelRatio",void 0,h.getNumberValidator());var d=function(t){function e(e){void 0===e&&(e={width:0,height:0});var r=t.call(this,e)||this;return r.context=new s.SceneContext(r),r.setSize(e.width,e.height),r}return i(e,t),e}(u);e.SceneCanvas=d;var p=function(t){function e(e){void 0===e&&(e={width:0,height:0});var r=t.call(this,e)||this;return r.hitCanvas=!0,r.context=new s.HitContext(r),r.setSize(e.width,e.height),r}return i(e,t),e}(u);e.HitCanvas=p},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(16),l=r(13),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=new o.Collection,e}return i(e,t),e.prototype.getChildren=function(t){if(!t)return this.children;var e=new o.Collection;return this.children.each((function(r){t(r)&&e.push(r)})),e},e.prototype.hasChildren=function(){return this.getChildren().length>0},e.prototype.removeChildren=function(){for(var t,e=0;e<this.children.length;e++)(t=this.children[e]).parent=null,t.index=0,t.remove();return this.children=new o.Collection,this},e.prototype.destroyChildren=function(){for(var t,e=0;e<this.children.length;e++)(t=this.children[e]).parent=null,t.index=0,t.destroy();return this.children=new o.Collection,this},e.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}var n=t[0];if(n.getParent())return n.moveTo(this),this;var i=this.children;return this._validateAdd(n),n._clearCaches(),n.index=i.length,n.parent=this,i.push(n),this._fire("add",{child:n}),this},e.prototype.destroy=function(){return this.hasChildren()&&this.destroyChildren(),t.prototype.destroy.call(this),this},e.prototype.find=function(t){return this._generalFind(t,!1)},e.prototype.get=function(t){return o.Util.warn("collection.get() method is deprecated. Please use collection.find() instead."),this.find(t)},e.prototype.findOne=function(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0},e.prototype._generalFind=function(t,e){var r=[];return this._descendants((function(n){var i=n._isMatch(t);return i&&r.push(n),!(!i||!e)})),o.Collection.toCollection(r)},e.prototype._descendants=function(t){for(var e=0;e<this.children.length;e++){var r=this.children[e];if(t(r))return!0;if(r.hasChildren()&&r._descendants(t))return!0}return!1},e.prototype.toObject=function(){var t=s.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),r=e.length,n=0;n<r;n++){var i=e[n];t.children.push(i.toObject())}return t},e.prototype.isAncestorOf=function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},e.prototype.clone=function(t){var e=s.Node.prototype.clone.call(this,t);return this.getChildren().each((function(t){e.add(t.clone())})),e},e.prototype.getAllIntersections=function(t){var e=[];return this.find("Shape").each((function(r){r.isVisible()&&r.intersects(t)&&e.push(r)})),e},e.prototype._setChildrenIndices=function(){this.children.each((function(t,e){t.index=e}))},e.prototype.drawScene=function(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas(),i=n&&n.getContext(),o=this._getCanvasCache(),a=o&&o.scene,s=n&&n.isCache;if(!this.isVisible()&&!s)return this;if(a){i.save();var l=this.getAbsoluteTransform(e).getMatrix();i.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedSceneCanvas(i),i.restore()}else this._drawChildren("drawScene",n,e);return this},e.prototype.drawHit=function(t,e){if(!this.shouldDrawHit(e))return this;var r=this.getLayer(),n=t||r&&r.hitCanvas,i=n&&n.getContext(),o=this._getCanvasCache();if(o&&o.hit){i.save();var a=this.getAbsoluteTransform(e).getMatrix();i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",n,e);return this},e.prototype._drawChildren=function(t,e,r){var n=e&&e.getContext(),i=this.clipWidth(),o=this.clipHeight(),a=this.clipFunc(),s=i&&o||a,l=r===this;if(s){n.save();var c=this.getAbsoluteTransform(r),h=c.getMatrix();if(n.transform(h[0],h[1],h[2],h[3],h[4],h[5]),n.beginPath(),a)a.call(this,n,this);else{var u=this.clipX(),d=this.clipY();n.rect(u,d,i,o)}n.clip(),h=c.copy().invert().getMatrix(),n.transform(h[0],h[1],h[2],h[3],h[4],h[5])}var p=!l&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;p&&(n.save(),n._applyGlobalCompositeOperation(this)),this.children.each((function(n){n[t](e,r)})),p&&n.restore(),s&&n.restore()},e.prototype.getClientRect=function(t){var e,r,n,i,o=(t=t||{}).skipTransform,a=t.relativeTo,s={x:1/0,y:1/0,width:0,height:0},l=this;this.children.each((function(o){if(o.visible()){var a=o.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===a.width&&0===a.height||(void 0===e?(e=a.x,r=a.y,n=a.x+a.width,i=a.y+a.height):(e=Math.min(e,a.x),r=Math.min(r,a.y),n=Math.max(n,a.x+a.width),i=Math.max(i,a.y+a.height)))}}));for(var c=this.find("Shape"),h=!1,u=0;u<c.length;u++){if(c[u]._isVisible(this)){h=!0;break}}return s=h&&void 0!==e?{x:e,y:r,width:n-e,height:i-r}:{x:0,y:0,width:0,height:0},o?s:this._transformedRect(s,a)},e}(s.Node);e.Container=c,a.Factory.addComponentsGetterSetter(c,"clip",["x","y","width","height"]),a.Factory.addGetterSetter(c,"clipX",void 0,l.getNumberValidator()),a.Factory.addGetterSetter(c,"clipY",void 0,l.getNumberValidator()),a.Factory.addGetterSetter(c,"clipWidth",void 0,l.getNumberValidator()),a.Factory.addGetterSetter(c,"clipHeight",void 0,l.getNumberValidator()),a.Factory.addGetterSetter(c,"clipFunc"),o.Collection.mapMethods(c)},function(t,e,r){t.exports=r(42)},function(t,e,r){"use strict";(function(e){var n=r(11),i=r(46),o={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var s,l={adapter:("undefined"!=typeof XMLHttpRequest?s=r(25):void 0!==e&&(s=r(25)),s),transformRequest:[function(t,e){return i(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(a(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(t){l.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){l.headers[t]=n.merge(o)})),t.exports=l}).call(this,r(45))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=r(9);e.DD={get isDragging(){var t=!1;return e.DD._dragElements.forEach((function(e){"dragging"===e.dragStatus&&(t=!0)})),t},justDragged:!1,get node(){var t;return e.DD._dragElements.forEach((function(e){t=e.node})),t},_dragElements:new Map,_drag:function(t){var r=[];e.DD._dragElements.forEach((function(e,n){var o=e.node,a=o.getStage();a.setPointersPositions(t),void 0===e.pointerId&&(e.pointerId=i.Util._getFirstPointerId(t));var s=a._changedPointerPositions.find((function(t){return t.id===e.pointerId}));if(s){if("dragging"!==e.dragStatus){var l=o.dragDistance();if(Math.max(Math.abs(s.x-e.startPointerPos.x),Math.abs(s.y-e.startPointerPos.y))<l)return;if(o.startDrag({evt:t}),!o.isDragging())return}o._setDragPosition(t,e),r.push(o)}})),r.forEach((function(e){e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)}))},_endDragBefore:function(t){e.DD._dragElements.forEach((function(r,i){var o=r.node.getStage();if(t&&o.setPointersPositions(t),o._changedPointerPositions.find((function(t){return t.id===r.pointerId}))){"dragging"!==r.dragStatus&&"stopped"!==r.dragStatus||(e.DD.justDragged=!0,n.Konva.listenClickTap=!1,r.dragStatus="stopped");var a=r.node.getLayer()||r.node instanceof n.Konva.Stage&&r.node;a&&a.draw()}}))},_endDragAfter:function(t){e.DD._dragElements.forEach((function(r,n){"stopped"===r.dragStatus&&r.node.fire("dragend",{type:"dragend",target:r.node,evt:t},!0),"dragging"!==r.dragStatus&&e.DD._dragElements.delete(n)}))}},n.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1))},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";var n=r(11),i=r(47),o=r(49),a=r(50),s=r(51),l=r(26);t.exports=function(t){return new Promise((function(e,c){var h=t.data,u=t.headers;n.isFormData(h)&&delete u["Content-Type"];var d=new XMLHttpRequest;if(t.auth){var p=t.auth.username||"",f=t.auth.password||"";u.Authorization="Basic "+btoa(p+":"+f)}if(d.open(t.method.toUpperCase(),o(t.url,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,d.onreadystatechange=function(){if(d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in d?a(d.getAllResponseHeaders()):null,n={data:t.responseType&&"text"!==t.responseType?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:r,config:t,request:d};i(e,c,n),d=null}},d.onerror=function(){c(l("Network Error",t,null,d)),d=null},d.ontimeout=function(){c(l("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",d)),d=null},n.isStandardBrowserEnv()){var g=r(52),y=(t.withCredentials||s(t.url))&&t.xsrfCookieName?g.read(t.xsrfCookieName):void 0;y&&(u[t.xsrfHeaderName]=y)}if("setRequestHeader"in d&&n.forEach(u,(function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete u[e]:d.setRequestHeader(e,t)})),t.withCredentials&&(d.withCredentials=!0),t.responseType)try{d.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&d.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){d&&(d.abort(),c(t),d=null)})),void 0===h&&(h=null),d.send(h)}))}},function(t,e,r){"use strict";var n=r(48);t.exports=function(t,e,r,i,o){var a=new Error(t);return n(a,e,r,i,o)}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){"use strict";const n=r(64),i=r(65),o=r(66),a=r(67),s=r(68),l=r(69),c=r(74),{set:h}=r(77),u=r(30);t.exports=l([2,0,1],(t,e,r)=>u(r,(function(){const{arg:l=0,path:u=e,ignoreThis:d}=c("arg",t),p=n(Array.from(arguments),l);return a(this)||o(this)||i(d,{blacklist:!0})(this)||(u?(s(p[l])||(p[l]={}),h(p[l],u,this)):p.splice(l,0,this)),r.apply(this,p)})))},function(t,e,r){"use strict";const n=r(71),i=r(72),o=r(73),a=new WeakMap,s=new WeakMap,l=/([^\n]+(?:\r?\n)?{\r?\n)([ \t]*)([\s\S]+)/;t.exports=function(t,e){if("function"!=typeof t)throw new TypeError("wfn argument 1 must be a function");if("function"!=typeof e)throw new TypeError("wfn argument 2 must be a function");const r=s.has(t)?s.get(t):String(t);s.set(e,r);const c=(a.has(t)?a.get(t):[]).concat([e.name]);a.set(e,c),n(t,e);const h=c.filter(Boolean);let u;if(h.length){const t=c.length-h.length;u=i("and",h.map(t=>t+"()").concat(t>0?[t+" other unnamed function"+o(t,"","s")]:[]))}else u=c.length+" unnamed function"+o(c.length,"","s");const d=`/* [wfn] Wrapped with ${u} */`;let p;const f=r.match(l);if(f){const[,t,e,r]=f;p=t+e+d+"\n"+e+r}else p=r.trim()+"\n"+d;return e.toString=()=>p,e}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(8),s=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],l=function(){function t(t){this.canvas=t,this._context=t._canvas.getContext("2d"),a.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}return t.prototype.fillShape=function(t){t.fillEnabled()&&this._fill(t)},t.prototype._fill=function(t){},t.prototype.strokeShape=function(t){t.hasStroke()&&this._stroke(t)},t.prototype._stroke=function(t){},t.prototype.fillStrokeShape=function(t){this.fillShape(t),this.strokeShape(t)},t.prototype.getTrace=function(t){var e,r,n,i,a=this.traceArr,s=a.length,l="";for(e=0;e<s;e++)(n=(r=a[e]).method)?(i=r.args,l+=n,t?l+="()":o.Util._isArray(i[0])?l+="(["+i.join(",")+"])":l+="("+i.join(",")+")"):(l+=r.property,t||(l+="="+r.val)),l+=";";return l},t.prototype.clearTrace=function(){this.traceArr=[]},t.prototype._trace=function(t){var e=this.traceArr;e.push(t),e.length>=100&&e.shift()},t.prototype.reset=function(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)},t.prototype.getCanvas=function(){return this.canvas},t.prototype.clear=function(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)},t.prototype._applyLineCap=function(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)},t.prototype._applyOpacity=function(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)},t.prototype._applyLineJoin=function(t){var e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)},t.prototype.setAttr=function(t,e){this._context[t]=e},t.prototype.arc=function(t,e,r,n,i,o){this._context.arc(t,e,r,n,i,o)},t.prototype.arcTo=function(t,e,r,n,i){this._context.arcTo(t,e,r,n,i)},t.prototype.beginPath=function(){this._context.beginPath()},t.prototype.bezierCurveTo=function(t,e,r,n,i,o){this._context.bezierCurveTo(t,e,r,n,i,o)},t.prototype.clearRect=function(t,e,r,n){this._context.clearRect(t,e,r,n)},t.prototype.clip=function(){this._context.clip()},t.prototype.closePath=function(){this._context.closePath()},t.prototype.createImageData=function(t,e){var r=arguments;return 2===r.length?this._context.createImageData(t,e):1===r.length?this._context.createImageData(t):void 0},t.prototype.createLinearGradient=function(t,e,r,n){return this._context.createLinearGradient(t,e,r,n)},t.prototype.createPattern=function(t,e){return this._context.createPattern(t,e)},t.prototype.createRadialGradient=function(t,e,r,n,i,o){return this._context.createRadialGradient(t,e,r,n,i,o)},t.prototype.drawImage=function(t,e,r,n,i,o,a,s,l){var c=arguments,h=this._context;3===c.length?h.drawImage(t,e,r):5===c.length?h.drawImage(t,e,r,n,i):9===c.length&&h.drawImage(t,e,r,n,i,o,a,s,l)},t.prototype.ellipse=function(t,e,r,n,i,o,a,s){this._context.ellipse(t,e,r,n,i,o,a,s)},t.prototype.isPointInPath=function(t,e){return this._context.isPointInPath(t,e)},t.prototype.fill=function(){this._context.fill()},t.prototype.fillRect=function(t,e,r,n){this._context.fillRect(t,e,r,n)},t.prototype.strokeRect=function(t,e,r,n){this._context.strokeRect(t,e,r,n)},t.prototype.fillText=function(t,e,r){this._context.fillText(t,e,r)},t.prototype.measureText=function(t){return this._context.measureText(t)},t.prototype.getImageData=function(t,e,r,n){return this._context.getImageData(t,e,r,n)},t.prototype.lineTo=function(t,e){this._context.lineTo(t,e)},t.prototype.moveTo=function(t,e){this._context.moveTo(t,e)},t.prototype.rect=function(t,e,r,n){this._context.rect(t,e,r,n)},t.prototype.putImageData=function(t,e,r){this._context.putImageData(t,e,r)},t.prototype.quadraticCurveTo=function(t,e,r,n){this._context.quadraticCurveTo(t,e,r,n)},t.prototype.restore=function(){this._context.restore()},t.prototype.rotate=function(t){this._context.rotate(t)},t.prototype.save=function(){this._context.save()},t.prototype.scale=function(t,e){this._context.scale(t,e)},t.prototype.setLineDash=function(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)},t.prototype.getLineDash=function(){return this._context.getLineDash()},t.prototype.setTransform=function(t,e,r,n,i,o){this._context.setTransform(t,e,r,n,i,o)},t.prototype.stroke=function(){this._context.stroke()},t.prototype.strokeText=function(t,e,r,n){this._context.strokeText(t,e,r,n)},t.prototype.transform=function(t,e,r,n,i,o){this._context.transform(t,e,r,n,i,o)},t.prototype.translate=function(t,e){this._context.translate(t,e)},t.prototype._enableTrace=function(){var t,e,r=this,n=s.length,i=o.Util._simplifyArray,a=this.setAttr,l=function(t){var n,o=r[t];r[t]=function(){return e=i(Array.prototype.slice.call(arguments,0)),n=o.apply(r,arguments),r._trace({method:t,args:e}),n}};for(t=0;t<n;t++)l(s[t]);r.setAttr=function(){a.apply(r,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),r._trace({property:t,val:e})}},t.prototype._applyGlobalCompositeOperation=function(t){var e=t.getGlobalCompositeOperation();"source-over"!==e&&this.setAttr("globalCompositeOperation",e)},t}();e.Context=l,["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(t){Object.defineProperty(l.prototype,t,{get:function(){return this._context[t]},set:function(e){this._context[t]=e}})}));var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._fillColor=function(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)},e.prototype._fillPattern=function(t){var e=t.getFillPatternX(),r=t.getFillPatternY(),n=a.Konva.getAngle(t.getFillPatternRotation()),i=t.getFillPatternOffsetX(),o=t.getFillPatternOffsetY();t.getFillPatternScaleX(),t.getFillPatternScaleY();(e||r)&&this.translate(e||0,r||0),n&&this.rotate(n),(i||o)&&this.translate(-1*i,-1*o),this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)},e.prototype._fillLinearGradient=function(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fillRadialGradient=function(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fill=function(t){var e=t.fill(),r=t.getFillPriority();if(e&&"color"===r)this._fillColor(t);else{var n=t.getFillPatternImage();if(n&&"pattern"===r)this._fillPattern(t);else{var i=t.getFillLinearGradientColorStops();if(i&&"linear-gradient"===r)this._fillLinearGradient(t);else{var o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===r?this._fillRadialGradient(t):e?this._fillColor(t):n?this._fillPattern(t):i?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}}}},e.prototype._strokeLinearGradient=function(t){var e=t.getStrokeLinearGradientStartPoint(),r=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(e.x,e.y,r.x,r.y);if(n){for(var o=0;o<n.length;o+=2)i.addColorStop(n[o],n[o+1]);this.setAttr("strokeStyle",i)}},e.prototype._stroke=function(t){var e=t.dash(),r=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!r){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),r||this.restore()}},e.prototype._applyShadow=function(t){var e=o.Util,r=e.get(t.getShadowRGBA(),"black"),n=e.get(t.getShadowBlur(),5),i=e.get(t.getShadowOffset(),{x:0,y:0}),a=t.getAbsoluteScale(),s=this.canvas.getPixelRatio(),l=a.x*s,c=a.y*s;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",n*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",i.x*l),this.setAttr("shadowOffsetY",i.y*c)},e}(l);e.SceneContext=c;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._fill=function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},e.prototype.strokeShape=function(t){t.hasHitStroke()&&this._stroke(t)},e.prototype._stroke=function(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t);var n=t.hitStrokeWidth(),i="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}},e}(l);e.HitContext=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=new Map,o=void 0!==n.Konva._global.PointerEvent;function a(t){return{evt:t,pointerId:t.pointerId}}function s(t,e){var r=i.get(t);if(r){var n=r.getStage();n&&n.content,i.delete(t),o&&r._fire("lostpointercapture",a(new PointerEvent("lostpointercapture")))}}e.getCapturedShape=function(t){return i.get(t)},e.createEvent=a,e.hasPointerCapture=function(t,e){return i.get(t)===e},e.setPointerCapture=function(t,e){s(t),e.getStage()&&(i.set(t,e),o&&e._fire("gotpointercapture",a(new PointerEvent("gotpointercapture"))))},e.releaseCapture=s},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(20),s=r(16),l=r(12),c=r(19),h=r(13),u=r(14),d=r(8),p=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],f=p.length,g=function(t){function e(e){var r=t.call(this,e)||this;return r.canvas=new c.SceneCanvas,r.hitCanvas=new c.HitCanvas({pixelRatio:1}),r._waitingForDraw=!1,r.on("visibleChange.konva",r._checkVisibility),r._checkVisibility(),r.on("imageSmoothingEnabledChange.konva",r._setSmoothEnabled),r._setSmoothEnabled(),r}return i(e,t),e.prototype.createPNGStream=function(){return this.canvas._canvas.createPNGStream()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getHitCanvas=function(){return this.hitCanvas},e.prototype.getContext=function(){return this.getCanvas().getContext()},e.prototype.clear=function(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this},e.prototype.setZIndex=function(e){t.prototype.setZIndex.call(this,e);var r=this.getStage();return r&&(r.content.removeChild(this.getCanvas()._canvas),e<r.children.length-1?r.content.insertBefore(this.getCanvas()._canvas,r.children[e+1].getCanvas()._canvas):r.content.appendChild(this.getCanvas()._canvas)),this},e.prototype.moveToTop=function(){s.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas)),!0},e.prototype.moveUp=function(){if(!s.Node.prototype.moveUp.call(this))return!1;var t=this.getStage();return!!t&&(t.content.removeChild(this.getCanvas()._canvas),this.index<t.children.length-1?t.content.insertBefore(this.getCanvas()._canvas,t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas),!0)},e.prototype.moveDown=function(){if(s.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}return!0}return!1},e.prototype.moveToBottom=function(){if(s.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}return!0}return!1},e.prototype.getLayer=function(){return this},e.prototype.remove=function(){var t=this.getCanvas()._canvas;return s.Node.prototype.remove.call(this),t&&t.parentNode&&o.Util._isInDocument(t)&&t.parentNode.removeChild(t),this},e.prototype.getStage=function(){return this.parent},e.prototype.setSize=function(t){var e=t.width,r=t.height;return this.canvas.setSize(e,r),this.hitCanvas.setSize(e,r),this._setSmoothEnabled(),this},e.prototype._validateAdd=function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&o.Util.throw("You may only add groups and shapes to a layer.")},e.prototype._toKonvaCanvas=function(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),s.Node.prototype._toKonvaCanvas.call(this,t)},e.prototype._checkVisibility=function(){var t=this.visible();this.canvas._canvas.style.display=t?"block":"none"},e.prototype._setSmoothEnabled=function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()},e.prototype.getWidth=function(){if(this.parent)return this.parent.width()},e.prototype.setWidth=function(){o.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},e.prototype.getHeight=function(){if(this.parent)return this.parent.height()},e.prototype.setHeight=function(){o.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},e.prototype.batchDraw=function(){var t=this;return this._waitingForDraw||(this._waitingForDraw=!0,o.Util.requestAnimFrame((function(){t.draw(),t._waitingForDraw=!1}))),this},e.prototype.getIntersection=function(t,e){var r,n,i,o;if(!this.isListening()||!this.isVisible())return null;for(var a=1,s=!1;;){for(n=0;n<f;n++){if(i=p[n],(o=(r=this._getIntersection({x:t.x+i.x*a,y:t.y+i.y*a})).shape)&&e)return o.findAncestor(e,!0);if(o)return o;if(s=!!r.antialiased,!r.antialiased)break}if(!s)return null;a+=1}},e.prototype._getIntersection=function(t){var e,r,n=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*n),Math.round(t.y*n),1,1).data,a=i[3];return 255===a?(e=o.Util._rgbToHex(i[0],i[1],i[2]),(r=u.shapes["#"+e])?{shape:r}:{antialiased:!0}):a>0?{antialiased:!0}:{}},e.prototype.drawScene=function(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),a.Container.prototype.drawScene.call(this,n,e),this._fire("draw",{node:this}),this},e.prototype.drawHit=function(t,e){var r=this.getLayer(),n=t||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),a.Container.prototype.drawHit.call(this,n,e),this},e.prototype.enableHitGraph=function(){return this.hitGraphEnabled(!0),this},e.prototype.disableHitGraph=function(){return this.hitGraphEnabled(!1),this},e.prototype.setHitGraphEnabled=function(t){o.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)},e.prototype.getHitGraphEnabled=function(t){return o.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()},e.prototype.toggleHitCanvas=function(){if(this.parent){var t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}},e}(a.Container);e.Layer=g,g.prototype.nodeType="Layer",d._registerNode(g),l.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),l.Factory.addGetterSetter(g,"clearBeforeDraw",!0),l.Factory.addGetterSetter(g,"hitGraphEnabled",!0,h.getBooleanValidator()),o.Collection.mapMethods(g)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(20),s=r(8),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._validateAdd=function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&o.Util.throw("You may only add groups and shapes to groups.")},e}(a.Container);e.Group=l,l.prototype.nodeType="Group",s._registerNode(l),o.Collection.mapMethods(l)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=n.glob.performance&&n.glob.performance.now?function(){return n.glob.performance.now()}:function(){return(new Date).getTime()},o=function(){function t(e,r){this.id=t.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:i(),frameRate:0},this.func=e,this.setLayers(r)}return t.prototype.setLayers=function(t){var e=[];return e=t?t.length>0?t:[t]:[],this.layers=e,this},t.prototype.getLayers=function(){return this.layers},t.prototype.addLayer=function(t){var e,r=this.layers,n=r.length;for(e=0;e<n;e++)if(r[e]._id===t._id)return!1;return this.layers.push(t),!0},t.prototype.isRunning=function(){var e,r=t.animations,n=r.length;for(e=0;e<n;e++)if(r[e].id===this.id)return!0;return!1},t.prototype.start=function(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=i(),t._addAnimation(this),this},t.prototype.stop=function(){return t._removeAnimation(this),this},t.prototype._updateFrameObject=function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff},t._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},t._removeAnimation=function(t){var e,r=t.id,n=this.animations,i=n.length;for(e=0;e<i;e++)if(n[e].id===r){this.animations.splice(e,1);break}},t._runFrames=function(){var t,e,r,n,o,a,s,l,c={},h=this.animations;for(n=0;n<h.length;n++)if(e=(t=h[n]).layers,r=t.func,t._updateFrameObject(i()),a=e.length,!r||!1!==r.call(t,t.frame))for(o=0;o<a;o++)void 0!==(s=e[o])._id&&(c[s._id]=s);for(l in c)c.hasOwnProperty(l)&&c[l].draw()},t._animationLoop=function(){var e=t;e.animations.length?(e._runFrames(),requestAnimationFrame(e._animationLoop)):e.animRunning=!1},t._handleAnimation=function(){this.animRunning||(this.animRunning=!0,requestAnimationFrame(this._animationLoop))},t.animations=[],t.animIdCounter=0,t.animRunning=!1,t}();e.Animation=o},function(t,e,r){(function(r){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){"use strict";function e(t,e,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){a(n.response,e,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,a=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype?function(t,r,a){var s=o.URL||o.webkitURL,l=document.createElement("a");r=r||t.name||"download",l.download=r,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?i(l):n(l.href)?e(t,r,a):i(l,l.target="_blank")):(l.href=s.createObjectURL(t),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,o){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,o),r);else if(n(t))e(t,r,o);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){i(a)}))}}:function(t,r,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return e(t,r,n);var a="application/octet-stream"===t.type,s=/constructor/i.test(o.HTMLElement)||o.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},c.readAsDataURL(t)}else{var h=o.URL||o.webkitURL,u=h.createObjectURL(t);i?i.location=u:location.href=u,i=null,setTimeout((function(){h.revokeObjectURL(u)}),4e4)}});o.saveAs=a.saveAs=a,t.exports=a})?n.apply(e,i):n)||(t.exports=o)}).call(this,r(18))},function(t,e,r){var n=r(82),i=r(83),o=r(84),a=r(86);t.exports=function(t,e){return n(t)||i(t,e)||o(t,e)||a()}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(14),l=r(8),c=r(13),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._sceneFunc=function(t){var e=this.cornerRadius(),r=this.width(),n=this.height();if(t.beginPath(),e){var i=0,o=0,a=0,s=0;"number"==typeof e?i=o=a=s=Math.min(e,r/2,n/2):(i=Math.min(e[0]||0,r/2,n/2),o=Math.min(e[1]||0,r/2,n/2),s=Math.min(e[2]||0,r/2,n/2),a=Math.min(e[3]||0,r/2,n/2)),t.moveTo(i,0),t.lineTo(r-o,0),t.arc(r-o,o,o,3*Math.PI/2,0,!1),t.lineTo(r,n-s),t.arc(r-s,n-s,s,0,Math.PI/2,!1),t.lineTo(a,n),t.arc(a,n-a,a,Math.PI/2,Math.PI,!1),t.lineTo(0,i),t.arc(i,i,i,Math.PI,3*Math.PI/2,!1)}else t.rect(0,0,r,n);t.closePath(),t.fillStrokeShape(this)},e}(s.Shape);e.Rect=h,h.prototype.className="Rect",l._registerNode(h),a.Factory.addGetterSetter(h,"cornerRadius",0,c.getNumberOrArrayOfNumbersValidator(4)),o.Collection.mapMethods(h)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(14),l=r(8),c=r(13),h=r(8);function u(t){return Array.from(t)}e.stringToArray=u;var d,p="Change.konva",f="2d",g=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],y=g.length;function v(){return d||(d=o.Util.createCanvasElement().getContext(f))}var m=function(t){function e(e){var r=t.call(this,function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(e))||this;r._partialTextX=0,r._partialTextY=0;for(var n=0;n<y;n++)r.on(g[n]+p,r._setTextData);return r._setTextData(),r}return i(e,t),e.prototype._sceneFunc=function(t){var e,r=this.padding(),n=this.fontSize(),i=this.lineHeight()*n,o=this.textArr,a=o.length,s=this.verticalAlign(),l=0,c=this.align(),h=this.getWidth(),d=this.letterSpacing(),p=this.fill(),f=this.textDecoration(),g=-1!==f.indexOf("underline"),y=-1!==f.indexOf("line-through"),v=0,m=(v=i/2,0),w=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline","middle"),t.setAttr("textAlign","left"),"middle"===s?l=(this.getHeight()-a*i-2*r)/2:"bottom"===s&&(l=this.getHeight()-a*i-2*r),t.translate(r,l+r),e=0;e<a;e++){m=0,w=0;var b,_,x,C=o[e],k=C.text,S=C.width,D=e!==a-1;if(t.save(),"right"===c?m+=h-S-2*r:"center"===c&&(m+=(h-S-2*r)/2),g&&(t.save(),t.beginPath(),t.moveTo(m,v+w+Math.round(n/2)),_=0===(b=k.split(" ").length-1),x="justify"===c&&D&&!_?h-2*r:S,t.lineTo(m+Math.round(x),v+w+Math.round(n/2)),t.lineWidth=n/15,t.strokeStyle=p,t.stroke(),t.restore()),y&&(t.save(),t.beginPath(),t.moveTo(m,v+w),_=0===(b=k.split(" ").length-1),x="justify"===c&&D&&!_?h-2*r:S,t.lineTo(m+Math.round(x),v+w),t.lineWidth=n/15,t.strokeStyle=p,t.stroke(),t.restore()),0!==d||"justify"===c){b=k.split(" ").length-1;for(var P=u(k),T=0;T<P.length;T++){var O=P[T];" "===O&&e!==a-1&&"justify"===c&&(m+=(h-2*r-S)/b),this._partialTextX=m,this._partialTextY=v+w,this._partialText=O,t.fillStrokeShape(this),m+=this.measureSize(O).width+d}}else this._partialTextX=m,this._partialTextY=v+w,this._partialText=k,t.fillStrokeShape(this);t.restore(),a>1&&(v+=i)}},e.prototype._hitFunc=function(t){var e=this.getWidth(),r=this.getHeight();t.beginPath(),t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)},e.prototype.setText=function(t){var e=o.Util._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this},e.prototype.getWidth=function(){return"auto"===this.attrs.width||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width},e.prototype.getHeight=function(){return"auto"===this.attrs.height||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height},e.prototype.getTextWidth=function(){return this.textWidth},e.prototype.getTextHeight=function(){return o.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},e.prototype.measureSize=function(t){var e,r=v(),n=this.fontSize();return r.save(),r.font=this._getContextFont(),e=r.measureText(t),r.restore(),{width:e.width,height:n}},e.prototype._getContextFont=function(){return l.Konva.UA.isIE?this.fontStyle()+" "+this.fontSize()+"px "+this.fontFamily():this.fontStyle()+" "+this.fontVariant()+" "+this.fontSize()+"px "+this.fontFamily().split(",").map((function(t){var e=(t=t.trim()).indexOf(" ")>=0,r=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!r&&(t='"'+t+'"'),t})).join(", ")},e.prototype._addTextLine=function(t){"justify"===this.align()&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e})},e.prototype._getTextWidth=function(t){var e=this.letterSpacing(),r=t.length;return v().measureText(t).width+(r?e*(r-1):0)},e.prototype._setTextData=function(){var t=this.text().split("\n"),e=+this.fontSize(),r=0,n=this.lineHeight()*e,i=this.attrs.width,o=this.attrs.height,a="auto"!==i&&void 0!==i,s="auto"!==o&&void 0!==o,l=this.padding(),c=i-2*l,h=o-2*l,u=0,d=this.wrap(),p="none"!==d,f="char"!==d&&p,g=this.ellipsis();this.textArr=[],v().font=this._getContextFont();for(var y=g?this._getTextWidth("…"):0,m=0,w=t.length;m<w;++m){var b=t[m],_=this._getTextWidth(b);if(a&&_>c)for(;b.length>0;){for(var x=0,C=b.length,k="",S=0;x<C;){var D=x+C>>>1,P=b.slice(0,D+1),T=this._getTextWidth(P)+y;T<=c?(x=D+1,k=P+(g?"…":""),S=T):C=D}if(!k)break;if(f){var O,L=b[k.length];(O=(" "===L||"-"===L)&&S<=c?k.length:Math.max(k.lastIndexOf(" "),k.lastIndexOf("-"))+1)>0&&(x=O,k=k.slice(0,x),S=this._getTextWidth(k))}if(k=k.trimRight(),this._addTextLine(k),r=Math.max(r,S),u+=n,!p||s&&u+n>h){var M=this.textArr[this.textArr.length-1];if(M)if(g)this._getTextWidth(M.text+"…")<c||(M.text=M.text.slice(0,M.text.length-3)),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(M.text+"…");break}if((b=(b=b.slice(x)).trimLeft()).length>0&&(_=this._getTextWidth(b))<=c){this._addTextLine(b),u+=n,r=Math.max(r,_);break}}else this._addTextLine(b),u+=n,r=Math.max(r,_);if(s&&u+n>h)break}this.textHeight=e,this.textWidth=r},e.prototype.getStrokeScaleEnabled=function(){return!0},e}(s.Shape);e.Text=m,m.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},m.prototype._strokeFunc=function(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},m.prototype.className="Text",m.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight"],h._registerNode(m),a.Factory.overWriteSetter(m,"width",c.getNumberOrAutoValidator()),a.Factory.overWriteSetter(m,"height",c.getNumberOrAutoValidator()),a.Factory.addGetterSetter(m,"fontFamily","Arial"),a.Factory.addGetterSetter(m,"fontSize",12,c.getNumberValidator()),a.Factory.addGetterSetter(m,"fontStyle","normal"),a.Factory.addGetterSetter(m,"fontVariant","normal"),a.Factory.addGetterSetter(m,"padding",0,c.getNumberValidator()),a.Factory.addGetterSetter(m,"align","left"),a.Factory.addGetterSetter(m,"verticalAlign","top"),a.Factory.addGetterSetter(m,"lineHeight",1,c.getNumberValidator()),a.Factory.addGetterSetter(m,"wrap","word"),a.Factory.addGetterSetter(m,"ellipsis",!1,c.getBooleanValidator()),a.Factory.addGetterSetter(m,"letterSpacing",0,c.getNumberValidator()),a.Factory.addGetterSetter(m,"text","",c.getStringValidator()),a.Factory.addGetterSetter(m,"textDecoration",""),o.Collection.mapMethods(m)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(14),l=r(34),c=r(13),h=r(8),u=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width"],d=u.length,p=function(t){function e(e){var r=t.call(this,e)||this;return r.on("add.konva",(function(t){this._addListeners(t.child),this._sync()})),r}return i(e,t),e.prototype.getText=function(){return this.find("Text")[0]},e.prototype.getTag=function(){return this.find("Tag")[0]},e.prototype._addListeners=function(t){var e,r=this,n=function(){r._sync()};for(e=0;e<d;e++)t.on(u[e]+"Change.konva",n)},e.prototype.getWidth=function(){return this.getText().width()},e.prototype.getHeight=function(){return this.getText().height()},e.prototype._sync=function(){var t,e,r,n,i,o,a,s=this.getText(),l=this.getTag();if(s&&l){switch(t=s.width(),e=s.height(),r=l.pointerDirection(),n=l.pointerWidth(),a=l.pointerHeight(),i=0,o=0,r){case"up":i=t/2,o=-1*a;break;case"right":i=t+n,o=e/2;break;case"down":i=t/2,o=e+a;break;case"left":i=-1*n,o=e/2}l.setAttrs({x:-1*i,y:-1*o,width:t,height:e}),s.setAttrs({x:-1*i,y:-1*o})}},e}(l.Group);e.Label=p,p.prototype.className="Label",h._registerNode(p),o.Collection.mapMethods(p);var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._sceneFunc=function(t){var e=this.width(),r=this.height(),n=this.pointerDirection(),i=this.pointerWidth(),o=this.pointerHeight(),a=this.cornerRadius(),s=0,l=0,c=0,h=0;"number"==typeof a?s=l=c=h=Math.min(a,e/2,r/2):(s=Math.min(a[0]||0,e/2,r/2),l=Math.min(a[1]||0,e/2,r/2),h=Math.min(a[2]||0,e/2,r/2),c=Math.min(a[3]||0,e/2,r/2)),t.beginPath(),t.moveTo(s,0),"up"===n&&(t.lineTo((e-i)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+i)/2,0)),t.lineTo(e-l,0),t.arc(e-l,l,l,3*Math.PI/2,0,!1),"right"===n&&(t.lineTo(e,(r-o)/2),t.lineTo(e+i,r/2),t.lineTo(e,(r+o)/2)),t.lineTo(e,r-h),t.arc(e-h,r-h,h,0,Math.PI/2,!1),"down"===n&&(t.lineTo((e+i)/2,r),t.lineTo(e/2,r+o),t.lineTo((e-i)/2,r)),t.lineTo(c,r),t.arc(c,r-c,c,Math.PI/2,Math.PI,!1),"left"===n&&(t.lineTo(0,(r+o)/2),t.lineTo(-1*i,r/2),t.lineTo(0,(r-o)/2)),t.lineTo(0,s),t.arc(s,s,s,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)},e.prototype.getSelfRect=function(){var t=0,e=0,r=this.pointerWidth(),n=this.pointerHeight(),i=this.pointerDirection(),o=this.width(),a=this.height();return"up"===i?(e-=n,a+=n):"down"===i?a+=n:"left"===i?(t-=1.5*r,o+=r):"right"===i&&(o+=1.5*r),{x:t,y:e,width:o,height:a}},e}(s.Shape);e.Tag=f,f.prototype.className="Tag",h._registerNode(f),a.Factory.addGetterSetter(f,"pointerDirection","none"),a.Factory.addGetterSetter(f,"pointerWidth",0,c.getNumberValidator()),a.Factory.addGetterSetter(f,"pointerHeight",0,c.getNumberValidator()),a.Factory.addGetterSetter(f,"cornerRadius",0,c.getNumberOrArrayOfNumbersValidator(4)),o.Collection.mapMethods(f)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(14),l=r(13),c=r(8),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype._useBufferCanvas=function(){return t.prototype._useBufferCanvas.call(this,!0)},e.prototype._sceneFunc=function(t){var e,r,n,i=this.getWidth(),o=this.getHeight(),a=this.attrs.image;a&&(e=this.attrs.cropWidth,r=this.attrs.cropHeight,n=e&&r?[a,this.cropX(),this.cropY(),e,r,0,0,i,o]:[a,0,0,i,o]),(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,i,o),t.closePath(),t.fillStrokeShape(this)),a&&t.drawImage.apply(t,n)},e.prototype._hitFunc=function(t){var e=this.width(),r=this.height();t.beginPath(),t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:(null===(e=this.image())||void 0===e?void 0:e.width)||0},e.prototype.getHeight=function(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:(null===(e=this.image())||void 0===e?void 0:e.height)||0},e.fromURL=function(t,r){var n=o.Util.createImageElement();n.onload=function(){var t=new e({image:n});r(t)},n.crossOrigin="Anonymous",n.src=t},e}(s.Shape);e.Image=h,h.prototype.className="Image",c._registerNode(h),a.Factory.addGetterSetter(h,"image"),a.Factory.addComponentsGetterSetter(h,"crop",["x","y","width","height"]),a.Factory.addGetterSetter(h,"cropX",0,l.getNumberValidator()),a.Factory.addGetterSetter(h,"cropY",0,l.getNumberValidator()),a.Factory.addGetterSetter(h,"cropWidth",0,l.getNumberValidator()),a.Factory.addGetterSetter(h,"cropHeight",0,l.getNumberValidator()),o.Collection.mapMethods(h)},function(t,e,r){"use strict";var n=r(11),i=r(24),o=r(44),a=r(22);function s(t){var e=new o(t),r=i(o.prototype.request,e);return n.extend(r,o.prototype,e),n.extend(r,e),r}var l=s(a);l.Axios=o,l.create=function(t){return s(n.merge(a,t))},l.Cancel=r(28),l.CancelToken=r(58),l.isCancel=r(27),l.all=function(t){return Promise.all(t)},l.spread=r(59),t.exports=l,t.exports.default=l},function(t,e){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,r){"use strict";var n=r(22),i=r(11),o=r(53),a=r(54);function s(t){this.defaults=t,this.interceptors={request:new o,response:new o}}s.prototype.request=function(t){"string"==typeof t&&(t=i.merge({url:arguments[0]},arguments[1])),(t=i.merge(n,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[a,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)r=r.then(e.shift(),e.shift());return r},i.forEach(["delete","get","head","options"],(function(t){s.prototype[t]=function(e,r){return this.request(i.merge(r||{},{method:t,url:e}))}})),i.forEach(["post","put","patch"],(function(t){s.prototype[t]=function(e,r,n){return this.request(i.merge(n||{},{method:t,url:e,data:r}))}})),t.exports=s},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&p())}function p(){if(!h){var t=s(d);h=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||h||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){"use strict";var n=r(11);t.exports=function(t,e){n.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}},function(t,e,r){"use strict";var n=r(26);t.exports=function(t,e,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,i){return t.config=e,r&&(t.code=r),t.request=n,t.response=i,t}},function(t,e,r){"use strict";var n=r(11);function i(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var o;if(r)o=r(e);else if(n.isURLSearchParams(e))o=e.toString();else{var a=[];n.forEach(e,(function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,(function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),a.push(i(e)+"="+i(t))})))})),o=a.join("&")}return o&&(t+=(-1===t.indexOf("?")?"?":"&")+o),t}},function(t,e,r){"use strict";var n=r(11),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,o,a={};return t?(n.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=n.trim(t.substr(0,o)).toLowerCase(),r=n.trim(t.substr(o+1)),e){if(a[e]&&i.indexOf(e)>=0)return;a[e]="set-cookie"===e?(a[e]?a[e]:[]).concat([r]):a[e]?a[e]+", "+r:r}})),a):a}},function(t,e,r){"use strict";var n=r(11);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(e){var r=n.isString(e)?i(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n=r(11);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,i,o,a){var s=[];s.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(i)&&s.push("path="+i),n.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";var n=r(11);function i(){this.handlers=[]}i.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},i.prototype.forEach=function(t){n.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=i},function(t,e,r){"use strict";var n=r(11),i=r(55),o=r(27),a=r(22),s=r(56),l=r(57);function c(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return c(t),t.baseURL&&!s(t.url)&&(t.url=l(t.baseURL,t.url)),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||a.adapter)(t).then((function(e){return c(t),e.data=i(e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(c(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},function(t,e,r){"use strict";var n=r(11);t.exports=function(t,e,r){return n.forEach(r,(function(r){t=r(t,e)})),t}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(28);function i(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;t((function(t){r.reason||(r.reason=new n(t),e(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var t;return{token:new i((function(e){t=e})),cancel:t}},t.exports=i},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e,r){"use strict";const n=(t,{depth:e=1/0}={})=>e>0?t.reduce((t,r)=>t.concat(Array.isArray(r)?n(r,{depth:e-1}):[r]),[]):t;t.exports=r(29)(n)},function(t,e){t.exports=function(t,e,r,n){var i,o;if("boolean"!=typeof arguments[0]&&(n=r,r=e,e=t,t=!1),!Array.isArray(e))throw new TypeError("must be an array");if(e=t?e:e.slice(0),o=r<0?"unshift":"push",i=Math.abs(r),"number"!=typeof r||i%1!=0)throw new TypeError("length must be an integer");for(;e.length<i;)e[o](n);return e}},function(t,e,r){"use strict";t.exports=function(t,{blacklist:e}={}){const r=typeof t;return"function"===r?t:"undefined"===r?e?t=>!t:t=>!!t:Array.isArray(t)?e=>t.includes(e):e=>e===t}},function(t,e,r){"use strict";(function(e){const r=void 0!==e,n="undefined"!=typeof window;t.exports=t=>r&&t===e||n&&t===window}).call(this,r(18))},function(t,e,r){"use strict";t.exports=function(t){return null==t}},function(t,e,r){"use strict";t.exports=function(t){return"object"==typeof t&&null!==t}},function(t,e,r){"use strict";const n=r(70),i=r(30);t.exports=function(t,e){if(!Array.isArray(t))throw new TypeError("ofn argument 1 must be an array");if(n(t))throw new Error("ofn argument 1 array cannot have duplicates");if(t.some(t=>!Number.isInteger(t)))throw new TypeError("ofn argument 1 array must contain only numbers");if(t.some(e=>e<0||e>=t.length))throw new RangeError("ofn argument 1 array has a number out of range");if("function"!=typeof e)throw new TypeError("ofn argument 2 must be a function");return i(e,(function(){const r=[],n=t.slice(0,arguments.length).sort();for(let t=0;t<arguments.length;t++)r[t<n.length?n[t]:t]=arguments[t];return e.apply(this,r)}))}},function(t,e,r){"use strict";t.exports=function(t){return new Set(t).size<t.length}},function(t,e,r){"use strict";t.exports=function(t,e={},{enumOnly:r,override:n=!0,overwrite:i=!0}={}){for(const o of(r?Object.keys:Reflect.ownKeys)(t))!i&&Object.prototype.hasOwnProperty.call(e,o)||!n&&o in e||Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o));return e}},function(t,e){t.exports=function(t,e,r){if(!Array.isArray(e)||!t.toString)throw new TypeError;t=t.toString(),r=void 0===r||!!r;var n=e.length;if(0===n)throw new Error("Cannot create an English list of an empty array");if(1===n)return e[0].toString();if(2===n)return e[0].toString()+" "+t+" "+e[1].toString();var i=e.map((function(t){return t.toString()})),o=i.slice(0,n-1),a=i[n-1];return o.join(", ")+(r?", ":" ")+t+" "+a}},function(t,e,r){"use strict";t.exports=(t,e,r)=>1==+t?e:r},function(t,e,r){"use strict";const n=r(75);t.exports=(t,e)=>n(e)?e:void 0===e?{}:{[t]:e}},function(t,e,r){"use strict";
/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var n=r(76);function i(t){return!0===n(t)&&"[object Object]"===Object.prototype.toString.call(t)}t.exports=function(t){var e,r;return!1!==i(t)&&("function"==typeof(e=t.constructor)&&(!1!==i(r=e.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))}},function(t,e,r){"use strict";
/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */t.exports=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)}},function(t,e,r){"use strict";const n=r(78),i=["__proto__","prototype","constructor"],o=t=>!t.some(t=>i.includes(t));function a(t){const e=t.split("."),r=[];for(let t=0;t<e.length;t++){let n=e[t];for(;"\\"===n[n.length-1]&&void 0!==e[t+1];)n=n.slice(0,-1)+".",n+=e[++t];r.push(n)}return o(r)?r:[]}t.exports={get(t,e,r){if(!n(t)||"string"!=typeof e)return void 0===r?t:r;const i=a(e);if(0!==i.length){for(let e=0;e<i.length;e++){if(!Object.prototype.propertyIsEnumerable.call(t,i[e]))return r;if(null==(t=t[i[e]])){if(e!==i.length-1)return r;break}}return t}},set(t,e,r){if(!n(t)||"string"!=typeof e)return t;const i=t,o=a(e);if(0!==o.length){for(let e=0;e<o.length;e++){const i=o[e];n(t[i])||(t[i]={}),e===o.length-1&&(t[i]=r),t=t[i]}return i}},delete(t,e){if(!n(t)||"string"!=typeof e)return;const r=a(e);for(let e=0;e<r.length;e++){const i=r[e];if(e===r.length-1)return void delete t[i];if(t=t[i],!n(t))return}},has(t,e){if(!n(t)||"string"!=typeof e)return!1;const r=a(e);for(let e=0;e<r.length;e++){if(!n(t))return!1;if(!(r[e]in t))return!1;t=t[r[e]]}return!0}}},function(t,e,r){"use strict";t.exports=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}},function(t,e,r){"use strict";(function(e){
/**
 * filesize
 *
 * @copyright 2019 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 4.2.1
 */
!function(e){var r=/^(b|B)$/,n={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},i={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};function o(t){var e,o,a,s,l,c,h,u,d,p,f,g,y,v,m,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=[],_=0,x=void 0,C=void 0;if(isNaN(t))throw new TypeError("Invalid number");return o=!0===w.bits,f=!0===w.unix,e=w.base||2,p=void 0!==w.round?w.round:f?1:2,c=void 0!==w.locale?w.locale:"",h=w.localeOptions||{},g=void 0!==w.separator?w.separator:"",y=void 0!==w.spacer?w.spacer:f?"":" ",m=w.symbols||{},v=2===e&&w.standard||"jedec",d=w.output||"string",s=!0===w.fullform,l=w.fullforms instanceof Array?w.fullforms:[],x=void 0!==w.exponent?w.exponent:-1,a=e>2?1e3:1024,(u=(C=Number(t))<0)&&(C=-C),(-1===x||isNaN(x))&&(x=Math.floor(Math.log(C)/Math.log(a)))<0&&(x=0),x>8&&(x=8),"exponent"===d?x:(0===C?(b[0]=0,b[1]=f?"":n[v][o?"bits":"bytes"][x]):(_=C/(2===e?Math.pow(2,10*x):Math.pow(1e3,x)),o&&(_*=8)>=a&&x<8&&(_/=a,x++),b[0]=Number(_.toFixed(x>0?p:0)),b[0]===a&&x<8&&void 0===w.exponent&&(b[0]=1,x++),b[1]=10===e&&1===x?o?"kb":"kB":n[v][o?"bits":"bytes"][x],f&&(b[1]="jedec"===v?b[1].charAt(0):x>0?b[1].replace(/B$/,""):b[1],r.test(b[1])&&(b[0]=Math.floor(b[0]),b[1]=""))),u&&(b[0]=-b[0]),b[1]=m[b[1]]||b[1],!0===c?b[0]=b[0].toLocaleString():c.length>0?b[0]=b[0].toLocaleString(c,h):g.length>0&&(b[0]=b[0].toString().replace(".",g)),"array"===d?b:(s&&(b[1]=l[x]?l[x]:i[v][x]+(o?"bit":"byte")+(1===b[0]?"":"s")),"object"===d?{value:b[0],symbol:b[1]}:b.join(y)))}o.partial=function(t){return function(e){return o(e,t)}},t.exports=o}("undefined"!=typeof window&&window)}).call(this,r(18))},function(t,e,r){var n=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,o=Object.create(i.prototype),a=new P(n||[]);return o._invoke=function(t,e,r){var n=h;return function(i,o){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return O()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var l=c(t,e,r);if("normal"===l.type){if(n=r.done?p:u,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(t,r,a),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var h="suspendedStart",u="suspendedYield",d="executing",p="completed",f={};function g(){}function y(){}function v(){}var m={};m[o]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(T([])));b&&b!==r&&n.call(b,o)&&(m=b);var _=v.prototype=g.prototype=Object.create(m);function x(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function C(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,s){var l=c(t[i],t,o);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(u).then((function(t){h.value=t,a(h)}),(function(t){return r("throw",t,a,s)}))}s(l.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function k(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,k(t,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var i=c(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function T(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:O}}function O(){return{value:e,done:!0}}return y.prototype=_.constructor=v,v.constructor=y,v[s]=y.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},x(C.prototype),C.prototype[a]=function(){return this},t.AsyncIterator=C,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new C(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(_),_[s]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=T,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),D(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;D(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){var r,n;
/*!
	Wheelzoom 4.0.0
	license: MIT
	http://www.jacklmoore.com/wheelzoom
*/
window.wheelzoom=(r={zoom:.1,maxZoom:!1,initialZoom:1},n=function(t,e){if(t&&t.nodeName&&"IMG"===t.nodeName){var n,i,o,a,s,l,c,h,u={},d=function(e){t.removeEventListener("wheelzoom.destroy",d),t.removeEventListener("wheelzoom.reset",f),t.removeEventListener("load",w),t.removeEventListener("mouseup",v),t.removeEventListener("mousemove",y),t.removeEventListener("mousedown",m),t.removeEventListener("wheel",g),t.style.backgroundImage=e.backgroundImage,t.style.backgroundRepeat=e.backgroundRepeat,t.src=e.src}.bind(null,{backgroundImage:t.style.backgroundImage,backgroundRepeat:t.style.backgroundRepeat,src:t.src});t.addEventListener("wheelzoom.destroy",d),e=e||{},Object.keys(r).forEach((function(t){u[t]=void 0!==e[t]?e[t]:r[t]})),t.complete&&w(),t.addEventListener("load",w)}function p(){s>0?s=0:s<n-o&&(s=n-o),l>0?l=0:l<i-a&&(l=i-a),t.style.backgroundSize=o+"px "+a+"px",t.style.backgroundPosition=s+"px "+l+"px"}function f(){o=n,a=i,s=l=0,p()}function g(e){var r=0;e.preventDefault(),e.deltaY?r=e.deltaY:e.wheelDelta&&(r=-e.wheelDelta);var c=t.getBoundingClientRect(),h=e.pageX-c.left-window.pageXOffset,d=e.pageY-c.top-window.pageYOffset,g=(h-s)/o,y=(d-l)/a;r<0?(o+=o*u.zoom,a+=a*u.zoom):(o-=o*u.zoom,a-=a*u.zoom),u.maxZoom&&(o=Math.min(n*u.maxZoom,o),a=Math.min(i*u.maxZoom,a)),s=h-o*g,l=d-a*y,o<=n||a<=i?f():p()}function y(t){t.preventDefault(),t.stopPropagation(),s+=t.pageX-c.pageX,l+=t.pageY-c.pageY,c=t,p()}function v(t){t.stopPropagation(),t.preventDefault(),document.removeEventListener("mouseup",v),document.removeEventListener("mousemove",y)}function m(t){t.preventDefault(),c=t,document.addEventListener("mousemove",y),document.addEventListener("mouseup",v)}function w(){var e=Math.max(u.initialZoom,1);if(t.src!==h){var r=window.getComputedStyle(t,null);n=parseInt(r.width,10),i=parseInt(r.height,10),s=-((o=n*e)-n)/2,l=-((a=i*e)-i)/2,function(t){t.style.backgroundRepeat="no-repeat",t.style.backgroundImage='url("'+t.src+'")',h="data:image/svg+xml;base64,"+window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="'+t.naturalWidth+'" height="'+t.naturalHeight+'"></svg>'),t.src=h}(t),t.style.backgroundSize=o+"px "+a+"px",t.style.backgroundPosition=s+"px "+l+"px",t.addEventListener("wheelzoom.reset",f),t.addEventListener("wheel",g),t.addEventListener("mousedown",m)}}},"function"!=typeof window.btoa?function(t){return t}:function(t,e){return t&&t.length?Array.prototype.forEach.call(t,n,e):t&&t.nodeName&&n(t,e),t})},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}},function(t,e,r){var n=r(85);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=r(9),o=r(16),a=r(20),s=r(88),l=r(33),c=r(89),h=r(34),u=r(23),d=r(14),p=r(35),f=r(90),g=r(31),y=r(19);e.Konva=i.Util._assign(n.Konva,{Collection:i.Collection,Util:i.Util,Transform:i.Transform,Node:o.Node,ids:o.ids,names:o.names,Container:a.Container,Stage:s.Stage,stages:s.stages,Layer:l.Layer,FastLayer:c.FastLayer,Group:h.Group,DD:u.DD,Shape:d.Shape,shapes:d.shapes,Animation:p.Animation,Tween:f.Tween,Easings:f.Easings,Context:g.Context,Canvas:y.Canvas})},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(12),s=r(20),l=r(8),c=r(19),h=r(23),u=r(8),d=r(32),p="_",f=["mouseenter","mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend","mouseover","wheel","contextmenu","pointerdown","pointermove","pointerup","pointercancel","lostpointercapture"],g=f.length;function y(t,e){t.content.addEventListener(e,(function(r){t[p+e](r)}),!1)}function v(t){return void 0===t&&(t={}),(t.clipFunc||t.clipWidth||t.clipHeight)&&o.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}e.stages=[];var m=function(t){function r(r){var n=t.call(this,v(r))||this;return n._pointerPositions=[],n._changedPointerPositions=[],n._buildDOM(),n._bindContentEvents(),e.stages.push(n),n.on("widthChange.konva heightChange.konva",n._resizeDOM),n.on("visibleChange.konva",n._checkVisibility),n.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(function(){v(n.attrs)})),n._checkVisibility(),n}return i(r,t),r.prototype._validateAdd=function(t){var e="Layer"===t.getType(),r="FastLayer"===t.getType();e||r||o.Util.throw("You may only add layers to the stage.")},r.prototype._checkVisibility=function(){if(this.content){var t=this.visible()?"":"none";this.content.style.display=t}},r.prototype.setContainer=function(t){if("string"==typeof t){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var r;r="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(r)}if(!t)throw"Can not find container in document with id "+r}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this},r.prototype.shouldDrawHit=function(){return!0},r.prototype.clear=function(){var t,e=this.children,r=e.length;for(t=0;t<r;t++)e[t].clear();return this},r.prototype.clone=function(t){return t||(t={}),t.container=document.createElement("div"),s.Container.prototype.clone.call(this,t)},r.prototype.destroy=function(){t.prototype.destroy.call(this);var r=this.content;r&&o.Util._isInDocument(r)&&this.container().removeChild(r);var n=e.stages.indexOf(this);return n>-1&&e.stages.splice(n,1),this},r.prototype.getPointerPosition=function(){var t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(o.Util.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)},r.prototype._getPointerById=function(t){return this._pointerPositions.find((function(e){return e.id===t}))},r.prototype.getPointersPositions=function(){return this._pointerPositions},r.prototype.getStage=function(){return this},r.prototype.getContent=function(){return this.content},r.prototype._toKonvaCanvas=function(t){var e=(t=t||{}).x||0,r=t.y||0,n=new c.SceneCanvas({width:t.width||this.width(),height:t.height||this.height(),pixelRatio:t.pixelRatio||1}),i=n.getContext()._context,o=this.children;return(e||r)&&i.translate(-1*e,-1*r),o.each((function(n){if(n.isVisible()){var o=n._toKonvaCanvas(t);i.drawImage(o._canvas,e,r,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}})),n},r.prototype.getIntersection=function(t,e){if(!t)return null;var r,n,i=this.children;for(r=i.length-1;r>=0;r--)if(n=i[r].getIntersection(t,e))return n;return null},r.prototype._resizeDOM=function(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.each((function(r){r.setSize({width:t,height:e}),r.draw()}))},r.prototype.add=function(e){if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}t.prototype.add.call(this,e);var n=this.children.length;return n>5&&o.Util.warn("The stage has "+n+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),l.Konva.isBrowser&&this.content.appendChild(e.canvas._canvas),this},r.prototype.getParent=function(){return null},r.prototype.getLayer=function(){return null},r.prototype.hasPointerCapture=function(t){return d.hasPointerCapture(t,this)},r.prototype.setPointerCapture=function(t){d.setPointerCapture(t,this)},r.prototype.releaseCapture=function(t){d.releaseCapture(t,this)},r.prototype.getLayers=function(){return this.getChildren()},r.prototype._bindContentEvents=function(){if(l.Konva.isBrowser)for(var t=0;t<g;t++)y(this,f[t])},r.prototype._mouseenter=function(t){this.setPointersPositions(t),this._fire("mouseenter",{evt:t,target:this,currentTarget:this})},r.prototype._mouseover=function(t){this.setPointersPositions(t),this._fire("contentMouseover",{evt:t}),this._fire("mouseover",{evt:t,target:this,currentTarget:this})},r.prototype._mouseout=function(t){var e;this.setPointersPositions(t);var r=(null===(e=this.targetShape)||void 0===e?void 0:e.getStage())?this.targetShape:null,n=!h.DD.isDragging||l.Konva.hitOnDragEnabled;r&&n?(r._fireAndBubble("mouseout",{evt:t}),r._fireAndBubble("mouseleave",{evt:t}),this._fire("mouseleave",{evt:t,target:this,currentTarget:this}),this.targetShape=null):n&&(this._fire("mouseleave",{evt:t,target:this,currentTarget:this}),this._fire("mouseout",{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[],this._fire("contentMouseout",{evt:t})},r.prototype._mousemove=function(t){var e;if(l.Konva.UA.ieMobile)return this._touchmove(t);this.setPointersPositions(t);var r,n=o.Util._getFirstPointerId(t),i=(null===(e=this.targetShape)||void 0===e?void 0:e.getStage())?this.targetShape:null,a=!h.DD.isDragging||l.Konva.hitOnDragEnabled;if(a){if((r=this.getIntersection(this.getPointerPosition()))&&r.isListening())a&&i!==r?(i&&(i._fireAndBubble("mouseout",{evt:t,pointerId:n},r),i._fireAndBubble("mouseleave",{evt:t,pointerId:n},r)),r._fireAndBubble("mouseover",{evt:t,pointerId:n},i),r._fireAndBubble("mouseenter",{evt:t,pointerId:n},i),r._fireAndBubble("mousemove",{evt:t,pointerId:n}),this.targetShape=r):r._fireAndBubble("mousemove",{evt:t,pointerId:n});else i&&a&&(i._fireAndBubble("mouseout",{evt:t,pointerId:n}),i._fireAndBubble("mouseleave",{evt:t,pointerId:n}),this._fire("mouseover",{evt:t,target:this,currentTarget:this,pointerId:n}),this.targetShape=null),this._fire("mousemove",{evt:t,target:this,currentTarget:this,pointerId:n});this._fire("contentMousemove",{evt:t})}t.cancelable&&t.preventDefault()},r.prototype._mousedown=function(t){if(l.Konva.UA.ieMobile)return this._touchstart(t);this.setPointersPositions(t);var e=o.Util._getFirstPointerId(t),r=this.getIntersection(this.getPointerPosition());h.DD.justDragged=!1,l.Konva.listenClickTap=!0,r&&r.isListening()?(this.clickStartShape=r,r._fireAndBubble("mousedown",{evt:t,pointerId:e})):this._fire("mousedown",{evt:t,target:this,currentTarget:this,pointerId:e}),this._fire("contentMousedown",{evt:t})},r.prototype._mouseup=function(t){if(l.Konva.UA.ieMobile)return this._touchend(t);this.setPointersPositions(t);var e=o.Util._getFirstPointerId(t),r=this.getIntersection(this.getPointerPosition()),n=this.clickStartShape,i=this.clickEndShape,a=!1;l.Konva.inDblClickWindow?(a=!0,clearTimeout(this.dblTimeout)):h.DD.justDragged||(l.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout((function(){l.Konva.inDblClickWindow=!1}),l.Konva.dblClickWindow),r&&r.isListening()?(this.clickEndShape=r,r._fireAndBubble("mouseup",{evt:t,pointerId:e}),l.Konva.listenClickTap&&n&&n._id===r._id&&(r._fireAndBubble("click",{evt:t,pointerId:e}),a&&i&&i===r&&r._fireAndBubble("dblclick",{evt:t,pointerId:e}))):(this.clickEndShape=null,this._fire("mouseup",{evt:t,target:this,currentTarget:this,pointerId:e}),l.Konva.listenClickTap&&this._fire("click",{evt:t,target:this,currentTarget:this,pointerId:e}),a&&this._fire("dblclick",{evt:t,target:this,currentTarget:this,pointerId:e})),this._fire("contentMouseup",{evt:t}),l.Konva.listenClickTap&&(this._fire("contentClick",{evt:t}),a&&this._fire("contentDblclick",{evt:t})),l.Konva.listenClickTap=!1,t.cancelable&&t.preventDefault()},r.prototype._contextmenu=function(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble("contextmenu",{evt:t}):this._fire("contextmenu",{evt:t,target:this,currentTarget:this}),this._fire("contentContextmenu",{evt:t})},r.prototype._touchstart=function(t){var e=this;this.setPointersPositions(t);var r=!1;this._changedPointerPositions.forEach((function(n){var i=e.getIntersection(n);l.Konva.listenClickTap=!0,h.DD.justDragged=!1,i&&i.isListening()&&(l.Konva.captureTouchEventsEnabled&&i.setPointerCapture(n.id),e.tapStartShape=i,i._fireAndBubble("touchstart",{evt:t,pointerId:n.id},e),r=!0,i.isListening()&&i.preventDefault()&&t.cancelable&&t.preventDefault())})),r||this._fire("touchstart",{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire("contentTouchstart",{evt:t})},r.prototype._touchmove=function(t){var e=this;if(this.setPointersPositions(t),!h.DD.isDragging||l.Konva.hitOnDragEnabled){var r=!1,n={};this._changedPointerPositions.forEach((function(i){var o=d.getCapturedShape(i.id)||e.getIntersection(i);o&&o.isListening()&&(n[o._id]||(n[o._id]=!0,o._fireAndBubble("touchmove",{evt:t,pointerId:i.id}),r=!0,o.isListening()&&o.preventDefault()&&t.cancelable&&t.preventDefault()))})),r||this._fire("touchmove",{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire("contentTouchmove",{evt:t})}h.DD.isDragging&&h.DD.node.preventDefault()&&t.cancelable&&t.preventDefault()},r.prototype._touchend=function(t){var e=this;this.setPointersPositions(t);var r=this.tapEndShape,n=!1;l.Konva.inDblClickWindow?(n=!0,clearTimeout(this.dblTimeout)):h.DD.justDragged||(l.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout((function(){l.Konva.inDblClickWindow=!1}),l.Konva.dblClickWindow);var i=!1,o={},a=!1,s=!1;this._changedPointerPositions.forEach((function(c){var h=d.getCapturedShape(c.id)||e.getIntersection(c);h&&h.releaseCapture(c.id),h&&h.isListening()&&(o[h._id]||(o[h._id]=!0,e.tapEndShape=h,h._fireAndBubble("touchend",{evt:t,pointerId:c.id}),i=!0,l.Konva.listenClickTap&&h===e.tapStartShape&&(a=!0,h._fireAndBubble("tap",{evt:t,pointerId:c.id}),n&&r&&r===h&&(s=!0,h._fireAndBubble("dbltap",{evt:t,pointerId:c.id}))),h.isListening()&&h.preventDefault()&&t.cancelable&&t.preventDefault()))})),i||this._fire("touchend",{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),l.Konva.listenClickTap&&!a&&(this.tapEndShape=null,this._fire("tap",{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})),n&&!s&&this._fire("dbltap",{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire("contentTouchend",{evt:t}),l.Konva.listenClickTap&&(this._fire("contentTap",{evt:t}),n&&this._fire("contentDbltap",{evt:t})),this.preventDefault()&&t.cancelable&&t.preventDefault(),l.Konva.listenClickTap=!1},r.prototype._wheel=function(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble("wheel",{evt:t}):this._fire("wheel",{evt:t,target:this,currentTarget:this}),this._fire("contentWheel",{evt:t})},r.prototype._pointerdown=function(t){if(l.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=d.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble("pointerdown",d.createEvent(t))}},r.prototype._pointermove=function(t){if(l.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=d.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble("pointermove",d.createEvent(t))}},r.prototype._pointerup=function(t){if(l.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=d.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble("pointerup",d.createEvent(t)),d.releaseCapture(t.pointerId)}},r.prototype._pointercancel=function(t){if(l.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=d.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble("pointerup",d.createEvent(t)),d.releaseCapture(t.pointerId)}},r.prototype._lostpointercapture=function(t){d.releaseCapture(t.pointerId)},r.prototype.setPointersPositions=function(t){var e=this,r=this._getContentPosition(),n=null,i=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],o.Collection.prototype.each.call(t.touches,(function(t){e._pointerPositions.push({id:t.identifier,x:(t.clientX-r.left)/r.scaleX,y:(t.clientY-r.top)/r.scaleY})})),o.Collection.prototype.each.call(t.changedTouches||t.touches,(function(t){e._changedPointerPositions.push({id:t.identifier,x:(t.clientX-r.left)/r.scaleX,y:(t.clientY-r.top)/r.scaleY})}))):(n=(t.clientX-r.left)/r.scaleX,i=(t.clientY-r.top)/r.scaleY,this.pointerPos={x:n,y:i},this._pointerPositions=[{x:n,y:i,id:o.Util._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:i,id:o.Util._getFirstPointerId(t)}])},r.prototype._setPointerPosition=function(t){o.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)},r.prototype._getContentPosition=function(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}},r.prototype._buildDOM=function(){if(this.bufferCanvas=new c.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new c.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),l.Konva.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}},r.prototype.cache=function(){return o.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this},r.prototype.clearCache=function(){return this},r.prototype.batchDraw=function(){return this.children.each((function(t){t.batchDraw()})),this},r}(s.Container);e.Stage=m,m.prototype.nodeType="Stage",u._registerNode(m),a.Factory.addGetterSetter(m,"container")},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(33),s=r(8),l=function(t){function e(e){var r=t.call(this,e)||this;return r.listening(!1),o.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.'),r}return i(e,t),e}(a.Layer);e.FastLayer=l,l.prototype.nodeType="FastLayer",s._registerNode(l),o.Collection.mapMethods(l)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(35),o=r(16),a=r(8),s={node:1,duration:1,easing:1,onFinish:1,yoyo:1},l=0,c=["fill","stroke","shadowColor"],h=function(){function t(t,e,r,n,i,o,a){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=i-this.begin,this.pause()}return t.prototype.fire=function(t){var e=this[t];e&&e()},t.prototype.setTime=function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},t.prototype.getTime=function(){return this._time},t.prototype.setPosition=function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},t.prototype.getPosition=function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},t.prototype.play=function(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},t.prototype.reverse=function(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},t.prototype.seek=function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},t.prototype.reset=function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},t.prototype.finish=function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},t.prototype.update=function(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")},t.prototype.onEnterFrame=function(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)},t.prototype.pause=function(){this.state=1,this.fire("onPause")},t.prototype.getTimer=function(){return(new Date).getTime()},t}(),u=function(){function t(r){var o,c,u=this,d=r.node,p=d._id,f=r.easing||e.Easings.Linear,g=!!r.yoyo;o=void 0===r.duration?.3:0===r.duration?.001:r.duration,this.node=d,this._id=l++;var y=d.getLayer()||(d instanceof a.Konva.Stage?d.getLayers():null);for(c in y||n.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new i.Animation((function(){u.tween.onEnterFrame()}),y),this.tween=new h(c,(function(t){u._tweenFunc(t)}),f,0,1,1e3*o,g),this._addListeners(),t.attrs[p]||(t.attrs[p]={}),t.attrs[p][this._id]||(t.attrs[p][this._id]={}),t.tweens[p]||(t.tweens[p]={}),r)void 0===s[c]&&this._addAttr(c,r[c]);this.reset(),this.onFinish=r.onFinish,this.onReset=r.onReset,this.onUpdate=r.onUpdate}return t.prototype._addAttr=function(e,r){var i,o,a,s,l,h,u,d,p=this.node,f=p._id;if((a=t.tweens[f][e])&&delete t.attrs[f][a][e],i=p.getAttr(e),n.Util._isArray(r))if(o=[],l=Math.max(r.length,i.length),"points"===e&&r.length!==i.length&&(r.length>i.length?(u=i,i=n.Util._prepareArrayForTween(i,r,p.closed())):(h=r,r=n.Util._prepareArrayForTween(r,i,p.closed()))),0===e.indexOf("fill"))for(s=0;s<l;s++)if(s%2==0)o.push(r[s]-i[s]);else{var g=n.Util.colorToRGBA(i[s]);d=n.Util.colorToRGBA(r[s]),i[s]=g,o.push({r:d.r-g.r,g:d.g-g.g,b:d.b-g.b,a:d.a-g.a})}else for(s=0;s<l;s++)o.push(r[s]-i[s]);else-1!==c.indexOf(e)?(i=n.Util.colorToRGBA(i),o={r:(d=n.Util.colorToRGBA(r)).r-i.r,g:d.g-i.g,b:d.b-i.b,a:d.a-i.a}):o=r-i;t.attrs[f][this._id][e]={start:i,diff:o,end:r,trueEnd:h,trueStart:u},t.tweens[f][e]=this._id},t.prototype._tweenFunc=function(e){var r,i,o,a,s,l,h,u,d=this.node,p=t.attrs[d._id][this._id];for(r in p){if(o=(i=p[r]).start,a=i.diff,u=i.end,n.Util._isArray(o))if(s=[],h=Math.max(o.length,u.length),0===r.indexOf("fill"))for(l=0;l<h;l++)l%2==0?s.push((o[l]||0)+a[l]*e):s.push("rgba("+Math.round(o[l].r+a[l].r*e)+","+Math.round(o[l].g+a[l].g*e)+","+Math.round(o[l].b+a[l].b*e)+","+(o[l].a+a[l].a*e)+")");else for(l=0;l<h;l++)s.push((o[l]||0)+a[l]*e);else s=-1!==c.indexOf(r)?"rgba("+Math.round(o.r+a.r*e)+","+Math.round(o.g+a.g*e)+","+Math.round(o.b+a.b*e)+","+(o.a+a.a*e)+")":o+a*e;d.setAttr(r,s)}},t.prototype._addListeners=function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){var r=e.node,n=t.attrs[r._id][e._id];n.points&&n.points.trueEnd&&r.setAttr("points",n.points.trueEnd),e.onFinish&&e.onFinish.call(e)},this.tween.onReset=function(){var r=e.node,n=t.attrs[r._id][e._id];n.points&&n.points.trueStart&&r.points(n.points.trueStart),e.onReset&&e.onReset()},this.tween.onUpdate=function(){e.onUpdate&&e.onUpdate.call(e)}},t.prototype.play=function(){return this.tween.play(),this},t.prototype.reverse=function(){return this.tween.reverse(),this},t.prototype.reset=function(){return this.tween.reset(),this},t.prototype.seek=function(t){return this.tween.seek(1e3*t),this},t.prototype.pause=function(){return this.tween.pause(),this},t.prototype.finish=function(){return this.tween.finish(),this},t.prototype.destroy=function(){var e,r=this.node._id,n=this._id,i=t.tweens[r];for(e in this.pause(),i)delete t.tweens[r][e];delete t.attrs[r][n]},t.attrs={},t.tweens={},t}();e.Tween=u,o.Node.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new u(t).play()},e.Easings={BackEaseIn:function(t,e,r,n){var i=1.70158;return r*(t/=n)*t*((i+1)*t-i)+e},BackEaseOut:function(t,e,r,n){var i=1.70158;return r*((t=t/n-1)*t*((i+1)*t+i)+1)+e},BackEaseInOut:function(t,e,r,n){var i=1.70158;return(t/=n/2)<1?r/2*(t*t*((1+(i*=1.525))*t-i))+e:r/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},ElasticEaseIn:function(t,e,r,n,i,o){var a=0;return 0===t?e:1==(t/=n)?e+r:(o||(o=.3*n),!i||i<Math.abs(r)?(i=r,a=o/4):a=o/(2*Math.PI)*Math.asin(r/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/o)+e)},ElasticEaseOut:function(t,e,r,n,i,o){var a=0;return 0===t?e:1==(t/=n)?e+r:(o||(o=.3*n),!i||i<Math.abs(r)?(i=r,a=o/4):a=o/(2*Math.PI)*Math.asin(r/i),i*Math.pow(2,-10*t)*Math.sin((t*n-a)*(2*Math.PI)/o)+r+e)},ElasticEaseInOut:function(t,e,r,n,i,o){var a=0;return 0===t?e:2==(t/=n/2)?e+r:(o||(o=n*(.3*1.5)),!i||i<Math.abs(r)?(i=r,a=o/4):a=o/(2*Math.PI)*Math.asin(r/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/o)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/o)*.5+r+e)},BounceEaseOut:function(t,e,r,n){return(t/=n)<1/2.75?r*(7.5625*t*t)+e:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+e:r*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,r,n,i){return n-e.Easings.BounceEaseOut(i-t,0,n,i)+r},BounceEaseInOut:function(t,r,n,i){return t<i/2?.5*e.Easings.BounceEaseIn(2*t,0,n,i)+r:.5*e.Easings.BounceEaseOut(2*t-i,0,n,i)+.5*n+r},EaseIn:function(t,e,r,n){return r*(t/=n)*t+e},EaseOut:function(t,e,r,n){return-r*(t/=n)*(t-2)+e},EaseInOut:function(t,e,r,n){return(t/=n/2)<1?r/2*t*t+e:-r/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,r,n){return r*(t/=n)*t*t*t*t+e},StrongEaseOut:function(t,e,r,n){return r*((t=t/n-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,r,n){return(t/=n/2)<1?r/2*t*t*t*t*t+e:r/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,r,n){return r*t/n+e}}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(e,"__esModule",{value:!0});var a=r(9),s=r(12),l=r(14),c=r(13),h=r(8),u=function(t){function e(e){var r=t.call(this,e)||this;return r.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")})),r}return i(e,t),e.prototype._sceneFunc=function(t){var e,r,n,i=this.points(),o=i.length,a=this.tension(),s=this.closed(),l=this.bezier();if(o){if(t.beginPath(),t.moveTo(i[0],i[1]),0!==a&&o>4){for(r=(e=this.getTensionPoints()).length,n=s?0:4,s||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);n<r-2;)t.bezierCurveTo(e[n++],e[n++],e[n++],e[n++],e[n++],e[n++]);s||t.quadraticCurveTo(e[r-2],e[r-1],i[o-2],i[o-1])}else if(l)for(n=2;n<o;)t.bezierCurveTo(i[n++],i[n++],i[n++],i[n++],i[n++],i[n++]);else for(n=2;n<o;n+=2)t.lineTo(i[n],i[n+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}},e.prototype.getTensionPoints=function(){return this._getCache("tensionPoints",this._getTensionPoints)},e.prototype._getTensionPoints=function(){return this.closed()?this._getTensionPointsClosed():a.Util._expandPoints(this.points(),this.tension())},e.prototype._getTensionPointsClosed=function(){var t=this.points(),e=t.length,r=this.tension(),n=a.Util._getControlPoints(t[e-2],t[e-1],t[0],t[1],t[2],t[3],r),i=a.Util._getControlPoints(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],r),o=a.Util._expandPoints(t,r);return[n[2],n[3]].concat(o).concat([i[0],i[1],t[e-2],t[e-1],i[2],i[3],n[0],n[1],t[0],t[1]])},e.prototype.getWidth=function(){return this.getSelfRect().width},e.prototype.getHeight=function(){return this.getSelfRect().height},e.prototype.getSelfRect=function(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};for(var e,r,n=(t=0!==this.tension()?o([t[0],t[1]],this._getTensionPoints(),[t[t.length-2],t[t.length-1]]):this.points())[0],i=t[0],a=t[1],s=t[1],l=0;l<t.length/2;l++)e=t[2*l],r=t[2*l+1],n=Math.min(n,e),i=Math.max(i,e),a=Math.min(a,r),s=Math.max(s,r);return{x:n,y:a,width:i-n,height:s-a}},e}(l.Shape);e.Line=u,u.prototype.className="Line",u.prototype._attrsAffectingSize=["points","bezier","tension"],h._registerNode(u),s.Factory.addGetterSetter(u,"closed",!1),s.Factory.addGetterSetter(u,"bezier",!1),s.Factory.addGetterSetter(u,"tension",0,c.getNumberValidator()),s.Factory.addGetterSetter(u,"points",[],c.getNumberArrayValidator()),a.Collection.mapMethods(u)},function(t,e,r){},function(t,e,r){"use strict";r.r(e);var n=r(1),i=r.n(n),o=r(2),a=r.n(o),s=r(0),l=r.n(s);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e,r){var n=r.value;if("function"!=typeof n)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(c(n)));var i=!1;return{configurable:!0,get:function(){if(i||this===t.prototype||this.hasOwnProperty(e)||"function"!=typeof n)return n;var r=n.bind(this);return i=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return r},set:function(t){n=t,delete this[e]}}),i=!1,r},set:function(t){n=t}}}var d,p=r(21),f=r.n(p);function g(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t[e]||!1===t[e]){var n=t[e];return"true"==n||"false"!=n&&(isNaN(n)?t[e]:+n)}return r}function y(t,e){if(Array.isArray(e)||(e=[e]),t){for(var r=0;r<e.length;r++)if(!t[e[r]])return!1;return!0}return!1}var v=(d=function(){function t(e){i()(this,t),this.token=e,this.baseUrl="https://data.oceannetworks.ca/",this.useApiProxy=""==this.token,this._axios=f.a.create({method:"get",baseURL:this.baseUrl,timeout:12e4}),this.getLocations=this.getLocations.bind(this),this.getDevices=this.getDevices.bind(this),this.getDeviceCategories=this.getDeviceCategories.bind(this),this.getProperties=this.getProperties.bind(this),this.getDeployments=this.getDeployments.bind(this),this.getDataProducts=this.getDataProducts.bind(this)}return a()(t,[{key:"doRequest",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"api",i={params:e};if(this.useApiProxy||(i.params.token=this.token),""==n&&(i.url=t),"api"==n&&this.useApiProxy?i.url="apiproxy/".concat(t):i.url="".concat(n,"/").concat(t),"download"==e.method&&e.extension)switch(e.extension){case"txt":i.responseType="text";break;case"json":i.responseType="json";break;case"csv":i.responseType="text";break;default:i.responseType="blob"}return new Promise((function(t,e){r._axios.request(i).then((function(r){0===r.data.length&&e("empty"),t(r)}),(function(t){e(t)}))}))}},{key:"getUrlFromResponse",value:function(t){var e=t.request.responseURL;this.useProxy&&(e=t.config.headers["X-Proxy-Url"]+e.substr(this.proxyUrl.length));return e}},{key:"errorToString",value:function(t){var e=t.response,r="<b>Error:</b> ".concat(e.statusText,"<br><b>Code:</b> ").concat(e.status,"<br>");if(e.data&&e.data.errors){r+="<ul>";var n=!0,i=!1,o=void 0;try{for(var a,s=e.data.errors[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;l.parameter?r+="<li><b>".concat(l.errorMessage,"</b>: ").concat(l.parameter,"</li>"):r+="<li>".concat(l.errorMessage,"</li>")}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}r+="</ul>"}return r}},{key:"getLocations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("locations",t)}},{key:"getDevices",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("devices",t)}},{key:"getDeployments",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("deployments",t)}},{key:"getDeviceCategories",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("deviceCategories",t)}},{key:"getProperties",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("properties",t)}},{key:"getDataProducts",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("dataProducts",t)}},{key:"productRequest",value:function(t){return t.method="request",this.doRequest("dataProductDelivery",t)}},{key:"productRun",value:function(t){return t.method="run",this.doRequest("dataProductDelivery",t)}},{key:"productStatus",value:function(t){return t.method="status",this.doRequest("dataProductDelivery",t)}},{key:"productDownload",value:function(t){return t.method="download",this.doRequest("dataProductDelivery",t)}},{key:"getProductDownloadURL",value:function(t,e){var r=this.useProxy?"":"&token=".concat(this.token),n=this.useProxy?"apiproxy":"api";return"".concat(this.baseUrl).concat(n,"/dataProductDelivery?method=download").concat(r,"&dpRunId=").concat(t,"&index=").concat(e)}},{key:"getScalarData",value:function(t){return t.method=t.deviceCode?"getByDevice":"getByLocation",this.doRequest("scalardata",t)}},{key:"getRawData",value:function(t){if(y(t,["locationCode","deviceCategoryCode"]))t.method="getByLocation";else{if(!y(t,"deviceCode"))throw Error("The rawdata service requires either deviceCode, or a compbiantion of locationCode and deviceCategoryCode.");t.method="getByDevice"}return this.doRequest("rawdata",t)}},{key:"getArchiveFileList",value:function(t){if(y(t,["locationCode","deviceCategoryCode"]))t.method="getListByLocation";else{if(!y(t,["deviceCode"]))throw Error("Filters should include either both <b>locationCode</b> and <b>deviceCategoryCode</b>, or <b>deviceCode</b>.");t.method="getListByDevice"}return this.doRequest("archivefiles",t)}},{key:"getScalarPlotting",value:function(t){return this.doRequest("ScalarDataAPIService",t,"")}}]),t}(),l()(d.prototype,"getLocations",[u],Object.getOwnPropertyDescriptor(d.prototype,"getLocations"),d.prototype),l()(d.prototype,"getDevices",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDevices"),d.prototype),l()(d.prototype,"getDeployments",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDeployments"),d.prototype),l()(d.prototype,"getDeviceCategories",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDeviceCategories"),d.prototype),l()(d.prototype,"getProperties",[u],Object.getOwnPropertyDescriptor(d.prototype,"getProperties"),d.prototype),l()(d.prototype,"getDataProducts",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDataProducts"),d.prototype),l()(d.prototype,"productRequest",[u],Object.getOwnPropertyDescriptor(d.prototype,"productRequest"),d.prototype),l()(d.prototype,"productRun",[u],Object.getOwnPropertyDescriptor(d.prototype,"productRun"),d.prototype),l()(d.prototype,"productStatus",[u],Object.getOwnPropertyDescriptor(d.prototype,"productStatus"),d.prototype),l()(d.prototype,"productDownload",[u],Object.getOwnPropertyDescriptor(d.prototype,"productDownload"),d.prototype),l()(d.prototype,"getProductDownloadURL",[u],Object.getOwnPropertyDescriptor(d.prototype,"getProductDownloadURL"),d.prototype),l()(d.prototype,"getScalarData",[u],Object.getOwnPropertyDescriptor(d.prototype,"getScalarData"),d.prototype),l()(d.prototype,"getRawData",[u],Object.getOwnPropertyDescriptor(d.prototype,"getRawData"),d.prototype),l()(d.prototype,"getArchiveFileList",[u],Object.getOwnPropertyDescriptor(d.prototype,"getArchiveFileList"),d.prototype),l()(d.prototype,"getScalarPlotting",[u],Object.getOwnPropertyDescriptor(d.prototype,"getScalarPlotting"),d.prototype),d),m=r(4),w=r.n(m),b=r(5),_=r.n(b),x=r(6),C=r.n(x),k=r(3),S=r.n(k),D=r(10),P=r.n(D);function T(t){return!isNaN(parseFloat(t))&&isFinite(t)}S.a.extend(P.a);var O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i()(this,t),""==e&&(e=F("now")),this.text=e,this.isRelative=!1,this.offset={operation:"",unit:"",quantity:0},this.parsedString="",this._unitNames=["y","M","w","d","h","m","s"];try{this.parsedString=this.parse(e)}catch(t){throw t}}return a()(t,[{key:"parse",value:function(t){try{if(""==t)throw new Error("Tried to parse an empty date string.");var e=t.length;if(this.isValidISO8601(t))return t;var r=F(t);if(""!=r)return r;if(function(t){return S.a.utc(t).isValid()}(t))return function(t){return S.a.utc(t).format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}(t);this.isRelative=!0;var n=t.charAt(e-1);if(!this.isValidUnit(n))throw new Error('Unrecognized date format: "'.concat(t,'"'));var i="";if("last"==t.substr(0,4))i="last";else if("plus"==t.substr(0,4))i="plus";else{if("minus"!=t.substr(0,5))throw new Error('Unrecognized date format: "'.concat(t,'"'));i="minus"}var o=t.substring(i.length,e-1);if(!T(o))throw new Error('Unrecognized date format: "'.concat(t,'"'));this.offset={operation:i,unit:n,quantity:parseInt(o,10)}}catch(t){throw t}return""}},{key:"isValidUnit",value:function(t){return this._unitNames.indexOf(t)>-1}},{key:"isValidISO8601",value:function(t){return/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/.test(t)}},{key:"offsetFrom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.isRelative)return this.toString();var e,r=t?S.a.utc(t.toString()):S.a.utc(),n=this.offset;return"last"==n.operation?e=r.subtract(n.quantity,n.unit):"plus"==n.operation?e=r.add(n.quantity,n.unit):"minus"==n.operation&&(e=r.subtract(n.quantity,n.unit)),e.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}},{key:"toString",value:function(){return this.parsedString}}]),t}();function L(t,e){var r=null,n=null,i=null,o=null;try{r=t?new O(t):null,n=e?new O(e):null}catch(t){throw t}return r&&(i=r.offsetFrom(n)),n&&(o=n.offsetFrom(r)),{dateFrom:i,dateTo:o}}function M(t){if(t<1)return"".concat(t," seconds");var e=parseInt(t,10),r=Math.floor(e/3600),n=Math.floor((e-3600*r)/60),i=e-3600*r-60*n,o="";return r>0&&(o+="".concat(r," hours ")),n>0&&(o+="".concat(n," minutes ")),i>0&&(o+="".concat(i," seconds")),o}function F(t){var e,r=t.split("-"),n=r[r.length-1],i=r.length<2||"utc"==r[0]?S.a.utc():S()(),o=A(i);switch(n){case"now":e=i;break;case"today":e=o;break;case"yesterday":e=o.subtract(1,"days");break;case"midnight":e=o.add(1,"days").subtract(1,"second");break;case"tomorrow":e=o.add(1,"days");break;default:return""}return e.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}function E(t,e){return S.a.utc(t).format(e)}function A(t){return t=(t=(t=(t=t.set("hour",0)).set("minute",0)).set("second",0)).set("millisecond",0)}S.a.extend(P.a);var R=r(15),I=r.n(R);var U,j=function(){function t(){i()(this,t),this.userDates={dateFrom:null,dateTo:null},this.parsedDates={dateFrom:null,dateTo:null},this.warnings=[],this.errors=[]}return a()(t,[{key:"parse",value:function(t){var e=this.gatherTagAttributes(t);e.filters={};var r=t.closest(".oncWidgetGroup");if(r){var n=this.gatherTagAttributes(r);for(var i in""==e.type&&""!=n.type&&(e.type=n.type),""==e.source&&""!=n.source&&["plot"].includes(e.type)&&(e.source=n.source),n.attributes)e.attributes[i]||(e.attributes[i]=n.attributes[i]);for(var o in n.engine)e.engine[o]||(e.engine[o]=n.engine[o]);for(var a in n.options)e.options[a]||(e.options[a]=n.options[a])}if(""==e.type)return this.fatal("No <b>data-widget</b> attribute found in this data widget.");""==e.source&&(e.source=this.sourceForType(e.type,e));var s=function(t,e){switch(t){case"plottingUtility":return{sensorId:null,x:null,y:null,deviceId:null,dateFrom:void 0,dateTo:F("now"),points:300};case"quickPlot":return{sensorId:void 0,dateFrom:void 0,dateTo:F("now"),plotTitle:"off"};case"json":return{path:void 0,x:null,y:null};case"scalardata":return{locationCode:void 0,deviceCategoryCode:void 0,deviceCode:null,propertyCode:null,sensorCategoryCodes:null,dateFrom:null,dateTo:null,x:null,y:null};case"rawdata":return{locationCode:null,deviceCategoryCode:null,deviceCode:null,rowLimit:null,sizeLimit:null,convertHexToDecimal:null,outputFormat:"object",getLatest:null,returnOptions:null,dateFrom:null,dateTo:null,x:null,y:null};case"dataPreview":return{url:void 0,range:null};case"dataProductDelivery":var r={dataProductCode:void 0,extension:void 0,dateFrom:F("today"),dateTo:F("now"),dataProductName:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dpo_qualityControl:null,dpo_resample:null,dpo_average:null,dpo_sensorstoinclude:null,dpo_3beam:null,dpo_corScreen:null,dpo_errVelScreen:null,dpo_falseTarScreen:null,dpo_horizontalcurrentplotlimits:null,dpo_velocityBinmapping:null,dpo_verticalcurrentplotlimits:null,x:null,y:null};switch(e){case"plot":r.dataProductCode="TSSD",r.extension="json",r.dpo_jsonOutputEncoding="OM",r.dpo_dataGaps="0";break;case"image":r.dataProductCode="TSSP",r.extension="png";break;case"download":r.dpo_dataGaps="1"}return r;case"discovery":switch(e){case"locations":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null};case"deployments":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dateFrom:null,dateTo:null};case"deviceCategories":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCategoryName:null,propertyCode:null};case"devices":return{locationCode:null,deviceCategoryCode:null,deviceCode:null,deviceName:null,deviceId:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null};case"properties":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,propertyName:null,description:null};case"dataProducts":return{sensorId:null,dataProductCode:null,extension:null,dataProductName:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null}}}return"archivefiles"==t?{locationCode:null,deviceCategoryCode:null,deviceCode:null,dateFrom:null,dateTo:null,dateArchivedFrom:null,dateArchivedTo:null,returnOptions:null,rowLimit:null,page:null,getLatest:null,extension:null}:{}}(e.source,e.type);this.copyIfExists(e.attributes,e.filters,Object.keys(s)),e.filters.dateFrom&&!e.filters.dateTo&&(e.filters.dateTo="now"),this.userDates.dateFrom=e.filters.dateFrom,this.userDates.dateTo=e.filters.dateTo;try{this.parsedDates=L(e.filters.dateFrom,e.filters.dateTo);var l=this.parsedDates;l.dateFrom&&(e.filters.dateFrom=l.dateFrom),l.dateTo&&(e.filters.dateTo=l.dateTo)}catch(t){return this.fatal(t)}for(var c in s)null==e.filters[c]&&null!==s[c]&&(e.filters[c]=s[c]);return this.validateFilters(e.filters,s,e.options),e}},{key:"gatherTagAttributes",value:function(t){for(var e,r,n={type:"",source:"",attributes:{},options:{},engine:{}},i=["class","id","title","lang","style","tabindex","align","accesskey","contenteditable","dir","draggable","dropzone","translate","hidden"],o=t.dataset,a=t.attributes,s={},l=0;l<a.length;l++)e=a[l].name,""!=(r=a[l].value)&&"data-"!=e.substr(0,5)&&-1==i.indexOf(e)&&(s[e]=r);for(var c in o)""!=o[c]&&(s[c]=o[c]);for(var h in s)"widget"==h?n.type=s.widget:"source"==h?n.source=s.source:"engine"==h?n.engine=this.parseOptionsString(s.engine):"options"==h?n.options=this.parseOptionsString(s.options):"addons"==h?n.addons=this.parseAddonsString(s.addons):n.attributes[h]=s[h];return n}},{key:"validateFilters",value:function(t,e,r){var n=["widget","options","source"];for(var i in e)n.push(i),void 0===e[i]&&(t[i]||this.errors.push("Widget tag is missing a mandatory filter: <b>".concat(i,"</b>")))}},{key:"copyIfExists",value:function(t,e,r){var n,i;for(n=0;n<r.length;n++)t[i=r[n].toLowerCase()]&&(e[r[n]]=t[i])}},{key:"parseOptionsString",value:function(t){try{var e,r,n,i={},o=t.split(","),a=!0,s=!1,l=void 0;try{for(var c,h=o[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){var u=c.value;if(2!=(e=u.split(":")).length)throw new Error('Illegal syntax near "'.concat(u,'"'));switch(r=e[0].trim(),n=e[1].trim()){case"true":i[r]=!0;break;case"false":i[r]=!1;break;default:i[r]=n}}}catch(t){s=!0,l=t}finally{try{a||null==h.return||h.return()}finally{if(s)throw l}}return i}catch(t){throw new Error("Check that special configuration attributes (engine, options) have the right format.<br>".concat(t.name,": ").concat(t.message,"."))}}},{key:"parseAddonsString",value:function(t){var e=[],r=t.split(","),n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;e.push(l.trim())}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return e}},{key:"fatal",value:function(t){return this.errors.push(t),!1}},{key:"sourceForType",value:function(t,e){if(["locations","deployments","deviceCategories","devices","properties","dataProducts"].includes(t))return"discovery";if(["download","image"].includes(t))return"dataProductDelivery";return["archiveFiles","archiveGif","archiveDays","archiveMap"].includes(t)?"archivefiles":"plot"==t?e.attributes.sensorid?"plottingUtility":"scalardata":t==rawValue?"rawdata":""}}]),t}(),N=function(){function t(e,r){i()(this,t),this.domNode=e,this.cbkCancel=r}return a()(t,[{key:"showMessage",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="";switch(t){case"api_error":n="Oceans 2.0 API error";break;case"error":n="Widget error";break;case"info":n="Information"}this.renderStatusBox(t,n,e,r),this.cbkCancel()}},{key:"showLoader",value:function(t,e){this.renderSpinner(t,e)}},{key:"renderStatusBox",value:function(t,e,r,n){if(n){var i="";for(var o in n)i+="<li><b>".concat(o,"</b><span>").concat(n[o],"</span></li>\n");'<div class="request">\n\t\t\t\t\t\t\t\t<a href="#none">[+] Show request info</a>\n\t\t\t\t\t\t\t\t<div class="info"><ul>'.concat(i,"</ul></div>\n\t\t\t\t\t\t\t</div>")}this.domNode.innerHTML='\n\t\t<div class="statusMsg '.concat(t,'">\n\t\t\t<div class="header">').concat(e,'</div>\n\t\t\t<div class="message">\n\t\t\t\t').concat(r,"\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>")}},{key:"renderSpinner",value:function(t,e){this.domNode.innerHTML='<div class="statusMsg '.concat(t,'">').concat('<div class="spinner la-line-scale-pulse-out"><div></div><div></div><div></div><div></div><div></div></div>','<div class="spinnerText">').concat(e,"</div></div>");var r=document.createElement("span");r.innerHTML="Cancel",r.classList.add("cancel"),r.addEventListener("click",this.cbkCancel),this.domNode.childNodes[0].appendChild(r)}},{key:"remove",value:function(){var t=this.domNode.querySelector("div.statusMsg");t&&t.parentNode.removeChild(t)}}]),t}(),G=(U=function(){function t(e){i()(this,t),this.widget=e,this.items=[],this.dom={base:null,button:null,ul:null}}return a()(t,[{key:"addItem",value:function(t,e,r){this.items.push({code:t,label:e,callback:r})}},{key:"hasItem",value:function(t){for(var e in items)if(e.code==t)return!0;return!1}},{key:"toggle",value:function(t){t.stopPropagation(),this.dom.base.classList.toggle("active")}},{key:"hide",value:function(){this.dom.base&&this.dom.base.classList.remove("active")}},{key:"render",value:function(){var t=this,e=document.createElement("div");e.classList.add("menu");var r=document.createElement("button");e.appendChild(r);var n=document.createElement("ul"),i=!0,o=!1,a=void 0;try{for(var s,l=this.items[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,h=document.createElement("li"),u=document.createElement("a");u.setAttribute("href","javascript:void(0)"),u.innerHTML=c.label,u.addEventListener("click",c.callback),u.addEventListener("click",(function(e){t.hide()})),h.appendChild(u),n.appendChild(h)}}catch(t){o=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}return e.appendChild(n),r.addEventListener("click",this.toggle),this.dom.button=r,this.dom.ul=n,this.dom.base=e,e}}]),t}(),l()(U.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(U.prototype,"toggle"),U.prototype),l()(U.prototype,"hide",[u],Object.getOwnPropertyDescriptor(U.prototype,"hide"),U.prototype),l()(U.prototype,"render",[u],Object.getOwnPropertyDescriptor(U.prototype,"render"),U.prototype),U);function B(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n="",i=""!=r?r.split(","):[],o=t.length,a=i.length,s=0;s<o;s++)n+=a>0&&a>s?"<".concat(e,' class="').concat(i[s],'">').concat(t[s],"</").concat(e,">"):"<".concat(e,">").concat(t[s],"</").concat(e,">");return n}function H(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n='<table class="oncTable '.concat(r,'">');return n+="<thead>"+B(t,"th")+"</thead>",n+="<tbody>"+e+"</tbody></table>"}function Y(t){var e=document.createElement("button");return e.type="button",e.title="Show children",e.innerHTML="&plus;",e.locationCode=t,e.onclick=function(t){var e=t.target.locationCode;document.querySelectorAll('tr[data-parent="'.concat(e,'"]')).forEach((function(t){t.classList.toggle("show")}))},e}var q,W=r(79);function z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=t.split(e);if(r){for(var n in r)r[n]=r[n].trim();return r}return[t.trim()]}function V(t){return W(t)}function $(t){return t.substr(t.lastIndexOf(".")+1)}var K,X,Z,J,Q=(q=function(){function t(e){i()(this,t),this.label="Show report",this.widget=e,this.visible=!1,this.dom={base:null,body:null}}return a()(t,[{key:"preRender",value:function(){var t=this.dom;t.base=this.make("div","report"),t.body=this.make("div","content");var e=this.make("span","btClose","X");e.addEventListener("click",this.hide);var r=this.make("h2","","Widget Report");r.appendChild(e),t.base.appendChild(r),t.base.appendChild(t.body),this.widget.dom.footer.appendChild(t.base)}},{key:"renderTable",value:function(t,e,r,n){var i=document.createElement("table");n&&i.classList.add(n);var o='<tr><th colspan="'.concat(r?2:1,'">').concat(t,"</th></tr>");for(var a in e)o+='<tr><td class="label">'.concat(e[a],"</td>"),r&&(o+='<td class="value">'.concat(r[a],"</td>")),o+="</tr>";return i.innerHTML=o,i}},{key:"make",value:function(t,e,r){var n=document.createElement(t);return e&&n.classList.add(e),r&&(n.innerHTML=r),n}},{key:"render",value:function(){var t=this.widget,e=this.dom.body;this.dom.body.textContent="",e.appendChild(this.renderTable("General",["Type","Status"],[t.type,t.status]));var r=Object.keys(t.filters);if(r.length>0){var n=r.map((function(e){return t.filters[e]}));e.appendChild(this.renderTable("Request parameters",r,n))}if(t.ds){var i=t.ds.performance.downloadTime,o=V(t.ds.performance.downloadSize),a="<ul>"+B(t.ds.performance.messages,"li")+"</ul>";e.appendChild(this.renderTable("Performance",["Duration","Size","Messages"],[i,o,a]))}if(t.ds&&t.ds.requestURLs.length>0){var s=t.ds.requestURLs.map((function(t){return'<a href="'.concat(t,'" target="_blank">').concat(t,"</a>")}));this.dom.base.appendChild(this.renderTable("HTTP Requests",s,null,"request-urls"))}if(t.options.showWarnings&&t.warnings.length>0){var l=t.warnings;t.ds&&l.concat(t.ds.warnings),this.dom.base.appendChild(this.renderTable("Warnings",l,null,"warnings"))}}},{key:"toggle",value:function(){this.visible=!this.visible,this.visible&&this.render(),this.dom.base.classList.toggle("active")}},{key:"hide",value:function(){this.visible=!1,this.dom.base.classList.remove("active")}}]),t}(),l()(q.prototype,"render",[u],Object.getOwnPropertyDescriptor(q.prototype,"render"),q.prototype),l()(q.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(q.prototype,"toggle"),q.prototype),l()(q.prototype,"hide",[u],Object.getOwnPropertyDescriptor(q.prototype,"hide"),q.prototype),q),tt=(K=function(){function t(e){i()(this,t),this.label="Download CSV",this.widget=e}return a()(t,[{key:"download",value:function(){this.widget.ds.saveDataToFile()}}]),t}(),l()(K.prototype,"download",[u],Object.getOwnPropertyDescriptor(K.prototype,"download"),K.prototype),K),et=(X=function(){function t(e){i()(this,t),this.label="View in plotting utility",this.sensorId=e.sensorId,this.dateFrom=e.dateFrom,this.dateTo=e.dateTo}return a()(t,[{key:"open",value:function(){var t=this.sensorId,e=S()(this.dateFrom),r=S()(this.dateTo),n=e.format("DD-MMM-YYYY%20HH:mm:ss"),i=r.format("DD-MMM-YYYY%20HH:mm:ss"),o="https://data.oceannetworks.ca/PlottingUtility?TREETYPE=26&SENSOR=".concat(t,"&DATEFROM=").concat(n,"&DATETO=").concat(i);window.open(o,"_blank")}}]),t}(),l()(X.prototype,"open",[u],Object.getOwnPropertyDescriptor(X.prototype,"open"),X.prototype),X),rt=r(7),nt=r.n(rt),it=r(36),ot=(Z=function(){function t(e){i()(this,t),I()(t,this,"download"),this.name=e,this.data=null,this.cancelFlag=!1,this.performance={downloadStart:null,downloadEnd:null,downloadTime:"",downloadSize:0,messages:[]},this.userDates={dateFrom:null,dateTo:null},this.requestURLs=[],this.warnings=[]}return a()(t,[{key:"logDownloadStart",value:function(){this.performance.downloadStart=S()()}},{key:"logDownloadEnd",value:function(){this.performance.downloadEnd=S()();var t,e=this.performance.downloadEnd.diff(this.performance.downloadStart);t=e<1e3?"".concat(e," ms"):e>=1e3&&e<6e4?"".concat(e/1e3," seconds"):M(e/1e3),this.performance.downloadTime=t}},{key:"saveDataToFile",value:function(){for(var t,e=this.data.length,r=this.data[0].samples.values.length,n=this.data[0].samples.min,i="SampleTime",o=0;o<e;o++)i+=","+(t=this.data[o].sensorName),n&&(i+=" (AVG), ".concat(t," (MIN), ").concat(t," (MAX), ").concat(t," QAQC"));for(var a=0;a<r;a++){i+="\n"+this.data[0].samples.times[a];for(var s=0;s<e;s++)i+=","+this.data[s].samples.values[a],n&&(i+=","+this.data[s].samples.min[a],i+=","+this.data[s].samples.max[a]),i+=","+this.data[s].samples.qaqc[a]}var l=new Blob([i],{type:"text/plain;charset=utf-8"}),c=new Date;Object(it.saveAs)(l,"".concat(c.getTime(),".csv"))}},{key:"addRequestURL",value:function(t){this.requestURLs.push(t)}},{key:"addPerformanceMsg",value:function(t){this.performance.messages.push(t)}},{key:"addWarning",value:function(t){this.warnings.push("<b>Warning:</b> "+t)}},{key:"refreshDateRangeFilters",value:function(){if(this.filters){var t=L(this.userDates.dateFrom,this.userDates.dateTo);t.dateFrom&&(this.filters.dateFrom=t.dateFrom),t.dateTo&&(this.filters.dateTo=t.dateTo)}}},{key:"hasData",value:function(){return void 0!==this.data&&null!==this.data&&0!=this.data.length&&this.data.length>0}},{key:"cancel",value:function(){this.cancelFlag=!0}},{key:"clear",value:function(){this.data=null}}]),t}(),l()(Z.prototype,"saveDataToFile",[u],Object.getOwnPropertyDescriptor(Z.prototype,"saveDataToFile"),Z.prototype),l()(Z.prototype,"refreshDateRangeFilters",[u],Object.getOwnPropertyDescriptor(Z.prototype,"refreshDateRangeFilters"),Z.prototype),Z);S.a.extend(P.a);var at,st,lt,ct=(J=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"plottingUtility")))._onc=t,o.filters=r,o.points=o.filters.points,o.sensorIds=[],o.isClean=!0,o.mode="MinMaxAvg",o.initSensorIds(),o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"initSensorIds",value:function(){var t=this.filters;if(!t.sensorId&&!t.x&&!t.y)throw new Error("This data source requires either the <b>sensorId</b> parameter, or both <b>x</b> and <b>y</b> parameters.");if(-1!=t.sensorId.indexOf(",")){var e=t.sensorId.split(","),r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this.sensorIds.push(s.trim())}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}else t.sensorId&&this.sensorIds.push(t.sensorId.trim())}},{key:"download",value:function(){var t,e=this;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return this.data=[],t={datefrom:S.a.utc(this.filters.dateFrom).format("YYYY-MM-DDTHH:mm:ss[.00Z]"),dateto:S.a.utc(this.filters.dateTo).format("YYYY-MM-DDTHH:mm:ss[.00Z]"),option:this.optionCode(this.mode),isClean:this.isClean,plotpoints:this.filters.points},r.abrupt("return",new Promise((function(r,n){var i,o,a,s,l,c,h,u;return nt.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:e.logDownloadStart(),e.cbkShowLoader("loading","Loading plot data"),i=0,o=!0,a=!1,s=void 0,d.prev=6,l=e.sensorIds[Symbol.iterator]();case 8:if(o=(c=l.next()).done){d.next=24;break}return h=c.value,d.prev=10,d.next=13,nt.a.awrap(e.downloadSensor(h,t));case 13:u=d.sent,i+=u.request.responseText.length,d.next=21;break;case 17:return d.prev=17,d.t0=d.catch(10),n(d.t0),d.abrupt("return");case 21:o=!0,d.next=8;break;case 24:d.next=30;break;case 26:d.prev=26,d.t1=d.catch(6),a=!0,s=d.t1;case 30:d.prev=30,d.prev=31,o||null==l.return||l.return();case 33:if(d.prev=33,!a){d.next=36;break}throw s;case 36:return d.finish(33);case 37:return d.finish(30);case 38:e.logDownloadEnd(),e.performance.downloadSize=i,e.cbkShowLoader("hide"),r(e.data);case 42:case"end":return d.stop()}}),null,null,[[6,26,30,38],[10,17],[31,,33,37]])})));case 3:case"end":return r.stop()}}),null,this)}},{key:"reload",value:function(t,e){var r=this;return new Promise((function(t,e){var n=parseInt(r.filters.points,10);r.filters.points=n+500,r.download().then((function(e){t(e)}))}))}},{key:"downloadSensor",value:function(t,e){var r=this;return nt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e.sensorid=t,n.abrupt("return",new Promise((function(n,i){r.cbkShowLoader("loading","Downloading sensor ".concat(t)),r._onc.getScalarPlotting(e).then((function(e){if(r.requestURLs.push(r._onc.getUrlFromResponse(e)),e.data&&0==e.data.statusCode)r.addData(e.data.payload,t),n(e);else switch(e.data.statusCode){case 105:i(new Error("Failed to obtain data for sensor ".concat(t," with the provided filters.")));default:i(new Error("The data request for sensor ".concat(t," failed.")))}}),(function(t){t.response&&t.response.data&&r.requestURLs.push(r._onc.getUrlFromResponse(t.response)),i(t)}))})));case 2:case"end":return n.stop()}}))}},{key:"addData",value:function(t,e){var r=t.data.length,n={title:t.name,unit:t.uofm,samples:{times:new Array(r),qaqc:new Array(r)}};"MinMax"!=this.mode&&(n.samples.values=new Array(r)),"Avg"!=this.mode&&(n.samples.max=new Array(r),n.samples.min=new Array(r));this.data.length;var i=9999999,o=-9999999;if("Avg"==this.mode)for(var a=0;a<r;a++)n.samples.times[a]=t.data[a][0],this.isClean&&""===t.data[a][1]?(n.samples.values[a]=null,n.samples.qaqc[a]=null):(n.samples.values[a]=t.data[a][1],n.samples.qaqc[a]=t.data[a][2]);else if("MinMax"==this.mode)for(var s=0;s<r;s++)n.samples.times[s]=t.data[s][0],this.isClean&&""===t.data[s][1]?(n.samples.min[s]=null,n.samples.max[s]=null,n.samples.qaqc[s]=null):(n.samples.min[s]=t.data[s][1],n.samples.max[s]=t.data[s][2],n.samples.qaqc[s]=t.data[s][3]);else if("MinMaxAvg"==this.mode)for(var l,c=!1,h=0;h<r;h++)n.samples.times[h]=t.data[h][0],this.isClean&&""===t.data[h][2]?(c||(n.samples.times[h]=t.data[h-1][0],l=n.samples.values[h-1],c=!0),n.samples.min[h]=l,n.samples.max[h]=l):c?(c=!1,n.samples.min[h]=t.data[h][3],n.samples.max[h]=t.data[h][3]):(n.samples.min[h]=t.data[h][1],n.samples.max[h]=t.data[h][2]),n.samples.values[h]=t.data[h][3],n.samples.qaqc[h]=t.data[h][4],n.samples.min[h]<i&&(i=n.samples.min[h]),n.samples.max[h]>o&&(o=n.samples.max[h]);n.range=[i,o],this.data.push(n)}},{key:"optionCode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MinMaxAvg";switch(t){case"Avg":return 1;case"MinMax":return 2;case"MinMaxAvg":return 3}return 0}}]),e}(ot),l()(J.prototype,"download",[u],Object.getOwnPropertyDescriptor(J.prototype,"download"),J.prototype),l()(J.prototype,"reload",[u],Object.getOwnPropertyDescriptor(J.prototype,"reload"),J.prototype),l()(J.prototype,"addData",[u],Object.getOwnPropertyDescriptor(J.prototype,"addData"),J.prototype),J),ht=(at=function(){function t(e,r,n){i()(this,t),this.label="Add raw data",this.engine=null,this.ds=new ct(e,r,n),this.ds.isClean=!1,this.ds.mode="MinMax"}return a()(t,[{key:"toggle",value:function(){var t=this;return this.ds.hasData()||this.ds.download().then((function(e){var r=e[0].samples.times.concat(e[0].samples.times),n=e[0].samples.min.concat(e[0].samples.max);t.engine.addPlot(r,n,"Raw")}),(function(t){return reject(t)})),!1}}]),t}(),l()(at.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(at.prototype,"toggle"),at.prototype),at),ut=(st=function(){function t(e,r){i()(this,t),I()(t,this,"download","renderContents"),this.idx=0,this.filters={},this._onc=r,this.type="",this.source="",this.ds=null,this.parser=new j,this.statusBox=null,this.status="normal",this.loaderIsVisible=!0,this.menu=new G(this),this.dom={base:e,header:null,footer:null,content:null,headerLoader:null},this.options={report:!1,showWarnings:!0,theme:"default",engine:{}},this.addons={},this.warnings=[],this.cancelled=!1;try{this.parse(this.dom.base),this.renderBase(),this.statusBox=new N(this.dom.content,this.cancel)}catch(t){this.statusBox=new N(this.dom.base,this.cancel),this.showStatus("error",t.message),this.cancel()}}return a()(t,[{key:"parse",value:function(t){try{var e=this.parser.parse(t);if(this.parser.errors.length>0)throw new Error(this.parser.errors.join("<br>"));this.type=e.type,this.source=e.source,this.filters=e.filters,this.options.engine=e.engine,this.addAddons(e.addons),this.addOptions(e.options)}catch(t){throw this.cancel(),console.log(t),new Error("<b>Parsing error:</b><p>".concat(t.message,"</p>"))}}},{key:"addAddons",value:function(t){if(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;"report"==a?(this.addons.report=new Q(this),this.menu.addItem(a,this.addons.report.label,this.addons.report.toggle)):"csv"==a?(this.addons.csv=new tt(this),this.menu.addItem(a,this.addons.csv.label,this.addons.csv.download)):"pulink"==a&&"plot"==this.type?(this.addons.pulink=new et(this.filters),this.menu.addItem(a,this.addons.pulink.label,this.addons.pulink.open)):"raw"==a&&"plot"==this.type&&"plottingUtility"==this.source&&(this.addons.raw=new ht(this._onc,this.filters,this.showHeaderLoader),this.menu.addItem(a,this.addons.raw.label,this.addons.raw.toggle))}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}}},{key:"addOptions",value:function(t){for(var e in t)this.options[e]=t[e]}},{key:"renderBase",value:function(){var t=this;for(var e in this.dom.base.classList.add("theme_".concat(this.options.theme)),this.dom.base.classList.add("widget_".concat(this.type)),this.dom.base.innerHTML='<div class="header"></div><div class="contents"></div><div class="footer"></div>',this.dom.header=this.dom.base.querySelector("div.header"),this.dom.footer=this.dom.base.querySelector("div.footer"),this.dom.content=this.dom.base.querySelector("div.contents"),this.dom.base.addEventListener("click",(function(e){e.target.closest(".menu")||t.menu.hide()})),this.addons)"function"==typeof this.addons[e].preRender&&this.addons[e].preRender()}},{key:"render",value:function(){this.renderContents(),this.renderHeader()}},{key:"renderHeader",value:function(){if(this.dom.headerLoader=document.createElement("div"),this.dom.headerLoader.classList.add("loaderWrap"),this.dom.headerLoader.innerHTML='<div class="loader"></div>',this.dom.header.appendChild(this.dom.headerLoader),this.menu.items.length>0){var t=this.menu.render();this.dom.header.appendChild(t)}}},{key:"refreshDateRangeFilters",value:function(){var t=this.parser.userDates,e=L(t.dateFrom,t.dateTo);e.dateFrom&&(this.filters.dateFrom=e.dateFrom),e.dateTo&&(this.filters.dateTo=e.dateTo)}},{key:"showStatus",value:function(t,e){switch(this.dom.content||this.renderBase(),t){case"api_error":this.status="api_error";break;default:this.status="error"}this.statusBox.showMessage(t,e,this.filters),this.options.report&&new WidgetReport(this)}},{key:"showLoader",value:function(t,e){"hide"==t?this.hideLoader():this.loaderIsVisible&&this.statusBox.showLoader(t,e)}},{key:"hideLoader",value:function(){this.statusBox.remove()}},{key:"showHeaderLoader",value:function(t,e){"loading"==t?this.dom.headerLoader.classList.add("active"):this.dom.headerLoader.classList.remove("active")}},{key:"cancel",value:function(){this.cancelled=!0,this.ds&&this.ds.cancel()}},{key:"addWarning",value:function(t){this.warnings.push("<b>Warning:</b> "+t)}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.options[t]||!1===this.options[t]?this.options[t]:e}}]),t}(),l()(st.prototype,"addAddons",[u],Object.getOwnPropertyDescriptor(st.prototype,"addAddons"),st.prototype),l()(st.prototype,"render",[u],Object.getOwnPropertyDescriptor(st.prototype,"render"),st.prototype),l()(st.prototype,"renderHeader",[u],Object.getOwnPropertyDescriptor(st.prototype,"renderHeader"),st.prototype),l()(st.prototype,"refreshDateRangeFilters",[u],Object.getOwnPropertyDescriptor(st.prototype,"refreshDateRangeFilters"),st.prototype),l()(st.prototype,"showStatus",[u],Object.getOwnPropertyDescriptor(st.prototype,"showStatus"),st.prototype),l()(st.prototype,"showLoader",[u],Object.getOwnPropertyDescriptor(st.prototype,"showLoader"),st.prototype),l()(st.prototype,"showHeaderLoader",[u],Object.getOwnPropertyDescriptor(st.prototype,"showHeaderLoader"),st.prototype),l()(st.prototype,"cancel",[u],Object.getOwnPropertyDescriptor(st.prototype,"cancel"),st.prototype),st),dt="1",pt="0",ft="Dany Cabrera (dcabrera@uvic.ca)",gt="MIT",yt=function(t){function e(t,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return i()(this,e),(n=w()(this,_()(e).call(this,t,null))).code=r,n.message=o,n}return C()(e,t),a()(e,[{key:"download",value:function(){return new Promise((function(t){return t()}))}},{key:"renderContents",value:function(){"version"==this.code?this.renderVersion():this.showStatus(this.code,this.message)}},{key:"renderVersion",value:function(){var t="<b>ONC Data Widgets Library</b><br>";t+="<b>Version:</b> ".concat(dt,".").concat(pt,"<br>"),t+="<b>Author:</b> ".concat(ft,"<br>"),t+="<b>License:</b> ".concat(gt),this.showStatus("info",t)}}]),e}(ut),vt=(lt=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"discovery")))._onc=t,o.filters=r,o.service="",o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"getDeviceCodeForId",value:function(t){var e=this;return new Promise((function(r,n){e._onc.getDevices({deviceId:t}).then((function(t){if(e.cancelFlag)n("canceled");else{var i=t.data[0].deviceCode;r(i)}}),(function(t){return n(t)}))}))}},{key:"download",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logDownloadStart(),!this.filters.sensorId||"devices"==this.service){e.next=15;break}return t=this.filters.sensorId,this.cbkShowLoader("waiting","Getting deviceCode for id ".concat(t)),e.prev=4,e.next=7,nt.a.awrap(this.getDeviceCodeForId(t));case 7:e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("An error occurred while trying to get the device code for sensor with ID "+t);case 13:this.filters.deviceCode=deviceCode,delete this.filters.sensorId;case 15:this.cbkShowLoader("loading","Loading: ".concat(this.service)),e.t1=this.service,e.next="locations"===e.t1?19:"locationsTree"===e.t1?21:"deployments"===e.t1?23:"deviceCategories"===e.t1?25:"devices"===e.t1?27:"properties"===e.t1?29:"dataProducts"===e.t1?31:33;break;case 19:return e.abrupt("return",this.simpleRequest(this._onc.getLocations));case 21:return e.abrupt("return",this.simpleRequest(this._onc.getLocations,"getTree"));case 23:return e.abrupt("return",this.simpleRequest(this._onc.getDeployments));case 25:return e.abrupt("return",this.simpleRequest(this._onc.getDeviceCategories));case 27:return e.abrupt("return",this.simpleRequest(this._onc.getDevices));case 29:return e.abrupt("return",this.simpleRequest(this._onc.getProperties));case 31:return e.abrupt("return",this.simpleRequest(this._onc.getDataProducts));case 33:case"end":return e.stop()}}),null,this,[[4,10]])}},{key:"simpleRequest",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return new Promise((function(n,i){t(e.filters,r).then((function(t){e.cancelFlag?i("canceled"):(e.logDownloadEnd(),e.performance.downloadSize=t.request.responseText.length,e.data=t.data,e.saveRequestURL(t),n())}),(function(t){return i(t)}))}))}},{key:"saveRequestURL",value:function(t){t&&t.request&&this.requestURLs.push(this._onc.getUrlFromResponse(t))}},{key:"setService",value:function(t){this.service=t}}]),e}(ot),l()(lt.prototype,"download",[u],Object.getOwnPropertyDescriptor(lt.prototype,"download"),lt.prototype),l()(lt.prototype,"simpleRequest",[u],Object.getOwnPropertyDescriptor(lt.prototype,"simpleRequest"),lt.prototype),lt),mt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.showLoader("loading","Loading locations tree"),this.ds.request("locationsTree",this.filters)}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t;t="ONC"==this.ds.data[0].locationCode?this.ds.data[0].children:this.ds.data;var e=document.createElement("table");e.className="oncTable",e.createTHead().insertRow(0).innerHTML=B(["locationName","locationCode","hasDeviceData","hasPropertyData"],"th");var r=e.createTBody(),n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;this.addRow(null,l,r)}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}this.removeStatusMsg(),this.domNode.appendChild(e)}}},{key:"addRow",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e.locationCode,a=e.dataSearchURL?'<a target="_blank" href="'.concat(e.dataSearchURL,'">').concat(e.locationName,"</a>"):e.locationName,s=['<span class="trail"></span>'.concat(a),o,e.hasDeviceData,e.hasPropertyData],l=B(s,"td","title"),c=r.insertRow(-1);if(c.classList.add("d_".concat(n)),n>0&&c.classList.add("child"),t&&c.setAttribute("data-parent",t),i&&c.classList.add("lastLeaf"),c.innerHTML=l,e.children){c.querySelector("span.trail").appendChild(Y(o));for(var h=e.children.length,u=0;u<h;u++)this.addRow(o,e.children[u],r,n+1,u==h-1)}}},{key:"filterRules",value:function(){return{locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null}}}]),e}(ut),wt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("locations"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["locationName","locationCode","deployments","depth","lat","lon","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){return B([t.dataSearchURL?'<a target="_blank" href="'.concat(t.dataSearchURL,'">').concat(t.locationName,"</a>"):t.locationName,t.locationCode,t.deployments,t.depth,t.lat,t.lon,t.hasDeviceData,t.hasPropertyData],"td")}},{key:"filterRules",value:function(){return{locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null}}}]),e}(ut),bt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("deviceCategories"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["deviceCategoryName","deviceCategoryCode","hasDeviceData"],t)}}},{key:"renderElement",value:function(t){var e=t.deviceCategoryName;return t.cvTerm&&t.cvTerm.deviceCategory&&t.cvTerm.deviceCategory.length>0&&(e='<a target="_blank" href="'.concat(t.cvTerm.deviceCategory[0].uri,'">').concat(e,"</a>")),B([e,t.deviceCategoryCode,t.hasDeviceData],"td")}}]),e}(ut),_t=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("devices"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["deviceId","deviceName","deviceCode","hasDeviceData"],t)}}},{key:"renderElement",value:function(t){var e=t.deviceLink?'<a target="_blank" href="'.concat(t.deviceLink,'">').concat(t.deviceName,"</a>"):t.deviceName;return B([t.deviceId,e,t.deviceCode,t.hasDeviceData],"td")}}]),e}(ut),xt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("properties"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["propertyName","propertyCode","uom","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){var e=t.propertyName;return t.cvTerm&&t.cvTerm.property&&t.cvTerm.property.length>0&&(e='<a target="_blank" href="'.concat(t.cvTerm.property[0].uri,'">').concat(e,"</a>")),B([e,t.propertyCode,t.uom,t.hasDeviceData,t.hasPropertyData],"td")}}]),e}(ut),Ct=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("deployments"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["locationCode","deviceCode","begin","end","hasDeviceData","depth","lat","lon"],t)}}},{key:"renderElement",value:function(t){var e=t.end?t.end:"(unknown)",r=t.begin?t.begin:"(unknown)";return B([t.locationCode,t.deviceCode,r,e,t.hasDeviceData,t.depth,t.lat,t.lon],"td")}}]),e}(ut),kt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new vt(r,n.filters,n.showLoader),n.ds.setService("dataProducts"),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderElement(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["dataProductName","dataProductCode","extension","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){return B([t.helpDocument?'<a target="_blank" href="'.concat(t.helpDocument,'">').concat(t.dataProductName,"</a>"):t.dataProductName,t.dataProductCode,t.extension,t.hasDeviceData,t.hasPropertyData],"td")}}]),e}(ut),St=function(){function t(e){i()(this,t),this.domNode=e,this.data={x:[],y:[],name:""},this.operation="",this.params=[],this._opsConfig={smooth:{run:this.opSmooth,params:["number"],defaults:[5]}},this._validOps=["smooth"],this.parsed=this.parse();var r=this.domNode.getAttribute("title");this.data.name=r||this.operation,this.opSmooth=this.opSmooth.bind(this)}return a()(t,[{key:"parse",value:function(){var t=this.domNode.dataset.operation;if(!new RegExp(/[a-zA-Z0-9_]+\([a-zA-Z0-9_,]*\)/g).exec(t))return!1;if(this.operation=t.substring(0,t.indexOf("(")),!this._validOps.includes(this.operation))return!1;var e=t.substring(this.operation.length+1,t.length-1);this.params=this._opsConfig[this.operation].defaults;for(var r=e.split(","),n=0;n<r.length;n++)this.params[n]=r[n];for(var i="",o=0;o<this.params.length;o++)"true"==(i=this.params[o].trim())?this.params[o]=!0:"false"==i?this.params[o]=!1:T(i)?this.params[o]=parseFloat(i):this.params[o]=i;return!0}},{key:"compute",value:function(t,e){switch(this.operation){case"smooth":this.opSmooth(t,e)}}},{key:"opSmooth",value:function(t,e){var r=e.length,n=this.params[0];if(n%2==0&&n++,this.data.x=t,r<=2)this.data.y=e;else{this.data.y=new Array(r);var i=0,o=0,a=0,s=0,l=0,c=(n-1)/2;for(i=0;i<r;i++){for(i<c?(s=0,l=i+i):(s=i-c,l=i+c),l>=r&&(l=r-1),a=0,o=s;o<=l;o++)a+=e[o];this.data.y[i]=a/(l-s+1)}}}}]),t}(),Dt=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"scalardata")))._onc=t,o.filters=r,o.requestPropCount=1,o.sensorCount=0,o.sampleCount=0,o.next=null,o.pages={count:0,timeAvg:0,timeStart:null,timeEnd:null,rangeAvg:0,rangeStart:null,rangeEnd:null,totalRange:0,avgTotalCount:0},o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return this.data=[],new Promise((function(e,r){var n,i,o;return nt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:n=t.filters,i=S()(n.dateFrom),o=n.dateTo?S()(n.dateTo):S.a.utc(),t.pages.totalRange=i.diff(o,"second"),a.prev=4;case 5:return a.next=7,nt.a.awrap(t.downloadPage(n));case 7:if(n=t.next?t.next.parameters:null,!t.cancelFlag){a.next=11;break}return r("canceled"),a.abrupt("return");case 11:if(t.next){a.next=5;break}case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(4),r(a.t0);case 17:t.hasData()?(t.addPerformanceMsg("Downloaded ".concat(t.sensorCount," properties.")),t.addPerformanceMsg("Downloaded ".concat(t.sampleCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," samples for each property.")),t.addPerformanceMsg("Data downloaded in ".concat(t.pages.count," pages.")),t.pages.count>1&&t.addPerformanceMsg("Pages carry data for an average time range of ".concat(M(t.pages.rangeAvg),".")),t.sensorCount<t.requestPropCount&&t.addWarning("The server only found data for ".concat(t.sensorCount," of the ").concat(t.requestPropCount," requested properties (").concat(t.filters.sensorCategoryCodes,") for the filters provided."))):t.addPerformanceMsg("No data downloaded."),e();case 19:case"end":return a.stop()}}),null,null,[[4,14]])}))}},{key:"downloadPage",value:function(t){var e=this;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){e.logPageDownloadStart(t),e.cbkShowLoader("loading","Loading plot data"),e._onc.getScalarData(t).then((function(t){if(e.cancelFlag)n("canceled");else if(t.data.sensorData){e.next=t.data.next;var i=t.data.sensorData;if(e.hasData()){for(var o=0;o<e.sensorCount;o++)for(var a=i[o].sensorCode,s=0;s<e.sensorCount;s++)if(e.data[s].sensorCode==a){e.data[s].samples.values.concat(i[o].data.values),e.data[s].samples.times.concat(i[o].data.sampleTimes),e.data[s].samples.qaqc.concat(i[o].data.qaqcFlags);break}}else{e.sensorCount=i.length;for(var l=0;l<e.sensorCount;l++)e.data.push({sensorCode:i[l].sensorCode,title:i[l].sensorName,unit:i[l].unitOfMeasure,samples:{values:i[l].data.values,times:i[l].data.sampleTimes,qaqc:i[l].data.qaqcFlags}})}if(e.sampleCount=e.data[0].samples.values.length,e.pages.count++,e.performance.downloadSize+=t.request.responseText.length,e.logPageDownloadEnd(t.data.next),e.requestURLs.push(t.data.queryUrl),e.next){var c="Downloading data<br>page ".concat(e.pages.count+1," of &asymp;").concat(Math.ceil(e.pages.avgTotalCount));e.cbkShowLoader("loading",c)}r()}else n("empty")}),(function(t){console.log(t),t.response&&t.response.data&&e.requestURLs.push(e._onc.getUrlFromResponse(t.response)),n(t)}))})));case 1:case"end":return r.stop()}}))}},{key:"assignDataIds",value:function(){var t,e,r,n=[];this.filters.sensorCategoryCodes?n=this.filters.sensorCategoryCodes.split(","):this.filters.propertyCode&&(n=[this.filters.propertyCode]);for(var i=0;i<n.length;i++)n[i]=n[i].toLowerCase();for(var o=0;o<this.data.length;o++)e=(t=this.data[o]).sensorCode.toLowerCase(),r=t.sensorCategoryCode.toLowerCase(),n.includes(e)?this.data[o].id=e:n.includes(e)?this.data[o].id=r:this.data[o].id=t.sensorName.toLowerCase()}},{key:"disconnectDataHoles",value:function(){var t,e,r,n=this.data[0].sampleTimes.length-1,i=moment(this.data[0].sampleTimes[0],moment.ISO_8601),o=moment(this.data[0].sampleTimes[1],moment.ISO_8601),a=moment(this.data[0].sampleTimes[2],moment.ISO_8601);for(e=o.diff(i),t=1;t<n;t++)(r=a.diff(o))>30*e&&(this.sensorData.values[t]=null),i=o,o=a,a=moment(this.data[0].sampleTimes[t+2],moment.ISO_8601),e=r}},{key:"logPageDownloadStart",value:function(t){this.pages.rangeStart=S()(t.dateFrom),this.pages.timeStart=S()()}},{key:"logPageDownloadEnd",value:function(t){this.pages.timeEnd=S()();var e=this.pages.timeEnd.diff(this.pages.timeStart,"second"),r=this.pages.timeAvg;if(this.pages.timeAvg=0==r?e:.5*(r+e),t&&t.parameters.dateFrom){var n=S()(t.parameters.dateFrom);this.pages.rangeEnd=n;var i=this.pages.rangeStart.diff(this.pages.rangeEnd,"second"),o=this.pages.rangeAvg;if(0==o)this.pages.rangeAvg=i;else{var a=this.pages.count;this.pages.rangeAvg=(1-1/a)*o+1/a*i}this.pages.avgTotalCount=this.pages.totalRange/this.pages.rangeAvg}}}]),e}(ot),Pt=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#393b79","#637939","#e7ba52","#843c39","#d6616b","#7b4173","#636363","#000000"];function Tt(t){return Pt.slice(0,t)}function Ot(t){for(var e=0,r=0;r<t.length;r++)e+=t.charCodeAt(r);var n=Pt.length;return Pt[e%=n]}function Lt(t,e){3==(t=t.replace(/^\s*#|\s*$/g,"")).length&&(t=t.replace(/(.)/g,"$1$1"));var r=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),i=parseInt(t.substr(4,2),16);return"#"+(0|256+r+(256-r)*e).toString(16).substr(1)+(0|256+n+(256-n)*e).toString(16).substr(1)+(0|256+i+(256-i)*e).toString(16).substr(1)}var Mt,Ft,Et,At,Rt,It,Ut,jt,Nt,Gt,Bt=function(){function t(e,r,n){i()(this,t),I()(t,this,"prepareDataset","prepareLayout","render","isEngineAvailable"),this.api=null,this.series=[],this.plotCount=0,this.domNode=e,this.name=r,this.config=n,this.CDN="",this.vendorURL="",this.colors=[],this.colorDefaults=Tt(12),this.parseColors()}return a()(t,[{key:"parseColors",value:function(){this.colors=this.colorDefaults;var t=this.getOption("colors",null);if(t){var e=t.split(";");if(e)for(var r=0;r<e.length;r++)this.colors[r]=e[r];else this.colors[0]=t}}},{key:"isTimeSeries",value:function(){return"time"==this.controlVariable}},{key:"colorForIndex",value:function(t){return t<this.colorDefault.length?this.colorDefault[t]:this.colorDefault[t-this.colorDefault.length]}},{key:"errorUnavailable",value:function(){return new Error('<p>The plot engine <b>"'.concat(this.name,'"</b> is unavailable.</p>\n        <p>You can add this library as a <em>&lt;script&gt;</em> with the <em>src</em>: <a href="').concat(this.CDN,'" target="_BLANK">').concat(this.CDN,'</a></p>\n        <p>You can also obtain the original library at <a href="').concat(this.vendorURL,'" target="_BLANK">').concat(this.vendorURL,"</a>.</p>"))}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.config.engine[t]||!1===this.config.engine[t]?this.config.engine[t]:e}}]),t}(),Ht=(Mt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,"plotly",r))).CDN="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.54.5/plotly.min.js",n.vendorURL="https://github.com/plotly/plotly.js",n.options={mode:n.getOption("mode",n.config.isTimeSeries?"lines":"markers"),stack:n.getOption("stack","none"),stackTitles:n.getOption("stackTitles",!0),reversed:n.getOption("reversed",!1)},n.yRange=[null,null],n.independentAxisTitle="",n.layout={},n}return C()(e,t),a()(e,[{key:"prepareDataset",value:function(t){this.series=t}},{key:"addPlot",value:function(t,e,r){var n=[{type:"scattergl",mode:"markers",marker:{size:3},name:r,x:t,y:e}];Plotly.addTraces(this.domNode,n)}},{key:"parseSeries",value:function(t){for(var e=null,r=t.length,n=this.options.stack,i=Array(),o=0;o<r;o++){e=t[o],"rows"==n&&o>0?"y"+(o+1):"columns"==n&&o>0&&"x"+(o+1),this.yRange=e.range;var a=this.parseMinMaxPlot(e);i.push(a[0],a[1],a[2])}return i}},{key:"parseMinMaxPlot",value:function(t){var e=Array(3);return e[0]={type:"scatter",mode:"lines",legendgroup:t.title,connectgaps:!1,line:{width:0},showlegend:!1,hoverinfo:"skip",x:t.samples.times,y:t.samples.max},e[1]={type:"scatter",mode:"lines",legendgroup:t.title,connectgaps:!1,fill:"tonexty",fillcolor:"#b7eaff",line:{width:0},showlegend:!1,hoverinfo:"skip",x:t.samples.times,y:t.samples.min},e[2]={type:"scatter",line:{color:"#3399cc",width:1},mode:"lines",legendgroup:t.title,connectgaps:!1,name:"".concat(t.title," [").concat(t.unit,"]"),x:t.samples.times,y:t.samples.values},e}},{key:"prepareXY",value:function(t){for(var e=null,r=t.length,n=this.config,i="x"==n.independent,o=[],a=i?n.x[0]:n.y[0],s=0;s<r;s++)if(t[s].id==a){o=t[s].data.values,this.independentAxisTitle="".concat(t[s].sensorName," [").concat(t[s].unitOfMeasure,"]");break}var l=0;this.series=new Array(r-1);for(var c=0;c<r;c++)t[c].id!=a&&(e=t[c],this.series[l]={type:"scatter",mode:this.options.mode,name:"".concat(e.sensorName," [").concat(e.unitOfMeasure,"]"),x:i?o:e.data.values,y:i?e.data.values:o},l++)}},{key:"prepareLayout",value:function(){this.parseColors();var t={family:"Arial, Sans",size:10,color:"black"},e=this.config,r="x"==e.independent,n=e.engine,i=this.series.length,o={showlegend:!0,colorway:this.colors,legend:{yanchor:"top",y:1.1,orientation:"h"},xaxis:{automargin:!0,type:"date",showline:!0,zeroline:!1},yaxis:{automargin:!0,showline:!0,zeroline:!1,range:this.yRange,type:"linear"},connectgaps:!1,margin:{l:55,r:55,b:40,t:30,pad:0},hovermode:"closest"};e.isTimeSeries||(o.xaxis.type="linear"),this.options.reversed&&(o.yaxis.autorange="reversed",o.xaxis.side="top");var a="";if(1==i)e.isTimeSeries?(a="".concat(this.series[0].title," [").concat(this.series[0].unit,"]"),o.showlegend=!0,o.yaxis.title={text:a,font:{family:"Arial, Sans",size:12,color:this.colors[0]}}):(o.showlegend=!1,a="".concat(this.series[0].title," [").concat(this.series[0].unit,"]"),o.xaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}},o.yaxis.title={text:a,font:{family:"Arial, Sans",size:12,color:"#000000"}});else if(i>1&&(e.isTimeSeries||(r?o.xaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}}:o.yaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}}),n.stack))switch(this.options.stackTitles&&(o.showlegend=!1),n.stack){case"rows":for(var s,l=0;l<i;l++)o[s="yaxis"+(0==l?"":l+1)]={showline:!0,zeroline:!1,side:l%2!=0?"right":"left",tickfont:t},this.options.stackTitles&&(o[s].title={text:this.series[l].title,font:{family:"Arial, Sans",size:12,color:this.colors[l]}});o.grid={rows:i,columns:1};break;case"columns":for(var c,h=0;h<i;h++)o[c="xaxis"+(0==h?"":h+1)]={showline:!0,tickfont:t},this.options.stackTitles&&(o[c].title={text:this.series[h].title,font:{family:"Arial, Sans",size:12,color:this.colors[h]}});o.grid={rows:1,columns:i}}this.layout=o}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout(),this.api=Plotly.newPlot(this.domNode,t,this.layout,{responsive:!0,displaylogo:!1,showTips:!1,autoscaleYAxis:!0,modeBarButtonsToRemove:["zoomIn2d","zoomOut2d","hoverCompareCartesian","hoverClosestCartesian","autoScale2d"]})}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Plotly)}}]),e}(Bt),l()(Mt.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(Mt.prototype,"prepareDataset"),Mt.prototype),l()(Mt.prototype,"addPlot",[u],Object.getOwnPropertyDescriptor(Mt.prototype,"addPlot"),Mt.prototype),l()(Mt.prototype,"parseSeries",[u],Object.getOwnPropertyDescriptor(Mt.prototype,"parseSeries"),Mt.prototype),Mt),Yt=(Ft=function(t){function e(t,r,n){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return i()(this,e),(o=w()(this,_()(e).call(this,t,"dygraphs",n))).CDN="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js",o.vendorURL="http://dygraphs.com",o.options={rollPeriod:o.getOption("rollPeriod",0),animatedZooms:o.getOption("animatedZooms",!0),showRangeSelector:o.getOption("showRangeSelector",!1)},o.hasErrorInterval=!1,o.labels=["time"],o.yLabels=[],o.layout={},o.cbkZoom=a,o}return C()(e,t),a()(e,[{key:"prepareDataset",value:function(t){var e,r;this.series=t,this.plotCount=t.length,this.hasErrorInterval=t[0].samples.min;for(var n=0;n<t.length;n++)e=t[n].title,r=t[n].unit,this.labels.push(e),this.yLabels.push("".concat(e," [").concat(r,"]"))}},{key:"parseSeries",value:function(t){var e=t.length,r=t[0].samples.values.length,n=new Array(r);if(t[0].samples.min)for(var i=0;i<r;i++){n[i]=new Array(1+e),n[i][0]=new Date(t[0].samples.times[i]);for(var o=0;o<this.plotCount;o++)n[i][o+1]=[t[o].samples.min[i],t[o].samples.values[i],t[o].samples.max[i]]}else for(var a=0;a<r;a++){n[a]=new Array(1+e),n[a][0]=new Date(t[0].samples.times[a]);for(var s=0;s<e;s++)n[a][s+1]=t[s].samples.values[a]}return n}},{key:"prepareLayout",value:function(){this.layout={rollPeriod:this.options.rollPeriod,labels:this.labels,colors:this.colors,customBars:this.hasErrorInterval,fillAlpha:.3,animatedZooms:this.options.animatedZooms,axisLabelFontSize:12,showRangeSelector:this.options.showRangeSelector,hideOverlayOnMouseOut:!1},1==this.plotCount?this.layout.ylabel='<span style="color:'.concat(this.colors[0],'">').concat(this.yLabels[0],"</span>"):2==this.plotCount?(this.layout.ylabel='<span style="color:'.concat(this.colors[0],'">').concat(this.yLabels[0],"</span>"),this.layout.y2label='<span style="color:'.concat(this.colors[1],'">').concat(this.yLabels[1],"</span>"),this.layout.series={},this.layout.series[this.labels[1]]={axis:"y"},this.layout.series[this.labels[2]]={axis:"y2"},this.layout.axes={x:{axisLineColor:"#000"},y:{axisLineColor:this.colors[0]},y2:{axisLineColor:this.colors[1]}}):this.layout.legend="always"}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout();var e=document.createElement("div");e.classList.add("dygraphWrap"),this.domNode.appendChild(e),this.api=new Dygraph(e,t,this.layout),this.series=null}},{key:"reload",value:function(){var t=this.parseSeries(this.series);this.prepareLayout(),this.api.updateOptions({file:t})}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Dygraph)}}]),e}(Bt),l()(Ft.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"prepareDataset"),Ft.prototype),l()(Ft.prototype,"render",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"render"),Ft.prototype),l()(Ft.prototype,"reload",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"reload"),Ft.prototype),Ft),qt=(Et=function(t){function e(t,r,n){var o;arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i()(this,e),(o=w()(this,_()(e).call(this,t,"uplot",r,n))).CDN="https://cdn.jsdelivr.net/gh/leeoniya/uPlot@1.0.11/dist/uPlot.iife.min.js",o.vendorURL="https://github.com/leeoniya/uPlot",o.options={title:o.getOption("title",""),width:o.getOption("width",0),height:o.getOption("height",300)},o}return C()(e,t),a()(e,[{key:"prepareDataset",value:function(t){var e,r;this.series=t,this.plotCount=t.length,this.hasErrorInterval=t[0].samples.min;for(var n=0;n<t.length;n++){var i=Math.abs(t[n].range[0]-t[n].range[1]),o=1;i<.01?o=4:i>=.01&&i<.1?o=3:i>=.1&&i<1&&(o=2),this.decimals=o,e=t[n].title,r=t[n].unit,this.yLabel="".concat(e," [").concat(r,"]")}}},{key:"parseSeries",value:function(t){t.length;var e=t[0].samples.values.length,r=new Array(2);r[0]=new Array(e);for(var n=0;n<e;n++)r[0][n]=t[0].samples.times[n]/1e3;return r[1]=t[0].samples.min,r[2]=t[0].samples.max,r[3]=t[0].samples.values,r}},{key:"prepareLayout",value:function(){var t=this.options,e=Ot(this.yLabel),r=Lt(e,.6);this.layout={title:t.title,width:t.width>0?t.width:this.domNode.offsetWidth,height:t.height,tzDate:function(t){return uPlot.tzDate(new Date(1e3*t),"Etc/UTC")},scales:{x:{range:function(t,e,r){var n=t.scales.x.min,i=t.scales.x.max;return r-e<=5*(t.data[0][1]-t.data[0][0])?[n,i]:[e,r]}}},series:[{value:"{YYYY}-{MM}-{DD} {HH}:{mm}:{ss}:{fff}"},{label:"Min",stroke:e,fill:r,width:0,spanGaps:!1,band:!0},{label:"Max",stroke:e,fill:r,width:0,spanGaps:!1,band:!0},{label:"Avg",stroke:e,spanGaps:!1,width:1}],axes:[{values:[[31536e3,"{YYYY}",7,"{YYYY}"],[2419200,"{MMM}",7,"{MMM}\n{YYYY}"],[86400,"{MMM}/{D}",7,"{MMM}/{D}\n{YYYY}"],[3600,"{HH}:{mm}",4,"{HH}:{mm}\n{MMM}/{D}"],[60,"{HH}:{mm}",4,"{HH}:{mm}\n{MMM}/{D}"],[1,"{HH}:{mm}:{ss}",4,"{HH}:{mm}:{ss}\n{MMM}/{D}"],[.1,"{ss}.{fff} s",4,"{ss}.{fff} s\n{MMM}/{D} {HH}:{mm}"]]},{label:this.yLabel}],hooks:{ready:[this.wheelZoomPlugin]}}}},{key:"wheelZoomPlugin",value:function(t){var e=this,r=t.scales.x.min,n=t.scales.x.max,i=n-r,o=t.root.querySelector(".over");o.addEventListener("wheel",(function(a){a.preventDefault();var s=o.getBoundingClientRect(),l=t.cursor.left,c=t.posToVal(l,"x"),h=t.scales.x.max-t.scales.x.min;if(!(a.deltaY<0&&h<15)){var u=a.deltaY<0?.75*h:h/.75,d=c-l/s.width*u,p=d+u;t.batch((function(){t.setScale("x",e.clamp(u,d,p,i,r,n))}))}}))}},{key:"clamp",value:function(t,e,r,n,i,o){return t>n?(e=i,r=o):e<i?(e=i,r=i+t):r>o&&(r=o,e=o-t),{min:e,max:r}}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout();var e=new uPlot(this.layout,t);this.domNode.appendChild(e.root)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof uPlot)}}]),e}(Bt),l()(Et.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(Et.prototype,"prepareDataset"),Et.prototype),l()(Et.prototype,"wheelZoomPlugin",[u],Object.getOwnPropertyDescriptor(Et.prototype,"wheelZoomPlugin"),Et.prototype),l()(Et.prototype,"render",[u],Object.getOwnPropertyDescriptor(Et.prototype,"render"),Et.prototype),Et),Wt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,"apexcharts",r))).CDN="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.19.3/apexcharts.min.js",n.vendorURL="https://apexcharts.com",n.options={chart:n.getOption("chart",n.config.isTimeSeries?"line":"scatter"),reversed:n.getOption("reversed",!1),animationDelay:n.getOption("animationDelay",0),strokeCurve:n.getOption("strokeCurve","smooth"),strokeWidth:n.getOption("strokeWidth",2)},n.mbr={xMin:999999999,xMax:0,yMin:999999999,yMax:0},n.independentAxisTitle="",n.layout={},n}return C()(e,t),a()(e,[{key:"prepareDataset",value:function(t){this.config.isTimeSeries?this.prepareTimeSeries(t):this.prepareXY(t)}},{key:"prepareTimeSeries",value:function(t){var e,r=t.length;this.datas=new Array(r);for(var n=0;n<r;n++){e=t[n].data.values.length,this.datas[n]={name:"".concat(t[n].sensorName," [").concat(t[n].unitOfMeasure,"]"),data:new Array(e)};for(var i=0;i<e;i++)this.datas[n].data[i]=[Date.parse(t[n].data.sampleTimes[i]),t[n].data.values[i]]}}},{key:"prepareXY",value:function(t){for(var e=this.config,r=t.length,n=[],i="x"==e.independent?e.x[0]:e.y[0],o=0;o<r;o++)if(t[o].id==i){n=t[o].data.values,this.independentAxisTitle="".concat(t[o].sensorName," [").concat(t[o].unitOfMeasure,"]");break}var a,s=0;this.datas=new Array(r-1);for(var l=0;l<r;l++)if(t[l].id!=i){a=t[l].data.values.length,this.datas[s]={name:"".concat(t[l].sensorName," [").concat(t[l].unitOfMeasure,"]"),data:new Array(a)};for(var c=void 0,h=void 0,u=0;u<a;u++)"x"==e.independent?(c=n[u],h=t[l].data.values[u]):(c=t[l].data.values[u],h=n[u]),c&&h?(this.datas[s].data[u]=[c,h],this.updateMBR(c,h)):(a--,this.datas[s].data.length--);s++}}},{key:"updateMBR",value:function(t,e){this.mbr.xMin>t?this.mbr.xMin=t:this.mbr.xMax<t&&(this.mbr.xMax=t),this.mbr.yMin>e?this.mbr.yMin=e:this.mbr.yMax<e&&(this.mbr.yMax=e)}},{key:"prepareLayout",value:function(){var t=this.config,e={chart:{type:this.options.chart,zoom:{enabled:!0,type:"x"},animations:{enabled:!1,easing:"easeinout",speed:800,animateGradually:{enabled:!1,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},dataLabels:{enabled:!1},stroke:{curve:this.options.strokeCurve,width:this.options.strokeWidth},colors:this.colors,xaxis:{type:t.isTimeSeries?"datetime":"numeric",tickPlacement:"on",labels:{style:{fontSize:"11px"}}},yaxis:{type:"numeric",tickPlacement:"on",labels:{style:{fontSize:"11px"},title:{text:"hello"}},axisBorder:{show:!0},axisTicks:{show:!0}},legend:{show:!0,position:"top"},grid:{xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}}},series:this.datas};t.isTimeSeries?(e.tooltip={x:{format:"dd-MMM-yyyy HH:mm:dd.ffff"}},e.xaxis.title={text:"Time"},1==this.datas.length&&(e.yaxis.title={text:this.datas[0].name},e.yaxis.seriesName=this.datas[0].name)):(e.chart.type="scatter",e.xaxis.min=this.mbr.xMin,e.xaxis.max=this.mbr.xMax,e.yaxis.min=this.mbr.yMin,e.yaxis.max=this.mbr.yMax,e.markers={size:3},e.xaxis.labels.formatter=this.truncateDecimals,"x"==t.independent?(e.xaxis.title={text:this.independentAxisTitle},1==t.y.length&&(e.yaxis.title={text:this.datas[0].name})):(e.yaxis.title={text:this.independentAxisTitle},e.yaxis=[e.yaxis],1==t.x.length&&(e.xaxis.title={text:this.datas[0].name}))),this.options.reversed&&(e.yaxis.reversed=!0,e.xaxis.position="top",e.xaxis.title.offsetY=-50),this.options.animationDelay>0&&(e.chart.animations.enabled=!0,e.chart.animations.animateGradually={enabled:!0,delay:this.options.animationDelay}),this.layout=e,console.log(e)}},{key:"truncateDecimals",value:function(t,e,r){if(t%1!=0&&t.toString().split(".")[1].length>3)return t.toFixed(3);return t}},{key:"render",value:function(){new ApexCharts(this.domNode,this.layout).render()}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof ApexCharts)}}]),e}(Bt),zt=(At=function(t){function e(t,r){var n;i()(this,e),(n=w()(this,_()(e).call(this,t,r))).engine=null,n.computedData=[],n.isTimeSeries=!0,n.plotConfig={x:[],y:[],colors:[],independent:"x",isTimeSeries:!0,horizontal:!0,engine:n.options.engine},""==n.source&&(n.source="scalardata");try{n.processFilters()}catch(t){throw t}switch(n.source){case"plottingUtility":n.ds=new ct(n._onc,n.filters,n.showLoader);break;case"scalardata":n.ds=new Dt(n._onc,n.filters,n.showLoader);break;default:throw new Error('Unrecognized data source for this plot widget: <b>"'.concat(n.source,'"</b>.'))}switch(n.options.engine.name){case"plotly":n.engine=new Ht(n.dom.content,n.plotConfig,n.options);break;case"uplot":n.engine=new qt(n.dom.content,n.plotConfig,n.options,n.cbkZoom);break;case"dygraphs":n.engine=new Yt(n.dom.content,n.plotConfig,n.options,n.cbkZoom);break;case"apexcharts":n.engine=new Wt(n.dom.content,n.plotConfig,n.options)}if(n.addons.raw&&(n.addons.raw.engine=n.engine),!n.engine.isEngineAvailable())throw n.engine.errorUnavailable();return n.ds.addPerformanceMsg("<b>Render engine:</b> ".concat(n.engine.name)),n}return C()(e,t),a()(e,[{key:"download",value:function(){var t,e=this,r=arguments;return nt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=!(r.length>0&&void 0!==r[0])||r[0],this.loaderIsVisible=t,n.abrupt("return",new Promise((function(t,r){e.ds.download().then((function(n){var i=0,o=!0,a=!1,s=void 0;try{for(var l,c=e.ds.data[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){0==l.value.samples.qaqc.length&&i++}}catch(t){a=!0,s=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}i==e.ds.data.length&&r("empty"),e.createComputedDatasets(),t(n)}),(function(t){return r(t)}))})));case 3:case"end":return n.stop()}}),null,this)}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t=!0,e=[];if(!this.plotConfig.isTimeSeries){for(var r in this.ds.data)e.push({id:this.ds.data[r].id,count:this.ds.data[r].data.values.length});for(var n=0;n<e.length-1;n++)e[n].count!=e[n+1].count&&(t=!1)}if(t)this.engine.prepareDataset(this.ds.data),this.statusBox.remove(),this.dom.base.classList.add("eng_"+this.engine.name),this.engine.render(),this.ds.clear();else{var i="All sensors in xy plots must have the same number of samples.<ul>",o=!0,a=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;i+="<li>Sensor ".concat(h.id," has ").concat(h.count," samples</li>")}}catch(t){a=!0,s=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}this.showStatus("error",i+"</ul>")}}else this.showStatus("info","No sensor data found for the filters specified.")}},{key:"cbkZoom",value:function(t,e,r){var n=this;this.ds.reload(S()(t),S()(e)).then((function(t){n.engine.prepareDataset(t),n.engine.reload()}))}},{key:"loadLocation",value:function(){var t=this;this.ds.sensorIds[0];if(this.filters.deviceId){var e=this.filters.deviceId;return new Promise((function(r,n){var i,o,a,s,l;return nt.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,nt.a.awrap(t._onc.getDevices({deviceId:e}));case 2:if(200!=(i=c.sent).status||1!=i.data.length){c.next=13;break}return o=i.data[0].deviceCode,a=t.filters.dateFrom,s=t.filters.dateTo,c.next=9,nt.a.awrap(t._onc.getLocations({deviceCode:o,dateFrom:a,dateTo:s}));case 9:200==(l=c.sent).status&&1==l.data.length&&(t.location=l.data[0],r(t)),c.next=14;break;case 13:n("Couldn't get device with id ".concat(e));case 14:case"end":return c.stop()}}))}))}return new Promise((function(t,e){e("loadLocation(): Missing mandatory filter 'deviceId'")}))}},{key:"processFilters",value:function(){var t=this.filters;if(t.x||t.y){if(!t.x||!t.y)throw new Error("Both <b>data-x</b> and <b>data-y</b> are required for plots that are not time series.");switch(this.plotConfig.isTimeSeries=!1,this.plotConfig.x=z(t.x),this.plotConfig.y=z(t.y),1==this.plotConfig.y.length&&this.plotConfig.x.length>1&&(this.plotConfig.independent="y",this.plotConfig.horizontal=!1),delete this.filters.x,delete this.filters.y,this.source){case"plottingUtility":this.filters.sensorId=this.stringifySensorIds();break;case"scalardata":this.filters.sensorCategoryCodes=this.stringifySensorIds();break;case"dataProductDelivery":throw new Error("dataProductDelivery doesn't support multiple propertyCode yet.")}}else t.sensorId?this.plotConfig.y=z(t.sensorId):t.propertyCode&&(this.plotConfig.y=z(t.propertyCode));if(null!=this.plotConfig.engine.name&&""!=this.plotConfig.engine.name||(this.plotConfig.engine.name="plotly"),t.propertyCode&&t.propertyCode.indexOf(",")>-1&&(t.sensorCategoryCodes=t.propertyCode,delete t.propertyCode,this.addWarning("Multiple property codes detected in 'propertyCode'. Renamed attribute to 'sensorCategoryCodes' as required by the API.")),"dataProductDelivery"==this.source&&"average"==t.dpo_resample){var e=S.a.utc(t.dateFrom),r=S.a.utc(t.dateTo);if(r.diff(e,"second")<=t.dpo_average)throw new Error("The date range requested (".concat(r.diff(e,"second")," seconds) is too short for the resample period (").concat(t.dpo_average,") specified in <b>dpo_average</b>."))}}},{key:"createComputedDatasets",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this.computedData[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.compute(this.sensorData[0].data.sampleTimes,this.sensorData[0].data.values)}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"parseChildren",value:function(){var t=this;this.baseNode.querySelectorAll(".computed").forEach((function(e,r){t.computedData.push(new St(r,e))}))}},{key:"stringifySensorIds",value:function(){return this.plotConfig.x.concat(this.plotConfig.y).join(",")}}]),e}(ut),l()(At.prototype,"download",[u],Object.getOwnPropertyDescriptor(At.prototype,"download"),At.prototype),l()(At.prototype,"cbkZoom",[u],Object.getOwnPropertyDescriptor(At.prototype,"cbkZoom"),At.prototype),l()(At.prototype,"loadLocation",[u],Object.getOwnPropertyDescriptor(At.prototype,"loadLocation"),At.prototype),At),Vt=(Rt=function(){function t(e,r){i()(this,t),this.ds=e,this.bufferTime=g(r,"bufferTime",2e3),this.data=[],this.next=[],this.duration=0,this.pos=0,this.nextStartPos=0,this.timePerSample=0,this.retryDelay=0,this.doStall=!1,this.isWaitingNextData=!1}return a()(t,[{key:"nextSample",value:function(){var t=this.data.length;if(this.pos<this.data[0].length){for(var e=new Array(t),r=0;r<t;r++)e[r]=this.data[r][this.pos];return this.pos++,e}if(!(this.next.length>0))return this.isWaitingNextData?null:(console.warn("Forcing a bufferTime increase to avoid drowning."),this.bufferTime+=1e3,this.scheduleNextPoll(this.bufferTime),null);this.data=this.next.slice(),this.next=[],this.pos=this.nextStartPos,this.nextStartPos=0;var n=this.data[0].length;this.duration=this.data[0][n-1].x-this.data[0][this.pos].x,this.timePerSample=this.duration/n,this.duration<2*this.bufferTime&&(this.doStall=!0),this.scheduleNextPoll(this.duration-this.bufferTime)}},{key:"start",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(n){0!=n[0].data.values.length?(t.data=new Array(n.length),t.next=new Array(n.length),t.storeData(n,"current"),t.scheduleNextPoll(t.duration-t.bufferTime),e(n)):1==t.ds.sensorIds.length?r(new Error("No recent data found for the sensor ".concat(t.ds.sensorIds[0],"."))):r(new Error("No recent data found for the sensors: ".concat(t.ds.sensorIds.join(","),".")))}),(function(t){return r(t)}))}))}},{key:"requestNextData",value:function(){var t=this;this.ds.refreshDateRangeFilters(),this.ds.download(!1).then((function(e){t.storeData(e,"next");for(var r=0,n=t.data[0],i=n[n.length-1].x;t.next[0][r].x<=i;)r++;t.nextStartPos=r,t.isWaitingNextData=!1}),(function(e){t.scheduleNextPoll(null)}))}},{key:"storeData",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"current",r=0;r<t.length;r++){var n=t[r].data,i=n.sampleTimes.length;if("current"==e){var o=n.sampleTimes[0],a=n.sampleTimes[i-1];this.duration=Date.parse(a)-Date.parse(o),this.timePerSample=this.duration/i,this.data[r]=new Array(i);for(var s=0;s<i;s++)this.data[r][s]={x:Date.parse(n.sampleTimes[s]),y:n.values[s]}}else{this.next[r]=new Array(i);for(var l=0;l<i;l++)this.next[r][l]={x:Date.parse(n.sampleTimes[l]),y:n.values[l]}}}}},{key:"getMaxValue",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=-9999999;if(this.data[t].length>0)for(var r=0;r<this.data[t].length;r++)this.data[t][r].y>e&&(e=this.data[t][r].y);if(this.next[t].length>0)for(var n=0;n<this.next[t].length;n++)this.next[t][n].y>e&&(e=this.next[t][n].y);return e}},{key:"getMinValue",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=99999999;if(this.data[t].length>0)for(var r=0;r<this.data[t].length;r++)this.data[t][r].y<e&&(e=this.data[t][r].y);if(this.next[t].length>0)for(var n=0;n<this.next[t].length;n++)this.next[t][n].y<e&&(e=this.next[t][n].y);return e}},{key:"getFirstTS",value:function(){return this.data.length>0&&this.data[0].length>0?this.data[0][0].x:null}},{key:"estimateValueWidth",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=5;if(this.data[e].length>0)for(var n=0;n<this.data[e].length;n++)(t="".concat(this.data[e][n].y)).length>r&&(r=t.length);return r}},{key:"scheduleNextPoll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t?(t=this.retryDelay,this.retryDelay+=1e3):t<0&&(t=0),this.doStall&&(console.warn("Stalling delay ".concat(t," with extra ").concat(this.bufferTime," ms")),t+=this.bufferTime,this.doStall=!1),setTimeout(this.requestNextData,t),this.isWaitingNextData=!0}},{key:"getMetadata",value:function(){for(var t=this.ds.data.length,e=new Array(t),r=0;r<t;r++)e[r]={id:this.ds.data[r].id,sensorName:this.ds.data[r].sensorName,unitOfMeasure:this.ds.data[r].unitOfMeasure};return e}}]),t}(),l()(Rt.prototype,"nextSample",[u],Object.getOwnPropertyDescriptor(Rt.prototype,"nextSample"),Rt.prototype),l()(Rt.prototype,"start",[u],Object.getOwnPropertyDescriptor(Rt.prototype,"start"),Rt.prototype),l()(Rt.prototype,"requestNextData",[u],Object.getOwnPropertyDescriptor(Rt.prototype,"requestNextData"),Rt.prototype),Rt),$t=function(){function t(e,r,n,o){i()(this,t),this.domNode=r,this.name=e,this.options=n,this.rts=o,this.CDN="",this.vendorURL="",this.colors=[],this.colorDefaults=Tt(12);var a=g(n,"min",null),s=g(n,"max",null);this.minValue=a?z(a,";"):null,this.maxValue=s?z(s,";"):null,this.parseColors()}return a()(t,[{key:"parseColors",value:function(){this.colors=this.colorDefaults;var t=this.getOption("colors",null);if(t){var e=t.split(";");if(e)for(var r=0;r<e.length;r++)this.colors[r]=e[r];else this.colors[0]=t}}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g(this.options,t,e)}},{key:"errorUnavailable",value:function(){return new Error('<p>The real time engine <b>"'.concat(this.name,'"</b> is unavailable.</p>\n\t\t<p>You can add this library as a <em>&lt;script&gt;</em> with the <em>src</em>: <a href="').concat(this.CDN,'" target="_BLANK">').concat(this.CDN,'</a></p>\n\t\t<p>You can also obtain the original library at <a href="').concat(this.vendorURL,'" target="_BLANK">').concat(this.vendorURL,"</a>.</p>"))}}]),t}(),Kt=(It=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"smoothie",t,r,n))).CDN="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.min.js",o.vendorURL="http://smoothiecharts.org",o.line=null,o.smoothie=null,o.layout={},o.options={decimals:o.getOption("decimals",3),delay:o.getOption("delay",1e3),bufferTime:o.getOption("bufferTime",2e3),speed:o.getOption("speed",50)},o}return C()(e,t),a()(e,[{key:"prepareLayout",value:function(){this.layout={millisPerPixel:this.options.speed,interpolation:"linear",grid:{fillStyle:"#ffffff",strokeStyle:"#d0d0d0",sharpLines:!0,borderVisible:!1,verticalSections:4,millisPerLine:5e3},labels:{fillStyle:"#333",precision:this.options.decimals,showIntermediateLabels:!0,intermediateLabelSameAxis:!0},tooltip:!0,responsive:!0,nonRealtimeData:!1}}},{key:"render",value:function(){var t=this;this.line=new TimeSeries;var e=this.rts.getMaxValue(),r=this.rts.getMinValue();this.line.maxValue=1.1*r,this.line.minValue=1.1*e;var n=document.createElement("canvas");n.height="100",this.domNode.appendChild(n),this.smoothie=new SmoothieChart(this.layout),this.smoothie.streamTo(n,this.options.delay),this.smoothie.addTimeSeries(this.line,{lineWidth:2,strokeStyle:this.colors[0]}),setInterval((function(){var e=t.rts.nextSample();e&&t.line.append(Date.now(),e[1])}),this.rts.timePerSample)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof SmoothieChart)}}]),e}($t),l()(It.prototype,"render",[u],Object.getOwnPropertyDescriptor(It.prototype,"render"),It.prototype),It),Xt=(Ut=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"chartjs",t,r,n))).CDN="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js",o.vendorURL="https://www.chartjs.org",o.chart=null,o.layout={},o.dataInfo=[],o.domValueBlocks=[],o.options={decimals:o.getOption("decimals",3),delay:o.getOption("delay",1e3),bufferTime:o.getOption("bufferTime",2e3),speed:o.getOption("speed",2e4)},o}return C()(e,t),a()(e,[{key:"prepareLayout",value:function(){this.dataInfo=this.rts.getMetadata();for(var t=this.dataInfo,e=Date.now()-this.rts.getFirstTS(),r=[],n=[],i=0;i<t.length;i++){var o="".concat(t[i].sensorName," [").concat(t[i].unitOfMeasure,"]");r.push({label:o,data:[],borderColor:this.colors[i],backgroundColor:this.colors[i],fill:!1,yAxisID:"y-axis-".concat(i)});var a={display:!0,type:"linear",scaleLabel:{display:!0,labelString:o,fontColor:this.colors[i]},ticks:{fontColor:this.colors[i]},position:i%2==0?"left":"right",id:"y-axis-".concat(i),gridLines:{drawOnChartArea:!1}};this.minValue&&(a.ticks.min=+this.minValue[i]),this.maxValue&&(a.ticks.max=+this.maxValue[i]),n.push(a)}n[0].gridlines={},this.layout={type:"line",data:{datasets:r},options:{responsive:!0,scales:{xAxes:[{type:"realtime",realtime:{duration:this.options.speed,refresh:this.rts.timePerSample,onRefresh:this.addSample,delay:e+this.options.delay}}],yAxes:n},tooltips:{mode:"nearest",intersect:!1},hover:{mode:"nearest",intersect:!1},legend:{display:!1}}}}},{key:"addSample",value:function(){var t=this.rts.nextSample();if(t)for(var e=0;e<t.length;e++)this.chart.data.datasets[e].data.push(t[e]),this.domValueBlocks[e].innerHTML=t[e].y}},{key:"render",value:function(){var t=document.createElement("div");t.classList.add("legend");for(var e=this.dataInfo,r=[],n=0;n<e.length;n++)r.push('<span class="value idx_'.concat(n,'" style="background: ').concat(this.colors[n],'"></span> ').concat(e[n].sensorName," [").concat(e[n].unitOfMeasure,"]"));t.innerHTML="<ul>"+B(r,"li")+"</ul>",this.domNode.appendChild(t);for(var i=0;i<e.length;i++)this.domValueBlocks.push(t.querySelector("span.idx_"+i)),this.domValueBlocks[i].style.width=6*this.rts.estimateValueWidth(i)+16+"px";var o=document.createElement("canvas"),a=o.getContext("2d");this.domNode.appendChild(o),this.chart=new Chart(a,this.layout)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Chart)}}]),e}($t),l()(Ut.prototype,"addSample",[u],Object.getOwnPropertyDescriptor(Ut.prototype,"addSample"),Ut.prototype),l()(Ut.prototype,"render",[u],Object.getOwnPropertyDescriptor(Ut.prototype,"render"),Ut.prototype),Ut),Zt=(jt=function(t){function e(t,r){var n;switch(i()(this,e),(n=w()(this,_()(e).call(this,t,r))).engine=null,""==n.source&&(n.source="scalardata"),n.source){case"plottingUtility":n.ds=new ct(n._onc,n.filters,n.showLoader);break;case"scalardata":n.ds=new Dt(n._onc,n.filters,n.showLoader);break;default:throw new Error('Unrecognized data source for this plot widget: <b>"'.concat(n.source,'"</b>.'))}n.ds.userDates=n.parser.userDates;var o=n.options.engine;switch(n.rts=new Vt(n.ds,o),null!=o.name&&""!=o.name||(o.name="smoothie"),n.options.engine.name){case"smoothie":n.engine=new Kt(n.dom.content,o,n.rts);break;case"chartjs":n.engine=new Xt(n.dom.content,o,n.rts)}if(!n.engine.isEngineAvailable())throw n.engine.errorUnavailable();return n.ds.addPerformanceMsg("<b>Render engine:</b> ".concat(n.engine.name)),n.dom.base.classList.add("eng_"+n.engine.name),n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.rts.start().then((function(r){t.engine.prepareLayout(),t.loaderIsVisible=!1,e(r)}),(function(t){return r(t)}))})));case 1:case"end":return e.stop()}}))}},{key:"renderContents",value:function(){this.ds.hasData()?(this.statusBox.remove(),this.engine.render()):this.showStatus("info","No sensor data found for the filters specified.")}}]),e}(ut),l()(jt.prototype,"download",[u],Object.getOwnPropertyDescriptor(jt.prototype,"download"),jt.prototype),jt),Jt=(Nt=function(t){function e(t,r,n){var o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return i()(this,e),(o=w()(this,_()(e).call(this,"dataProductDelivery")))._onc=t,o.filters=r,o.storeProduct=a,o.dpRequestId=0,o.dpRunId=0,o.pollCount=0,o.fileCount=0,o.payloadSize=0,o.contentTypes=[],o.downloadURLs=[],o.autocompleteFilters(),o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"autocompleteFilters",value:function(){var t=this.filters.dataProductCode,e=this.filters.extension;"TSSP"==t&&"png"==e&&function(t,e){if(t){var r=Object.keys(t);for(var n in r)e[r[n]]=t[r[n]]}}({dpo_qualityControl:1,dpo_resample:"none"},this.filters)}},{key:"download",value:function(){var t=this;return this.data=[],this.logDownloadStart(),this.cbkShowLoader("loading","Requesting data product"),new Promise((function(e,r){var n,i;return nt.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(!t.cancelled){o.next=3;break}return r("cancelled"),o.abrupt("return");case 3:return o.prev=3,o.next=6,nt.a.awrap(t._onc.productRequest(t.filters));case 6:if(n=o.sent,!t.cancelled){o.next=9;break}throw"cancelled";case 9:t.cbkShowLoader("waiting","Waiting for data product"),t.dpRequestId=n.data.dpRequestId,t.saveRequestURL(n),i=0;case 13:if(200==i){o.next=21;break}return o.next=16,nt.a.awrap(t.run());case 16:if(i=o.sent,!t.cancelled){o.next=19;break}throw"cancelled";case 19:o.next=13;break;case 21:if(t.addDownloadURLs(),!t.storeProduct){o.next=29;break}if(!(t.fileCount>0)){o.next=28;break}return o.next=26,nt.a.awrap(t.downloadFileBlobs());case 26:o.next=29;break;case 28:throw"empty";case 29:t.logDownloadEnd(),e(),o.next=38;break;case 33:return o.prev=33,o.t0=o.catch(3),o.t0.response&&t.saveRequestURL(o.t0.response),r(o.t0),o.abrupt("return");case 38:case"end":return o.stop()}}),null,null,[[3,33]])}))}},{key:"run",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt.a.awrap(this._onc.productRun({dpRequestId:this.dpRequestId}));case 2:return t=e.sent,0==this.pollCount&&this.saveRequestURL(t),this.pollCount++,200==t.status?(this.dpRunId=t.data[0].dpRunId,this.fileCount=t.data[0].fileCount,this.cbkShowLoader("downloading","Downloading ".concat(this.fileCount," files"))):this.cbkShowLoader("waiting","(".concat(t.statusText,") ").concat(t.data[0].status)),e.abrupt("return",t.status);case 7:case"end":return e.stop()}}),null,this)}},{key:"requestStatus",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt.a.awrap(this._onc.productStatus({dpRequestId:this.dpRequestId}));case 2:return t=e.sent,this.pollCount++,this.onRunEnd&&this.onRunEnd(t),e.abrupt("return",202);case 6:case"end":return e.stop()}}),null,this)}},{key:"downloadFileBlobs",value:function(){var t,e;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:t=1;case 1:if(!(t<=this.fileCount)){r.next=9;break}return r.next=4,nt.a.awrap(this._onc.productDownload({dpRunId:this.dpRunId,index:t}));case 4:200==(e=r.sent).status&&(this.saveRequestURL(e),this.data.push(e.data),this.payloadSize+=e.data.length,this.contentTypes.push(e.headers["content-type"]));case 6:t++,r.next=1;break;case 9:case"end":return r.stop()}}),null,this)}},{key:"addDownloadURLs",value:function(){for(var t=1;t<=this.fileCount;t++)this.downloadURLs.push(this._onc.getProductDownloadURL(this.dpRunId,t))}},{key:"saveRequestURL",value:function(t){var e=t.request.responseURL;this._onc.useProxy&&(e=t.config.headers["X-Proxy-Url"]+e.substr(t.config.url.length)),this.requestURLs.push(e)}}]),e}(ot),l()(Nt.prototype,"download",[u],Object.getOwnPropertyDescriptor(Nt.prototype,"download"),Nt.prototype),Nt),Qt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,"quickPlot"))).filters=t,n.baseUrl="https://data.oceannetworks.ca/Plot",n.fileCount=0,n.cbkShowLoader=r,n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return this.data=[],new Promise((function(e,r){var n,i,o;return nt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.cancelled){a.next=3;break}return r("cancelled"),a.abrupt("return");case 3:n="on"==t.filters.plotTitle?"on":"off",i={sensorId:t.filters.sensorId,datefrom:S.a.utc(t.filters.dateFrom).format("DD-MMM-YYYY HH:mm:ss"),dateto:S.a.utc(t.filters.dateTo).format("DD-MMM-YYYY HH:mm:ss"),plotwidth:320,plotheight:240,plottitle:n},(o=Object.assign({},i)).plotwidth=800,o.plotheight=600,t.data.push({thumb:t.baseUrl+"?"+t.stringifyFilters(i),url:t.baseUrl+"?"+t.stringifyFilters(o)}),t.fileCount++,e();case 11:case"end":return a.stop()}}))}))}},{key:"stringifyFilters",value:function(t){for(var e="",r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.length>0&&(e+="&"),e+="".concat(i,"=").concat(encodeURI(t[i]))}return e}}]),e}(ot),te=(Gt=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,"dataPreview"))).filters=t,n.baseUrl="https://data.oceannetworks.ca/DataPreviewService",n._axios=f.a.create({method:"get",baseURL:n.baseUrl,timeout:12e4}),n.downloadURLs=[],n.fileCount=0,n.cbkShowLoader=r,n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;this.downloadURLs=[],this.parseUrl(this.filters),this.parseRange(this.filters);var e={url:this.baseUrl,params:this.params};return new Promise((function(r,n){t._axios.request(e).then((function(e){if(0===e.data.length&&n("empty"),!e.data.payload.filePath)return n({message:"No data preview image could be found matching the parameters."});var i=e.data.payload.filePath;t.downloadURLs.push(i),t.fileCount++,r(i)}),(function(t){n(t)}))}))}},{key:"parseUrl",value:function(t){if(t.url){var e=t.url.split("?")[1].split("&"),r={},n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value.split("=");r[l[0]]=l[1]}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}this.params={operation:g(r,"operation",10),searchTreeNodeId:g(r,"searchTreeNodeId",0),deviceCategoryId:g(r,"deviceCategoryId",0),sensorCodeId:y(r,"sensorCodeId",null),timeConfigId:g(r,"timeConfigId",1),dataProductFormatId:g(r,"dataProductFormatId",3),plotNumber:g(r,"plotNumber",1)}}}},{key:"parseRange",value:function(t){if(t.range){var e=t.range;this.params.timeConfigId="last1y"==e||"last12M"==e?4:"last30d"==e||"last4w"==e||"last1M"==e?3:"last7d"==e||"last1w"==e?2:1}}}]),e}(ot),l()(Gt.prototype,"download",[u],Object.getOwnPropertyDescriptor(Gt.prototype,"download"),Gt.prototype),Gt);r(81);var ee,re,ne,ie=function(t){function e(t,r){var n;if(i()(this,e),(n=w()(this,_()(e).call(this,t,r))).cancelled)return w()(n);switch(n.source){case"quickPlot":n.ds=new Qt(n.filters,n.showLoader);break;case"dataProductDelivery":n.ds=new Jt(n._onc,n.filters,n.showLoader);break;case"dataPreview":n.ds=new te(n.filters,n.showLoader);break;default:throw'Invalid data source: "'.concat(n.source,'"')}return n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(t){e(t)}),(function(t){return r(t)}))}))}},{key:"renderContents",value:function(){var t=this.ds.fileCount;if(0!=t){this.showLoader("downloading","Downloading..."),this.ds.addPerformanceMsg("Payload size does not include the images downloaded by this widget.");for(var e=0;e<t;e++)this.renderImage(e)}}},{key:"renderImage",value:function(t){var e="",r="";switch(this.source){case"quickPlot":e=this.ds.data[t].url,r=this.ds.data[t].thumb;break;case"dataProductDelivery":case"dataPreview":e=this.ds.downloadURLs[t],r=this.ds.downloadURLs[t]}switch(this.ds.addRequestURL(e),this.options.theme){case"default":this.theme_default(e);break;case"plain":this.theme_plain(e);break;case"gallery":this.theme_gallery(e,r)}}},{key:"theme_default",value:function(t){var e=this,r=new Image;r.onload=function(){return e.statusBox.remove()},r.src=t,r.classList.add("oncImage"),this.dom.content.appendChild(r)}},{key:"theme_plain",value:function(t){var e=this,r=new Image;r.onload=function(){return e.statusBox.remove()},r.onerror=function(){e.statusBox.remove(),e.showStatus("error","Failed to download image")},r.src=t,this.dom.content.appendChild(r)}},{key:"theme_gallery",value:function(t,e){var r=this,n=document.createElement("div");n.classList.add("thumb");var i=document.createElement("div");i.className="oncBackdrop",i.innerHTML='<span class="btClose" onclick="this.parentNode.click()">&otimes;</span><img src="'.concat(t,'">'),i.onclick=function(t){t.target.className.includes("oncBackdrop")&&this.classList.remove("active")},n.appendChild(i);var o=new Image;o.onload=function(){return r.statusBox.remove()},o.onerror=function(t){r.statusBox.remove(),r.showStatus("error","Failed to download image")},o.src=e,o.className="oncImageThumb",o.onclick=function(){var t=this.parentNode.querySelector("div.oncBackdrop");t.classList.add("active");var e=t.querySelector("img");""==e.className?(wheelzoom(e),e.className="zoomable",e.onmouseup="event.stopPropagation()"):e.dispatchEvent(new Event("wheelzoom.reset"))},n.appendChild(o),this.dom.content.appendChild(n)}}]),e}(ut),oe=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).ds=new Jt(n._onc,n.filters,n.showLoader),n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.ds.download().then((function(t){e(t)}),(function(t){return r(t)}))})));case 1:case"end":return e.stop()}}))}},{key:"renderContents",value:function(){var t=this.ds.fileCount;if(0!=t){this.statusBox.remove();for(var e=[],r="",n="",i=0;i<t;i++)r=this.ds.downloadURLs[i],n=this.filters.extension,e.push('<a href="'.concat(r,'">Data product ').concat(i+1," (").concat(n,")</a>"));this.domNode.innerHTML='<ul class="download">'.concat(B(e,"li"),"</ul>")}}}]),e}(ut),ae=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"rawdata")))._onc=t,o.filters=r,o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.filters.dateFrom||t.filters.dateTo||(t.filters.dateFrom="-P0Y0M0DT0H1M0S",t.filters.rowLimit="3",t.filters.getLatest=!0),t._onc.getRawData(t.filters).then((function(r){t.data=r.data.data,e(t.data)}),(function(t){r(t)}))}))}}]),e}(ot),se=(ee=function(t){function e(t,r){var n;i()(this,e),(n=w()(this,_()(e).call(this,t,r))).delay=g(n.options,"delay",2e3),n.maxLogRows=g(n.options,"maxLogRows","100"),n.formatter=null;var o=g(n.options,"formatter","");return""!=o&&void 0!==window[o]&&(n.formatter=window[o]),n.ds=new ae(n._onc,n.filters,n.showLoader),n.logCount=0,n}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(n){t.ds.data&&t.ds.data.length>0?(setTimeout(t.requestData,t.delay),e(n)):r(new Error("No recent data found for the filters provided."))}),(function(t){return r(t)}))}))}},{key:"requestData",value:function(){var t=this;this.ds.download().then((function(e){t.displayData(t.ds.data),setTimeout(t.requestData,t.delay)}),(function(t){console.log(t)}))}},{key:"displayData",value:function(t){this.domNode.querySelector("tr.dataRow").innerHTML=this.renderElement(t[0]);var e=this.formatter?this.formatter(t[0].rawData):t[0].rawData,r=this.domNode.querySelector("tr.logRow ul"),n=document.createElement(n);n.innerHTML="<li>".concat(t[0].sampleTime," ").concat(e,"</li>"),r.prepend(n),this.logCount++,this.logCount>this.maxLogRows&&r.removeChild(r.lastElementChild)}},{key:"renderContents",value:function(){var t="";t+='<tr class="dataRow console">'+this.renderElement(this.ds.data[0])+"</tr>",t+='<tr class="logRow"><td colspan="4"><ul></ul></td></tr>',this.domNode.innerHTML=H(["Date","Time","Line Type","Data"],t)}},{key:"renderElement",value:function(t){var e=t.sampleTime.split("T"),r=e[0],n=e[1].substr(0,e[1].length-1),i=t.rawData;return this.formatter&&(i=this.formatter(i)),B([r,n,'"'+t.lineType+'"',i],"td",",,center,")}}]),e}(ut),l()(ee.prototype,"requestData",[u],Object.getOwnPropertyDescriptor(ee.prototype,"requestData"),ee.prototype),l()(ee.prototype,"displayData",[u],Object.getOwnPropertyDescriptor(ee.prototype,"displayData"),ee.prototype),ee),le=(re=function(t){function e(t,r,n){var o;return i()(this,e),(o=w()(this,_()(e).call(this,"archivefiles")))._onc=t,o.filters=Object.assign({},r),o.extension=[],o.origin=o.originType(),o.single=!0,o.parseDates=!1,o.parseExtension=!0,o.parseOrigins(),o.filters.extension&&(o.extension=z(o.filters.extension),delete o.filters.extension),o.cbkShowLoader=n,o}return C()(e,t),a()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cbkShowLoader("loading","Requesting archive files"),e.abrupt("return",new Promise((function(e,r){var n,i,o,a,s,l,c,h,u,d,p,f,g,y;return nt.a.async((function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,t.logDownloadStart(),!t.single){v.next=11;break}return v.next=5,nt.a.awrap(t.downloadElement(t.filters));case 5:return t.data=v.sent,t.logDownloadEnd(),e(t.data),v.abrupt("return");case 11:if(t.data=[],"device"!=t.origin){v.next=45;break}o=!0,a=!1,s=void 0,v.prev=16,l=t.filters.deviceCode[Symbol.iterator]();case 18:if(o=(c=l.next()).done){v.next=29;break}return h=c.value,(n=Object.assign({},t.filters)).deviceCode=h,v.next=24,nt.a.awrap(t.downloadElement(n));case 24:i=v.sent,t.data.push({deviceCode:h,files:i});case 26:o=!0,v.next=18;break;case 29:v.next=35;break;case 31:v.prev=31,v.t0=v.catch(16),a=!0,s=v.t0;case 35:v.prev=35,v.prev=36,o||null==l.return||l.return();case 38:if(v.prev=38,!a){v.next=41;break}throw s;case 41:return v.finish(38);case 42:return v.finish(35);case 43:v.next=76;break;case 45:if("location"!=t.origin){v.next=76;break}u=!0,d=!1,p=void 0,v.prev=49,f=t.filters.locationCode[Symbol.iterator]();case 51:if(u=(g=f.next()).done){v.next=62;break}return y=g.value,(n=Object.assign({},t.filters)).locationCode=y,v.next=57,nt.a.awrap(t.downloadElement(n));case 57:i=v.sent,t.data.push({locationCode:y,files:i});case 59:u=!0,v.next=51;break;case 62:v.next=68;break;case 64:v.prev=64,v.t1=v.catch(49),d=!0,p=v.t1;case 68:v.prev=68,v.prev=69,u||null==f.return||f.return();case 71:if(v.prev=71,!d){v.next=74;break}throw p;case 74:return v.finish(71);case 75:return v.finish(68);case 76:t.logDownloadEnd(),e(t.data),v.next=84;break;case 80:v.prev=80,v.t2=v.catch(0),t.logDownloadEnd(),r(v.t2);case 84:case"end":return v.stop()}}),null,null,[[0,80],[16,31,35,43],[36,,38,42],[49,64,68,76],[69,,71,75]])})));case 2:case"end":return e.stop()}}),null,this)}},{key:"downloadElement",value:function(t){var e=this;return new Promise((function(r,n){e._onc.getArchiveFileList(t).then((function(t){e.addRequestURL(t.request.responseURL);var n=Array(),i=e.parseExtension;if(e.extension.length>0)for(var o,a="",s=0;s<t.data.files.length;s++)a=$((o=t.data.files[s]).filename),e.extension.includes(a)&&(e.parseDates&&(o.dateFrom=S()(o.dateFrom).utc().valueOf(),o.dateTo=S()(o.dateTo).utc().valueOf()),i&&(o.extension=a),n.push(o));else if(n=t.data.files,e.parseDates)for(var l=0;l<n.length;l++)n[l].dateFrom=S()(n[l].dateFrom).utc().valueOf(),n[l].dateTo=S()(n[l].dateTo).utc().valueOf(),i&&(n[l].extension=$(n[l].filename));e.performance.downloadSize+=t.request.responseText.length,r(n)}),(function(t){n(t)}))}))}},{key:"originType",value:function(){return this.filters.deviceCode?"device":"location"}},{key:"parseOrigins",value:function(){this.single=!0,"device"==this.origin&&this.filters.deviceCode.indexOf(",")>=0&&(this.filters.deviceCode=z(this.filters.deviceCode),this.single=!1),"location"==this.origin&&this.filters.locationCode.indexOf(",")>=0&&(this.filters.locationCode=z(this.filters.locationCode),this.single=!1)}}]),e}(ot),l()(re.prototype,"download",[u],Object.getOwnPropertyDescriptor(re.prototype,"download"),re.prototype),l()(re.prototype,"downloadElement",[u],Object.getOwnPropertyDescriptor(re.prototype,"downloadElement"),re.prototype),re);S.a.extend(P.a);var ce,he,ue=(ne=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).filters.returnOptions="all",n.variant=n.getOption("variant","default"),n.ds=new le(r,n.filters,n.showLoader),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData())switch(this.variant){case"default":this.renderDefault();break;case"summary":this.renderSummary();break;default:throw Error('invalid variant: "'.concat(this.variant,'"'))}else this.showStatus("info","No data found for the filters provided.")}},{key:"renderSummary",value:function(){var t=[],e=[],r="",n="",i=!0,o=!1,a=void 0;try{for(var s,l=this.ds.data[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if(r=$(c.filename),n="".concat(c.dataProductCode,".").concat(r),e.includes(n)){t[n].count++;var h=S()(c.dateFrom).utc(),u=S()(c.dateTo).utc();h<t[n].dateFrom&&(t[n].dateFrom=h),u>t[n].dateTo&&(t[n].dateTo=u),t[n].size+=c.uncompressedFileSize}else t[n]={count:1,dateFrom:S()(c.dateFrom).utc(),dateTo:S()(c.dateTo).utc(),size:c.uncompressedFileSize,extension:r,dataProductCode:c.dataProductCode},e.push(n)}}catch(t){o=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}var d="";for(var p in t)d+="<tr>".concat(this.renderDpSummary(p,t[p]),"</tr>");this.dom.content.innerHTML=H(["DP Code","Extension","Count","From (min)","To (max)","File size (total)"],d)}},{key:"renderDpSummary",value:function(t,e){var r=E(e.dateFrom,"YYYY-MM-DD HH:mm:ss"),n=E(e.dateTo,"YYYY-MM-DD HH:mm:ss");return B([e.dataProductCode,e.extension,e.count,r,n,V(e.size)],"td")}},{key:"renderDefault",value:function(){var t="",e=!0,r=!1,n=void 0;try{for(var i,o=this.ds.data[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t+="<tr>"+this.renderArchiveInfo(a)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["DP Code","Filename","From","To","File size"],t)}},{key:"renderArchiveInfo",value:function(t){var e="https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(this._onc.token,"&filename=").concat(t.filename),r='<a target="_blank" href="'.concat(e,'">').concat(t.filename,"</a>"),n=E(t.dateFrom,"YYYY-MM-DD HH:mm:ss"),i=E(t.dateTo,"YYYY-MM-DD HH:mm:ss"),o=V(t.uncompressedFileSize);return B([t.dataProductCode,r,n,i,o],"td")}}]),e}(ut),l()(ne.prototype,"download",[u],Object.getOwnPropertyDescriptor(ne.prototype,"download"),ne.prototype),l()(ne.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(ne.prototype,"renderContents"),ne.prototype),ne),de=(ce=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).widgetW=n.getOption("width"),n.widgetH=n.getOption("height"),n.domPager=null,n.images=[],n.f=0,n.interval=null,n.count=0,n.period=n.getOption("delay",500),n.filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){var t=this;this.count=this.ds.data.length;var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e.push("https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(this._onc.token,"&filename=").concat(s.filename))}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}var l=this.count,c=new Image;this.images.push(c);var h=document.createElement("div");h.classList.add("imgGif"),h.appendChild(c),c.onload=function(){if(t.statusBox.remove(),c.classList.add("fadeIn"),t.widgetW&&t.widgetH)h.style.width="".concat(t.widgetW),h.style.height="".concat(t.widgetH);else if(t.widgetW||t.widgetH){var r=c.naturalHeight/c.naturalWidth;t.widgetW?(h.style.width="".concat(t.widgetW,"px"),h.style.height="".concat(t.widgetW*r,"px")):(h.style.height="".concat(t.widgetH,"px"),h.style.width="".concat(t.widgetH/r,"px"))}else h.style.width="".concat(c.naturalWidth,"px"),h.style.height="".concat(c.naturalHeight,"px");for(var n=1;n<l;n++){var i=new Image;i.src=e[n],t.images.push(i),h.appendChild(i)}t.start()},c.src=e[0],this.dom.content.appendChild(h),this.dom.content.appendChild(this.renderPagination())}},{key:"renderPagination",value:function(){var t=this,e=document.createElement("div");e.classList.add("controls"),e.addEventListener("mouseleave",(function(e){t.start()}));var r=document.createElement("button");r.classList.add("btPrev"),r.onclick=this.cbkBtPrevClick;var n=document.createElement("button");return n.classList.add("btNext"),n.onclick=this.cbkBtNextClick,e.appendChild(r),e.appendChild(n),this.domPager=document.createElement("div"),this.domPager.classList.add("txtPager"),e.appendChild(this.domPager),this.updatePager(),e}},{key:"cbkBtPrevClick",value:function(){this.stop(),this.fadeToPrev()}},{key:"cbkBtNextClick",value:function(){this.stop(),this.fadeToNext()}},{key:"hideFrame",value:function(t){this.images[t].classList.add("fadeOut"),this.images[t].classList.remove("fadeIn"),this.images[t].classList.remove("visible")}},{key:"showFrame",value:function(t){this.images[t].classList.remove("fadeOut"),this.images[t].classList.add("visible")}},{key:"stop",value:function(){clearInterval(this.interval),this.interval=null}},{key:"start",value:function(){null==this.interval&&(this.interval=setInterval(this.fadeToNext,this.period))}},{key:"updatePager",value:function(){this.domPager.innerHTML="".concat(this.f+1," of ").concat(this.count)}},{key:"fadeToFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hideFrame(this.f),this.showFrame(t),this.f=t,this.updatePager()}},{key:"fadeToNext",value:function(){this.fadeToFrame(this.getNextFrame())}},{key:"fadeToPrev",value:function(){this.fadeToFrame(this.getPrevFrame())}},{key:"getNextFrame",value:function(){var t=this.f+1;return t>=this.count?0:t}},{key:"getPrevFrame",value:function(){var t=this.f-1;return t<0?this.count-1:t}}]),e}(ut),l()(ce.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(ce.prototype,"renderContents"),ce.prototype),l()(ce.prototype,"cbkBtPrevClick",[u],Object.getOwnPropertyDescriptor(ce.prototype,"cbkBtPrevClick"),ce.prototype),l()(ce.prototype,"cbkBtNextClick",[u],Object.getOwnPropertyDescriptor(ce.prototype,"cbkBtNextClick"),ce.prototype),l()(ce.prototype,"hideFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"hideFrame"),ce.prototype),l()(ce.prototype,"showFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"showFrame"),ce.prototype),l()(ce.prototype,"stop",[u],Object.getOwnPropertyDescriptor(ce.prototype,"stop"),ce.prototype),l()(ce.prototype,"start",[u],Object.getOwnPropertyDescriptor(ce.prototype,"start"),ce.prototype),l()(ce.prototype,"fadeToFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToFrame"),ce.prototype),l()(ce.prototype,"fadeToNext",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToNext"),ce.prototype),l()(ce.prototype,"fadeToPrev",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToPrev"),ce.prototype),l()(ce.prototype,"getNextFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"getNextFrame"),ce.prototype),l()(ce.prototype,"getPrevFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"getPrevFrame"),ce.prototype),ce);S.a.extend(P.a);var pe,fe,ge,ye=(he=function(t){function e(t,r){var n;return i()(this,e),(n=w()(this,_()(e).call(this,t,r))).filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n.ds.parseDates=!0,n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t,e=!this.ds.data[0].files,r=this.filters.deviceCode?"device":"location",n=[],i=this.buildDaysList();if(e)t=this.countFilesForRanges(i,this.ds.data),n="device"==r?[{deviceCode:this.filters.deviceCode,counts:t}]:[{locationCode:this.filters.deviceCode,counts:t}];else for(var o=0;o<this.ds.data.length;o++)t=this.countFilesForRanges(i,this.ds.data[o].files),"device"==r?n.push({deviceCode:this.ds.data[o].deviceCode,counts:t}):n.push({locationCode:this.ds.data[o].locationCode,counts:t});"device"==r?this.renderDevices(i,n):this.renderLocations(i,n)}else this.showStatus("info","No data found for the filters provided.")}},{key:"countFilesForRanges",value:function(t,e){for(var r=t.length,n=Array(r),i=0;i<r;i++)n[i]=0;for(var o=0;o<e.length;o++)for(var a=0;a<r;a++)if(e[o].dateFrom>=t[a].dateFrom&&e[o].dateFrom<=t[a].dateTo){n[a]++;break}return n}},{key:"buildDaysList",value:function(){var t=[],e=S()(this.filters.dateFrom),r=S()(this.filters.dateTo),n=(e=this.flattenDate(e)).add(1,"day");if(n>r)t.push({dateFrom:e,dateTo:r});else{for(var i=e;n<r;)t.push({dateFrom:i,dateTo:n}),i=i.add(1,"day"),n=n.add(1,"day");i<r&&t.push({dateFrom:i,dateTo:r})}return t}},{key:"flattenDate",value:function(t){return t=(t=(t=(t=t.set("h",0)).set("m",0)).set("s",0)).set("ms",0)}},{key:"renderDevices",value:function(t,e){var r=["deviceCode"],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;r.push(l.dateFrom.format("YYYY-MM-DD"))}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}var c="",h=!0,u=!1,d=void 0;try{for(var p,f=e[Symbol.iterator]();!(h=(p=f.next()).done);h=!0){var g=p.value,y=[g.deviceCode];c+="<tr>"+B(y=y.concat(g.counts),"td")+"</tr>"}}catch(t){u=!0,d=t}finally{try{h||null==f.return||f.return()}finally{if(u)throw d}}this.dom.content.innerHTML=H(r,c)}},{key:"renderDefault",value:function(){}}]),e}(ut),l()(he.prototype,"download",[u],Object.getOwnPropertyDescriptor(he.prototype,"download"),he.prototype),l()(he.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(he.prototype,"renderContents"),he.prototype),he),ve=r(37),me=r.n(ve),we=r(17),be=r.n(we),_e=function(){function t(e,r,n){i()(this,t),this.cw=e.cw,this.ref=new Konva.Group({x:0,y:e.margin.top}),this.build(r,n)}return a()(t,[{key:"build",value:function(t,e){var r=t.w,n=t.h;this.ref.add(new Konva.Rect({x:0,y:0,width:Math.max(r,this.cw),height:n,fill:"#222222",listening:!1})),this.ref.add(this.buildXAxis(t,e))}},{key:"rebuild",value:function(t,e){this.ref.destroyChildren(),this.build(t,e)}},{key:"buildXAxis",value:function(t,e){for(var r,n=new Konva.Group({x:0,y:0}),i=e.cellw,o=0;o<=24;o++)r=Math.floor(o*i)+.5,o<24&&n.add(new Konva.Text({text:o<10?"0".concat(o,":00"):"".concat(o,":00"),x:r,y:-13,width:i,height:14,fill:"#222222",fontSize:10,align:"center",listening:!1})),n.add(new Konva.Line({x:r,y:0,points:[0,-14,0,t.h],stroke:"#888888",strokeWidth:1,listening:!1}));return n}}]),t}(),xe=r(38),Ce=r(39),ke=r(40),Se=function(){function t(e,r,n,o){i()(this,t),this.ref=new Konva.Group({x:Math.floor(e),y:Math.floor(r),rotation:0}),this.data=n,this.cbkToggle=o,this.k_box=null,this.k_label=null,this.active=!0,this.build()}return a()(t,[{key:"onClick",value:function(t){this.active=!this.active,this.k_box.fill(this.active?this.data.colors.normal:"#FFFFFF").stroke(this.active?this.data.colors.dark:"#666666"),this.ref.draw(),this.cbkToggle(this.data.key)}},{key:"onMouseEnter",value:function(t){this.k_label.getText().fill(this.data.colors.dark),this.ref.draw()}},{key:"onMouseLeave",value:function(t){this.k_label.getText().fill("#000000"),this.ref.draw()}},{key:"build",value:function(){var t=this.data,e=t.colors,r="".concat(t.dataProductCode," (.").concat(t.extension,")");this.k_box=new xe.Rect({x:.5,y:.5,width:16,height:16,fill:e.normal,stroke:e.dark,strokeWidth:1}),this.k_label=new Konva.Label({x:22,y:3}),this.k_label.add(new ke.Tag({fill:"#FFFFFF"})),this.k_label.add(new Ce.Text({text:r,fontSize:13})),this.ref.on("click",this.onClick.bind(this)),this.ref.on("mouseenter",this.onMouseEnter.bind(this)),this.ref.on("mouseleave",this.onMouseLeave.bind(this)),this.ref.add(this.k_box,this.k_label)}}]),t}(),De=function(){function t(e,r){var n;i()(this,t),this.data=[];for(var o=0,a=Object.keys(e);o<a.length;o++){var s=a[o];n=e[s],this.data.push({key:s,dataProductCode:n.dataProductCode,extension:n.extension,colors:n.colors})}this.cbkToggleLabel=r,this.build()}return a()(t,[{key:"build",value:function(){this.ref=new Konva.Group({x:10,y:0});var t,e=0,r=!0,n=!1,i=void 0;try{for(var o,a=this.data[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t=new Se(e,0,s,this.cbkToggleLabel),this.ref.add(t.ref),e+=t.ref.getClientRect().width+22}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}]),t}(),Pe=(r(91),function(){function t(e,r,n,o){i()(this,t),this.ref=this.build(e,r,n,o)}return a()(t,[{key:"build",value:function(t,e,r,n){var i,o=new Konva.Group({x:0,y:0}),a=t,s=r,l=e.left,c=e.top,h=s.count;o.add(new Konva.Rect({x:0,y:c-22,width:l,height:a.h+c+22,fill:"#FFFFFF"})),o.add(new Konva.Line({x:l,y:c-14,points:[.5,.5,0,a.h+14],stroke:"#888888",strokeWidth:1}));for(var u=0;u<=h;u++)u<s.count&&o.add(new Konva.Text({text:n[u].dateFrom.format("MMM-DD"),x:0,y:c,width:l-4,height:s.h,fill:"#222222",fontSize:10,align:"right",verticalAlign:"middle"})),i=u==h?-.5:.5,o.add(new Konva.Line({x:l-36,y:u*s.h+e.top,points:[0,i,a.w+36,i],stroke:"#888888",strokeWidth:1})),c+=s.h;return o}}]),t}()),Te=function(){function t(e,r,n,o,a,s,l,c){var h=this;i()(this,t),this.ref=null,this.colors=n,this.dpKey=o,this.idx=a,this.cbkShowTip=s,this.cbkHideTip=l,this.cbkDownload=c,this.timer=null,this.isBig=!0,this.isDense=r,this.build(e),this.ref.on("click",(function(){return h.cbkDownload(o,a)})),this.ref.on("mouseenter",this.onMouseEnter.bind(this)),this.ref.on("mouseleave",this.onMouseLeave.bind(this))}return a()(t,[{key:"onMouseEnter",value:function(t){clearTimeout(this.timer);var e=this.ref.getClientRect();this.timer=setTimeout(this.cbkShowTip,500,this.dpKey,this.idx,e),this.isBig&&!this.isDense?this.ref.fillPriority("color"):this.ref.fill(this.colors.light),this.ref.draw()}},{key:"onMouseLeave",value:function(t){clearTimeout(this.timer),this.cbkHideTip(),this.isBig&&!this.isDense?this.ref.fillPriority("linear-gradient"):this.ref.fill(this.colors.normal),this.ref.draw()}},{key:"hide",value:function(){this.ref.hide()}},{key:"build",value:function(t){var e=this.colors,r=e.light,n=e.normal,i=e.dark,o=t.x,a=t.y,s=t.w,l=t.h;if(s<1&&(o=Math.floor(o)+.5,s=1),this.isBig=s>5,null==this.ref){this.isBig,this.isBig&&this.isDense;var c={x:o,y:a,width:s,height:l,visible:!0,fill:n,fillPriority:"color",fillLinearGradientStartPoint:{x:0,y:0},fillLinearGradientColorStops:[0,r,1,n],stroke:i,strokeWidth:1,strokeEnabled:this.isBig,strokeScaleEnabled:!1,hitStrokeWidth:0,shadowEnabled:!1,shadowForStrokeEnabled:!1,perfectDrawEnabled:!1,listening:this.isBig};this.isBig&&!this.isDense&&(c.fill=r,c.fillPriority="linear-gradient",c.fillLinearGradientEndPoint={x:0,y:l}),this.ref=new Konva.Rect(c),c=null}else{var h=this.ref;this.isBig&&this.isDense;h.x(o).y(a).width(s).height(l).visible(!0).strokeEnabled(this.isBig).listening(this.isBig),this.isBig&&!this.isDense?h.fillPriority("linear-gradient").fill(r).fillLinearGradientEndPoint({x:0,y:l}):h.fillPriority("color").fill(n)}}}]),t}(),Oe=(pe=function(){function t(e,r,n){i()(this,t),this.dom={base:e,track:null,bar:null},this.viewportW=r.cw-r.margin.left,this.layout={x:r.margin.left,h:20,trackW:this.viewportW,aMargin:r.margin},this.bar={x:0,w:0,isMouseDown:!1,mouseDownX:0},this.maxScrollX=0,this.cbkScroll=n}return a()(t,[{key:"computeLayout",value:function(t,e){var r=this.layout,n=this.bar,i=this.viewportW;this.maxScrollX=t-i,n.w=i/t*r.trackW,n.x=e/t*r.trackW}},{key:"updateBarLayout",value:function(){var t=this.layout,e=this.dom,r=e.bar,n=e.track;r.style.width="".concat(this.bar.w,"px"),r.style.left="".concat(this.bar.x,"px"),n.style.display=this.bar.w>=t.trackW?"none":"block"}},{key:"update",value:function(t,e){this.computeLayout(t,e),this.updateBarLayout()}},{key:"render",value:function(t,e){var r=this.layout,n=document.createElement("div");n.className="ScrollBar",n.style.width="".concat(r.trackW,"px"),n.style.height="".concat(r.h,"px"),n.style.marginLeft="".concat(r.x,"px");var i=document.createElement("div");i.className="bar",i.addEventListener("mousedown",this.mousedown),n.appendChild(i),this.dom.base.appendChild(n),this.dom.track=n,this.dom.bar=i,this.update(t,e)}},{key:"mousedown",value:function(t){this.bar.mouseDownX=t.clientX,this.bar.isMouseDown=!0,document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup)}},{key:"mouseup",value:function(t){this.bar.isMouseDown=!1,document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)}},{key:"mousemove",value:function(t){var e=this.bar;if(e.isMouseDown){var r=this.layout.trackW-e.w,n=t.clientX-e.mouseDownX,i=e.x+n;i<0?i=0:i>r&&(i=r),e.x=i,e.mouseDownX=t.clientX,this.dom.bar.style.left="".concat(i,"px"),this.cbkScroll(i/r)}}}]),t}(),l()(pe.prototype,"computeLayout",[u],Object.getOwnPropertyDescriptor(pe.prototype,"computeLayout"),pe.prototype),l()(pe.prototype,"update",[u],Object.getOwnPropertyDescriptor(pe.prototype,"update"),pe.prototype),l()(pe.prototype,"render",[u],Object.getOwnPropertyDescriptor(pe.prototype,"render"),pe.prototype),l()(pe.prototype,"mousedown",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mousedown"),pe.prototype),l()(pe.prototype,"mouseup",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mouseup"),pe.prototype),l()(pe.prototype,"mousemove",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mousemove"),pe.prototype),pe),Le=r(41),Me=function(){function t(e,r,n,o){i()(this,t),this.x=e,this.y=r,this.type=n,this.enabled=!0,this.cbkClick=o,this.k_img=null,this.ref=this.build()}return a()(t,[{key:"setEnabled",value:function(t){this.enabled=t,t||(this.k_img.opacity(.5),this.ref.draw())}},{key:"onMouseEnter",value:function(t){this.enabled&&this.k_img&&(this.k_img.opacity(1),this.ref.draw())}},{key:"onMouseLeave",value:function(t){this.k_img&&(this.k_img.opacity(.5),this.ref.draw())}},{key:"build",value:function(){var t=this,e=new Konva.Group({x:this.x,y:this.y});e.add(new Konva.Rect({x:0,y:0,width:16,height:16,fill:"#FFFFFF"}));var r="in"==this.type?16:35,n=new Image;return n.onload=function(){t.k_img=new Le.Image({image:n,width:16,height:16,opacity:.5,crop:{x:42,y:r,width:16,height:16}}),e.add(t.k_img),e.draw()},n.src="assets/sprite.png",e.on("click",this.cbkClick),e.on("mouseenter",this.onMouseEnter.bind(this)),e.on("mouseleave",this.onMouseLeave.bind(this)),e}}]),t}(),Fe=(fe=function(){function t(e){i()(this,t),this.parent=e,this.dom={},this.ref=this.build()}return a()(t,[{key:"hide",value:function(){this.dom.wrapper.style.display="none"}},{key:"show",value:function(t,e,r,n,i){var o=this.dom;o.title.innerHTML=t[0],o.code.innerHTML=e,o.ext.innerHTML=r,o.from.innerHTML=S()(t[1]).utc().format("YYYY-MM-DD HH:mm:ss"),o.to.innerHTML=S()(t[2]).utc().format("YYYY-MM-DD HH:mm:ss"),o.period.innerHTML=M(n/1e3),o.size.innerHTML=V(t[3]);var a=this.parent.offsetWidth,s=this.parent.offsetHeight,l=i.x,c=i.y,h=i.width,u=i.height,d=l+h>.5*a,p=c+u>.5*s;o.wrapper.style.display="block";var f=o.wrapper.offsetWidth,g=o.wrapper.offsetHeight,y=d?l-f:l+h,v=p?c-g:c+u;y<0&&(y=0),v<0&&(v=0),y>a-f&&(y=a-f),o.wrapper.style.left="".concat(y,"px"),o.wrapper.style.top="".concat(v,"px")}},{key:"build",value:function(){var t=function(t,e,r){var n=document.createElement(t);return e&&n.setAttribute("class",e),r&&(n.innerHTML=r),n};this.dom={wrapper:t("div","tooltip"),title:t("div","title"),code:t("div","value"),ext:t("div","value"),from:t("div","value"),to:t("div","value"),period:t("div","value"),size:t("div","value")};for(var e=this.dom,r=0,n=[e.title,t("div","label","dataProduct:"),e.code,t("div","label","extension:"),e.ext,t("div","label","dateFrom:"),e.from,t("div","label","dateTo:"),e.to,t("div","label","period:"),e.period,t("div","label","size:"),e.size];r<n.length;r++){var i=n[r];e.wrapper.appendChild(i)}return e.wrapper}}]),t}(),l()(fe.prototype,"hide",[u],Object.getOwnPropertyDescriptor(fe.prototype,"hide"),fe.prototype),fe);S.a.extend(P.a);var Ee,Ae=(ge=function(){function t(e,r,n,o){i()(this,t),this.filters=n,this.dom={base:r},this.lyrUI=null,this.lyrMap=null,this.btZoomIn=null,this.btZoomOut=null,this.baseUrl="https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(e.token),this.data={},this.params=o,this.layout={cw:0,ch:o.height,w0:0,zoom:3,zoomFactors:[.2,.4,.8,1,1.5,2.5,4,6,12,24,32],margin:{top:46,bottom:10,left:44},area:{h:o.height-46-10,w:0},row:null,colors:{grid:"#888",background:"#222"}},this.days=null,this.range={min:0,max:0,dayMin:0,dayMax:0},this.scrollbar=null,this.didRenderFiles=!1,this.tooltip=new Fe(this.dom.base),this.dom.base.style.minHeight="".concat(o.height,"px")}return a()(t,[{key:"computeDayRanges",value:function(){var t=this.layout.area,e=S.a.utc(this.range.min),r=S.a.utc(this.range.max),n=A(e),i=A(r);r.isAfter(i)&&(i=i.add(1,"day")),this.days=function(t,e){var r=[],n=A(t),i=n.add(1,"day");if(i>e)return[{dateFrom:t,dateTo:e}];for(var o=n;i<e;)r.push({dateFrom:o,dateTo:i}),o=o.add(1,"day"),i=i.add(1,"day");return o<e&&r.push({dateFrom:o,dateTo:e}),r}(n,i);var o=this.days.length;this.layout.row={h:t.h/o,cellw:0,count:o,pad:2},this.range.dayMin=n.valueOf(),this.range.dayMax=i.valueOf()}},{key:"zoomUpdateLayout",value:function(){var t=this.layout,e=t.area.w,r=t.cw-t.margin.left,n=t.zoomFactors[t.zoom],i=((this.lyrMap?Math.abs(this.lyrMap.x()):0)+r/2)/e,o=n*t.w0;if(t.area.w=o,t.row.cellw=o/24,this.lyrMap){var a=0;(a=i*o-r/2)<0||o<=r?a=0:a+r>o&&(a=o-r),this.lyrMap.x(-a),this.scrollbar&&this.scrollbar.update(o,a)}}},{key:"updateZoom",value:function(t){var e=this.layout,r=e.zoomFactors,n=e.zoom+t;n>=0&&n<r.length&&(e.zoom+=t,this.zoomUpdateLayout(),this.backMap.rebuild(e.area,e.row),this.renderFiles(e.area,e.row),this.btZoomOut.setEnabled(e.area.w>e.cw-e.margin.left),this.lyrMap.batchDraw())}},{key:"zoomIn",value:function(){this.updateZoom(1)}},{key:"zoomOut",value:function(){this.btZoomOut.enabled&&this.updateZoom(-1)}},{key:"display",value:function(t){var e=this.layout,r=this.params;e.cw=this.dom.base.offsetWidth;var n=r.colWidth>0?r.colWidth:(e.cw-44)/24;e.w0=24*n,e.area.w=e.w0,this.gatherData(t),this.computeDayRanges(),this.zoomUpdateLayout(),this.initStage(e,e.area,e.row),this.renderFiles(e.area,e.row),this.lyrMap.batchDraw(),this.scrollbar=new Oe(this.dom.base,e,this.onScroll.bind(this)),this.scrollbar.render(e.area.w,0),this.dom.base.appendChild(this.tooltip.ref)}},{key:"initStage",value:function(t,e,r){var n=document.createElement("div");n.classList.add("map","unselectable"),this.dom.base.appendChild(n);var i=this.dom.base.offsetWidth,o=new be.a.Stage({container:n,width:i,height:t.ch});this.lyrUI=this.buildLayerUI(t,r),this.lyrMap=new be.a.Layer({x:0,offsetX:-t.margin.left,y:0,id:"map"}),this.grpFiles=new be.a.Group({x:0,y:t.margin.top}),this.backMap=new _e(t,e,r,this.days),this.lyrMap.add(this.backMap.ref,this.grpFiles),o.add(this.lyrMap,this.lyrUI)}},{key:"buildLayerUI",value:function(t,e){var r=new be.a.Layer({x:0,y:0}),n=new De(this.data,this.toggleDp),i=new Pe(t.area,t.margin,e,this.days),o=t.cw-16;return this.btZoomIn=new Me(o,0,"in",this.zoomIn),this.btZoomOut=new Me(o-24,0,"out",this.zoomOut),this.btZoomOut.enabled=!1,r.add(n.ref,this.btZoomIn.ref,this.btZoomOut.ref,i.ref),r}},{key:"toggleDp",value:function(t){this.data[t].visible=!this.data[t].visible,this.renderFiles(this.layout.area,this.layout.row),this.lyrMap.batchDraw()}},{key:"renderFiles",value:function(t,e){var r=0;for(var n in this.data)this.data[n].visible&&r++;var i,o,a,s,l,c,u,d=0,p=r>0?Math.round((e.h-2)/r):0,f=1,g=0,y=t.w/864e5;for(var v in this.data)if(l=this.data[v],i=t.w*l.period/864e5,a=(c=l.items.length)>1e3,l.visible){for(var m=0;m<c;m++){if(1==f&&m+1<c&&l.items[m][1]==l.items[m+1][1])for(g=0,u=m+1;u<c&&l.items[m][1]==l.items[u][1];)u++,f++;o=this.getFileRect(l.items[m],d,i,p,e.h,864e5,y),f>1&&(o.h/=f,o.y+=h*g,++g==f&&(f=1,g=0)),this.didRenderFiles?l.items[m][4].build(o):(s=new Te(o,a,l.colors,v,m,this.showTooltip,this.tooltip.hide,this.downloadFile),this.grpFiles.add(s.ref),l.items[m][4]=s)}d++}else for(var w=0;w<c;w++)l.items[w][4].hide();this.didRenderFiles=!0}},{key:"getFileRect",value:function(t,e,r,n,i,o,a){var s={x:0,y:0,w:r,h:n},l=t[1],c=t[2],h=this.range.dayMin,u=l-h,d=Math.floor(u/o);if(s.x=(u-d*o)*a,l<c){var p=(c-h-d*o)*a;s.w=p-s.x}return s.y=Math.floor(i*d+n*e)+.5+1,e>0&&(s.y+=1,s.h-=1),s}},{key:"gatherData",value:function(t){for(var e,r,n=new Set,i=[],o=0,a=99999999999999,s=0;s<t.length;s++)e=t[s],r="".concat(e.dataProductCode,".").concat(e.extension),n.has(r)||(this.data[r]={dataProductCode:e.dataProductCode,extension:e.extension,period:0,items:[],colors:null,visible:!0},n.add(r),i[r]=[]),i[r].push(e.dateFrom),this.addItem(r,e),e.dateFrom<a&&(a=e.dateFrom),e.dateTo>o&&(o=e.dateTo);var l=S.a.utc(this.filters.dateFrom).valueOf(),c=S.a.utc(this.filters.dateTo).valueOf();this.range.min=Math.max(a,l),this.range.max=Math.min(o,c);var h=!0,u=!1,d=void 0;try{for(var p,f=n[Symbol.iterator]();!(h=(p=f.next()).done);h=!0){var g=p.value,y=Ot(g);this.data[g].period=this.getTimePeriod(i[g]),this.data[g].colors={dark:y,normal:Lt(y,.7),light:Lt(y,.9)}}}catch(t){u=!0,d=t}finally{try{h||null==f.return||f.return()}finally{if(u)throw d}}}},{key:"addItem",value:function(t,e){this.data[t].items.push([e.filename,e.dateFrom,e.dateTo,e.uncompressedFileSize,null])}},{key:"getTimePeriod",value:function(t){for(var e,r=new Map,n=t.length,i=1;i<n;i++)e=t[i]-t[i-1],r.has(e)?r.set(e,r.get(e)+1):r.set(e,1);var o=0,a=0,s=!0,l=!1,c=void 0;try{for(var h,u=r[Symbol.iterator]();!(s=(h=u.next()).done);s=!0){var d=me()(h.value,2),p=d[0],f=d[1];p>0&&f>o&&(o=f,a=p)}}catch(t){l=!0,c=t}finally{try{s||null==u.return||u.return()}finally{if(l)throw c}}return a}},{key:"onScroll",value:function(t){var e=this.layout,r=e.area.w-(e.cw-e.margin.left);this.lyrMap.x(-t*r).batchDraw()}},{key:"showTooltip",value:function(t,e,r){var n=this.data[t],i=n.items[e];this.tooltip.show(i,n.dataProductCode,n.extension,n.period,r)}},{key:"downloadFile",value:function(t,e){var r=this.data[t].items[e];window.open("".concat(this.baseUrl,"&filename=").concat(r[0]),"_blank")}}]),t}(),l()(ge.prototype,"updateZoom",[u],Object.getOwnPropertyDescriptor(ge.prototype,"updateZoom"),ge.prototype),l()(ge.prototype,"zoomIn",[u],Object.getOwnPropertyDescriptor(ge.prototype,"zoomIn"),ge.prototype),l()(ge.prototype,"zoomOut",[u],Object.getOwnPropertyDescriptor(ge.prototype,"zoomOut"),ge.prototype),l()(ge.prototype,"toggleDp",[u],Object.getOwnPropertyDescriptor(ge.prototype,"toggleDp"),ge.prototype),l()(ge.prototype,"showTooltip",[u],Object.getOwnPropertyDescriptor(ge.prototype,"showTooltip"),ge.prototype),l()(ge.prototype,"downloadFile",[u],Object.getOwnPropertyDescriptor(ge.prototype,"downloadFile"),ge.prototype),ge);S.a.extend(P.a);var Re,Ie=(Ee=function(t){function e(t,r){var n;i()(this,e),n=w()(this,_()(e).call(this,t,r));o=n.dom.base.parentElement,a=getComputedStyle(o),s=o.clientHeight,l=o.clientWidth,s-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),l-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight);var o,a,s,l,c={width:parseFloat(n.getOption("width",0),10),height:parseFloat(n.getOption("height",520),10),colWidth:parseFloat(n.getOption("colWidth",0),10)};return n.map=new Ae(r,n.dom.content,n.filters,c),n.filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n.ds.parseDates=!0,n}return C()(e,t),a()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){this.hideLoader(),this.ds.hasData()?this.map.display(this.ds.data):this.showStatus("info","No data found for the filters provided.")}}]),e}(ut),l()(Ee.prototype,"download",[u],Object.getOwnPropertyDescriptor(Ee.prototype,"download"),Ee.prototype),l()(Ee.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(Ee.prototype,"renderContents"),Ee.prototype),Ee),Ue=(Re=function(){function t(){i()(this,t),this._widgets=[],this._maxThreads=5,this._freeThreads=this._maxThreads,this._widgetsLoaded=0;var e=document.getElementById("oncdw");if(e&&e.dataset&&e.dataset.token)this._token=e.dataset.token;else{var r=new URL(window.location.href).searchParams.get("token");this._token=r||""}this._onc=new v(this._token),document.addEventListener("click",(function(t){document.querySelectorAll(".oncWidget div.header div.menu").forEach((function(t,e){t.classList.remove("active")}))}))}return a()(t,[{key:"detectWidgets",value:function(){var t=this;this.parseUrlWidgets(),document.querySelectorAll(".oncWidget").forEach((function(e){var r,n=e.dataset.widget;try{switch(n){case"version":r=new yt(e,"version");break;case"plot":r=new zt(e,t._onc);break;case"rtplot":r=new Zt(e,t._onc);break;case"image":r=new ie(e,t._onc);break;case"download":r=new oe(e,t._onc);break;case"rawValue":r=new se(e,t._onc);break;case"locationsTree":r=new mt(e,t._onc);break;case"locations":r=new wt(e,t._onc);break;case"devices":r=new _t(e,t._onc);break;case"deployments":r=new Ct(e,t._onc);break;case"deviceCategories":r=new bt(e,t._onc);break;case"properties":r=new xt(e,t._onc);break;case"dataProducts":r=new kt(e,t._onc);break;case"archiveFiles":r=new ue(e,t._onc);break;case"archiveGif":r=new de(e,t._onc);break;case"archiveDays":r=new ye(e,t._onc);break;case"archiveMap":r=new Ie(e,t._onc);break;default:throw new Error("This widget requires a valid <b>data-widget</b> attribute.")}}catch(t){console.log(t),r=new yt(e,"error",t.message)}t._widgets.push(r);var i=t._widgets.length-1;t._widgets[i].idx=i,t._widgets[i].dom.base.classList.add("wid_".concat(i))}));var e=new Event("OncAllWidgetsParsed");document.dispatchEvent(e)}},{key:"parseUrlWidgets",value:function(){var t=new URL(window.location.href).searchParams.get("widgets");if(null!=t){for(var e=t.split(" "),r={"data-widget":e[0]},n=1;n<e.length;n+=2)r[e[n]]=e[n+1];var i=document.createElement("section");for(var o in i.className="oncWidget",r)i.setAttribute(o,r[o]);document.body.appendChild(i)}}},{key:"processWidgets",value:function(){for(var t=this,e=this._widgets.length,r=this._maxThreads,n=0,i=r;i<e;i++)this._widgets[i].showLoader("waiting","Waiting for other widgets");for(n=0;n<e&&n<r;n++)this.processWidget(n);if(n<e)var o=window.setInterval((function(){for(;n<e&&t._freeThreads>0;)t.processWidget(n),n++;n>=e&&clearInterval(o)}),200)}},{key:"processWidget",value:function(t){var e=this,r=this._widgets[t];r&&!r.cancelled?(this._freeThreads--,r.download().then((function(t){r.render(),e._freeThreads++,e._widgetsLoaded++,e.cbkWidgetLoaded(r.idx,e._widgetsLoaded)}),(function(t){e.showWidgetError(r,t),e._freeThreads++,e._widgetsLoaded++,e.cbkWidgetLoaded(r.idx,e._widgetsLoaded)}))):(this._widgetsLoaded++,this.cbkWidgetLoaded(r.idx,this._widgetsLoaded))}},{key:"cbkWidgetLoaded",value:function(t,e){document.dispatchEvent(new CustomEvent("OncWidgetDownloaded",{detail:{idx:t,downloaded:e,total:this._widgets.length}})),this._widgets[t].cancelled&&this._widgets[t].dom.base.classList.add("cancelled")}},{key:"showWidgetError",value:function(t,e){"empty"==e?t.showStatus("info","The server responded with an empty data set."):"canceled"==e?this.showStatus("info","Download process canceled."):e.response&&e.response.data?t.showStatus("api_error",this._onc.errorToString(e)):t.showStatus("error",e.message)}}]),t}(),l()(Re.prototype,"processWidget",[u],Object.getOwnPropertyDescriptor(Re.prototype,"processWidget"),Re.prototype),Re);r(92);document.addEventListener("DOMContentLoaded",(function(){window.OncDW=new Ue,window.OncDW.detectWidgets(),window.OncDW.processWidgets()}))}]);